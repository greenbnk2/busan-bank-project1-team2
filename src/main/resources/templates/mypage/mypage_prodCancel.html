<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mypage_prodCancel</title>
    <link rel="stylesheet" href="../../../static/components/button.css">
    <style>
        main {
            background-color: #F6F6F8;
            padding: 10px 20px 80px;
        }
        body {
            background-color: #F6F6F8;
        }
        /* 공통 링크(카드 전체 클릭) */
        .menu-link{ text-decoration:none; color:inherit; display:block; }

        /* 카드 기본 */
        .menu-card{
            background:#fff; width:280px; height:200px; border-radius:16px;
            border:1px solid #E5E7EB; box-shadow:0 2px 8px rgba(0,0,0,.05);
            transition: transform .22s ease, box-shadow .22s ease, border-color .22s ease, background-color .22s ease;
            cursor:pointer; will-change: transform;
        }

        /* Hover: 살짝 떠오르고 그림자 강화, 보더 강조 */
        .menu-card:hover{
            transform: translateY(-4px);
            box-shadow:0 10px 24px rgba(0,0,0,.10);
            border-color:#D1D5DB;        /* 더 선명한 테두리 */
            background-color:#FCFCFD;    /* 아주 미세한 톤 변화 */
        }

        /* Active(눌렀을 때): 프레스 느낌 */
        .menu-card:active{
            transform: translateY(-1px) scale(.995);
            box-shadow:0 6px 16px rgba(0,0,0,.08);
        }

        /* 키보드 포커스 접근성: 트렌디한 링 */
        .menu-link:focus-visible .menu-card{
            outline:none;
            box-shadow:0 0 0 2px #fff, 0 0 0 4px rgba(59,130,246,.55); /* 흰색-파랑 이중링 */
            transform: translateY(-2px);
        }

        /* 모션 최소화 선호 사용자 배려 */
        @media (prefers-reduced-motion: reduce){
            .menu-card, .menu-card:hover, .menu-card:active{
            transition:none; transform:none; box-shadow:0 2px 8px rgba(0,0,0,.05);
            }
            .menu-link:focus-visible .menu-card{ box-shadow:0 0 0 3px rgba(59,130,246,.55); }
        }
        </style>
        <style>
            .btn-register {
            --bg1: #D91A1A;
            --bg2: #F03A3A;
            --shadow: rgba(217,26,26,.45);
            position: relative;
            box-sizing: border-box;
            width: 90px; height: 42px;
            border: none; border-radius: 8px;
            color: #fff; cursor: pointer;
            background: linear-gradient(180deg, var(--bg2), var(--bg1));
            outline: none;
            box-shadow: 0 6px 14px -10px var(--shadow);
            transition:
                background .18s ease,
                box-shadow .18s ease,
                transform .12s ease; /* 프레스만 사용할 예정 */
            will-change: background, box-shadow, transform;
            }
            
            /* Hover: 컬러와 섀도우만 아주 미세하게 (리프트 없음) */
            .btn-register:hover {
            background: linear-gradient(180deg, #f24a4a, #d61a1a);
            box-shadow: 0 8px 18px -12px var(--shadow);
            transform: none; /* 확실하게 떠오르지 않도록 고정 */
            }
            
            /* Active: 살짝 눌리는 프레스 효과만 */
            .btn-register:active {
            transform: scale(.98);
            box-shadow: 0 4px 10px -10px var(--shadow);
            }
            
            /* 키보드 포커스 접근성 */
            .btn-register:focus-visible {
            outline: 3px solid rgba(240,58,58,.55);
            outline-offset: 2px;
            }
            
            /* 모션 최소화 존중 */
            @media (prefers-reduced-motion: reduce) {
            .btn-register { transition: none !important; }
            }
            
            @media (prefers-color-scheme: dark) {
            .btn-register { --shadow: rgba(240,58,58,.35); }
            }
        </style>
    <style>
          /* 공통 링크(카드 전체 클릭) */
          .menu-link{ text-decoration:none; color:inherit; display:block; }

          /* 카드 기본 */
          .menu-card{
            background:#fff; width:280px; height:200px; border-radius:16px;
            border:1px solid #E5E7EB; box-shadow:0 2px 8px rgba(0,0,0,.05);
            transition: transform .22s ease, box-shadow .22s ease, border-color .22s ease, background-color .22s ease;
            cursor:pointer; will-change: transform;
          }

          /* Hover: 살짝 떠오르고 그림자 강화, 보더 강조 */
          .menu-card:hover{
            transform: translateY(-4px);
            box-shadow:0 10px 24px rgba(0,0,0,.10);
            border-color:#D1D5DB;        /* 더 선명한 테두리 */
            background-color:#FCFCFD;    /* 아주 미세한 톤 변화 */
          }

          /* Active(눌렀을 때): 프레스 느낌 */
          .menu-card:active{
            transform: translateY(-1px) scale(.995);
            box-shadow:0 6px 16px rgba(0,0,0,.08);
          }

          /* 키보드 포커스 접근성: 트렌디한 링 */
          .menu-link:focus-visible .menu-card{
            outline:none;
            box-shadow:0 0 0 2px #fff, 0 0 0 4px rgba(59,130,246,.55); /* 흰색-파랑 이중링 */
            transform: translateY(-2px);
          }

          /* 모션 최소화 선호 사용자 배려 */
          @media (prefers-reduced-motion: reduce){
            .menu-card, .menu-card:hover, .menu-card:active{
              transition:none; transform:none; box-shadow:0 2px 8px rgba(0,0,0,.05);
            }
            .menu-link:focus-visible .menu-card{ box-shadow:0 0 0 3px rgba(59,130,246,.55); }
          }
        </style>
        <style>
          #aiReco{
            opacity: 1;
            /* opacity는 1.2s로 페이드, visibility는 1.2s 뒤에 적용(즉, 페이드 끝난 후 숨김) */
            transition: opacity .9s cubic-bezier(.22,.61,.36,1),
                        visibility 0s linear 1.2s;
            will-change: opacity;
          }

          #aiReco.is-fading{
            opacity: 0;
            visibility: hidden;   /* 지연되어 끝나고 적용됨 -> 모션 살아있음 */
            pointer-events: none; /* 클릭만 막기 */
          }

          /* X 아이콘(svg[data-close])의 포커스 아웃라인 제거 */
          #aiReco [data-close]:focus,
          #aiReco [data-close]:focus-visible {
            outline: none;
            box-shadow: none;
          }

          /* 모바일 클릭 시 파란/회색 하이라이트 제거 */
          #aiReco [data-close]{
            -webkit-tap-highlight-color: transparent;
          }
        </style>
        <style>
          .pw-wrap{ position:relative; margin-top:20px; }
          .pw-wrap .pw-input{
            box-sizing:border-box; outline:none;
            padding-left:15px; padding-right:42px; /* 버튼 자리 확보 */
            font-size:16px; width:100%; height:50px;
            border:1px solid #D1D5DB; border-radius:6px;
          }
          .pw-wrap .eye-btn{
            position:absolute; right:12px; top:50%;
            transform:translateY(-48%);
            width:28px; height:28px; padding:0; border:0; background:none; cursor:pointer;
          }
          .pw-wrap .eye-btn:focus-visible{ outline:2px solid rgba(59,130,246,.55); border-radius:6px; }
          .agree-option { cursor: pointer; user-select: none; }
          .agree-option * { cursor: inherit; }
        </style>
        <style>
          /* 카드 영역의 a 태그는 색이 안 변하도록 고정 */
          #summary-cards a,
          #summary-cards a:link,
          #summary-cards a:visited,
          #summary-cards a:hover,
          #summary-cards a:active {
            color: inherit;              /* 부모 색 따라감 */
            text-decoration: none;       /* 밑줄 제거 */
          }
        </style>
        <style>
          #btnFinal:disabled {
            opacity: .45;
            cursor: not-allowed;
            box-shadow: none;
            filter: grayscale(10%);
          }
        </style>
</head>
<body>
    <header>
        <div th:replace="~{layouts/header.html}"></div>
    </header>
    
    <main style="background-color: #F6F6F8; display: flex; justify-content: center; padding-top: 50px !important;">
    <div style="width: 1200px; ">
      <div>
        <div style="font-size: 24px; color: #4B5563;">상품 해지 신청</div>
        <div style="display: flex;">
          <div style="font-size: 16px; color: #4B5563;">해지할 상품을 선택하고, 유의사항을 확인한 뒤 신청을 완료하세요.</div>
        </div>
        <div style="margin-top:25px; padding:30px; box-sizing: border-box; background-color: white; width: 100%;border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB;">
          <div style="font-size:20px; color:#2B2F36;">해지할 상품 선택</div>
            <div th:each="i : ${#numbers.sequence(0, contractList.size() - 1, 3)}"
                    style="display: flex; gap: 30px;">
              <div th:if="${i < contractList.size()}" th:object="${contractList[i]}" id="summary-cards" style="display: flex; margin-top: 25px; gap: 30px;">
                <div style="background-color: white; width: 358px; border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB;">
                  <div style="padding: 21px;">
                    <div>
                      <div style="display: flex;">
                        <div style="">
                          <label th:for="|prod${i+1}|" class="prod-select" style="display:block; cursor:pointer;">
                          <div style="display: flex; justify-content: center;">
                            <div th:styleappend="
                                                ${#strings.equalsIgnoreCase(contractList[i].ptype,'IRP')}  ? 'background-color:#e9ecf4;' :
                                                (${#strings.equalsIgnoreCase(contractList[i].ptype,'적금')}  ? 'background-color:#eaf8f3;' :
                                                (${#strings.equalsIgnoreCase(contractList[i].ptype,'펀드')} ? 'background-color:#f2e8ff;' :
                                                                                                              'background-color:#f3f4f6;'))
                                              "
                                    style="display: flex; justify-content: center; align-items: center; border-radius: 8px; background-color: #ddeaff; width: 48px; height: 48px;">
                                <th:block th:switch="${#strings.toUpperCase(contractList[i].ptype)}">

                                    <!-- IRP -->
                                    <svg th:case="'IRP'" width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_257_250)">
                                            <path d="M12.5 3V3.02187C12.3344 3.00937 12.1687 3 12 3H8C7.48438 3 6.98438 3.06562 6.50625 3.1875C6.50312 3.125 6.5 3.0625 6.5 3C6.5 1.34375 7.84375 0 9.5 0C11.1562 0 12.5 1.34375 12.5 3ZM12 4C12.1094 4 12.2188 4.00313 12.325 4.00938C12.4563 4.01875 12.5875 4.03125 12.7188 4.05C13.2688 3.40938 14.0875 3 15 3H15.3594C15.6844 3 15.9219 3.30625 15.8438 3.62188L15.4125 5.34688C15.9062 5.80938 16.3094 6.37187 16.5844 7H17C17.5531 7 18 7.44688 18 8V11C18 11.5531 17.5531 12 17 12H16C15.7156 12.3781 15.3781 12.7156 15 13V15C15 15.5531 14.5531 16 14 16H13C12.4469 16 12 15.5531 12 15V14H8V15C8 15.5531 7.55312 16 7 16H6C5.44688 16 5 15.5531 5 15V13C3.90937 12.1812 3.16563 10.9281 3.025 9.5H2.125C0.95 9.5 0 8.55 0 7.375C0 6.2 0.95 5.25 2.125 5.25H2.25C2.66563 5.25 3 5.58437 3 6C3 6.41563 2.66563 6.75 2.25 6.75H2.125C1.78125 6.75 1.5 7.03125 1.5 7.375C1.5 7.71875 1.78125 8 2.125 8H3.1C3.47812 6.13125 4.90312 4.64062 6.73438 4.1625C7.1375 4.05625 7.5625 4 8 4H12ZM14 8.25C14 8.05109 13.921 7.86032 13.7803 7.71967C13.6397 7.57902 13.4489 7.5 13.25 7.5C13.0511 7.5 12.8603 7.57902 12.7197 7.71967C12.579 7.86032 12.5 8.05109 12.5 8.25C12.5 8.44891 12.579 8.63968 12.7197 8.78033C12.8603 8.92098 13.0511 9 13.25 9C13.4489 9 13.6397 8.92098 13.7803 8.78033C13.921 8.63968 14 8.44891 14 8.25Z" fill="#1E3A8A"/>
                                        </g>
                                        <defs><clipPath id="clip0_257_250"><path d="M0 0H18V16H0V0Z" fill="white"/></clipPath></defs>
                                    </svg>

                                    <!-- 적금 -->
                                    <svg th:case="'적금'" width="16" height="24" viewBox="0 0 16 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M2 7C2 6.44687 1.55313 6 1 6C0.446875 6 0 6.44687 0 7V17.5C0 18.8813 1.11875 20 2.5 20H15C15.5531 20 16 19.5531 16 19C16 18.4469 15.5531 18 15 18H2.5C2.225 18 2 17.775 2 17.5V7ZM14.7063 9.70625C15.0969 9.31563 15.0969 8.68125 14.7063 8.29063C14.3156 7.9 13.6812 7.9 13.2906 8.29063L10 11.5844L8.20625 9.79063C7.81563 9.4 7.18125 9.4 6.79063 9.79063L3.29063 13.2906C2.9 13.6812 2.9 14.3156 3.29063 14.7063C3.68125 15.0969 4.31563 15.0969 4.70625 14.7063L7.5 11.9156L9.29375 13.7094C9.68437 14.1 10.3188 14.1 10.7094 13.7094L14.7094 9.70937L14.7063 9.70625Z" fill="#10B981"/>
                                    </svg>

                                    <!-- 펀드 -->
                                    <svg th:case="'펀드'" width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M9.5 7.5V0.51875C9.5 0.2375 9.71875 0 10 0C13.8656 0 17 3.13438 17 7C17 7.28125 16.7625 7.5 16.4813 7.5H9.5ZM1 8.5C1 4.70937 3.81562 1.57187 7.46875 1.07187C7.75625 1.03125 8 1.2625 8 1.55313V9L12.8906 13.8906C13.1 14.1 13.0844 14.4438 12.8438 14.6125C11.6187 15.4875 10.1187 16 8.5 16C4.35938 16 1 12.6438 1 8.5ZM17.45 9C17.7406 9 17.9688 9.24375 17.9312 9.53125C17.6906 11.2781 16.85 12.8312 15.6219 13.9781C15.4344 14.1531 15.1406 14.1406 14.9594 13.9563L10 9H17.45Z" fill="#9333EA"/>
                                    </svg>

                                    <!-- 기본값(안전장치) -->
                                    <svg th:case="*"
                                         width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="7" stroke="#9CA3AF"/></svg>
                                </th:block>
                            </div>
                            <div style="margin-left: 15px;">
                                <div style="width:100px;color: #2B2F36; font-size: 16px;"><span style="width: 100px;" th:text="${contractList[i].pname}"></span></div>
                                <div style="color: #6B7280; font-size: 14px;">만기일:&nbsp;<span th:text="${#temporals.format(contractList[i].pend, 'yyyy.MM.dd')}"></span></div>
                            </div>
                            <div style="margin-left: 110px;">
                              <input type="radio" name="what"
                                     th:id="|prod${i+1}|"
                                     th:value="${i}"
                                     th:data-pname="${contractList[i].pname}"
                                     th:data-ptype="${contractList[i].ptype}"
                                     th:data-balance="${contractList[i].pbalance}"
                                     th:data-pcnapw="${contractList[i].pcnapw}"
                                     th:data-pacc="${contractList[i].pacc}"
                                     style="scale: calc(1.7); cursor: pointer;">
                            </div>
                          </div>
                          <div style="display: flex; margin-top: 20px;">
                            <div>현재 잔액</div>
                            <div style="margin-left: auto;"><span th:text="${#numbers.formatInteger(contractList[i].pbalance, 3, 'COMMA')}"></span>원</div>
                          </div>
                          <div style="display: flex; margin-top: 15px;">
                            <div>연 이자율</div>
                            <div style="margin-left: auto;"><span th:text="${contractList[i].phirate}"></span>%</div>
                          </div>
                          </label>
                          <div style="text-align: center; margin-top: 20px;">
                            <div><a href="#" style="text-decoration: none; color: red;">자세히 보기</a></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div th:if="${i + 1 < contractList.size()}"
                     th:object="${contractList[i + 1]}"
                        style="background-color: white; width: 357px; border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB;">
                  <div style="padding: 21px;">
                    <div>
                      <div style="display: flex;">
                        <div style="">
                          <label th:for="|prod${i+2}|" class="prod-select" style="display:block; cursor:pointer;">
                          <div style="display: flex; justify-content: center;">
                            <div th:styleappend="
                                                ${#strings.equalsIgnoreCase(contractList[i+1].ptype,'IRP')}  ? 'background-color:#e9ecf4;' :
                                                (${#strings.equalsIgnoreCase(contractList[i+1].ptype,'적금')}  ? 'background-color:#eaf8f3;' :
                                                (${#strings.equalsIgnoreCase(contractList[i+1].ptype,'펀드')} ? 'background-color:#f2e8ff;' :
                                                                                                              'background-color:#f3f4f6;'))
                                              "
                                    style="display: flex; justify-content: center; align-items: center; border-radius: 8px; background-color: #dffce6; width: 48px; height: 48px;">
                                <th:block th:switch="${#strings.toUpperCase(contractList[i+1].ptype)}">

                                    <!-- IRP -->
                                    <svg th:case="'IRP'" width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_257_250)">
                                            <path d="M12.5 3V3.02187C12.3344 3.00937 12.1687 3 12 3H8C7.48438 3 6.98438 3.06562 6.50625 3.1875C6.50312 3.125 6.5 3.0625 6.5 3C6.5 1.34375 7.84375 0 9.5 0C11.1562 0 12.5 1.34375 12.5 3ZM12 4C12.1094 4 12.2188 4.00313 12.325 4.00938C12.4563 4.01875 12.5875 4.03125 12.7188 4.05C13.2688 3.40938 14.0875 3 15 3H15.3594C15.6844 3 15.9219 3.30625 15.8438 3.62188L15.4125 5.34688C15.9062 5.80938 16.3094 6.37187 16.5844 7H17C17.5531 7 18 7.44688 18 8V11C18 11.5531 17.5531 12 17 12H16C15.7156 12.3781 15.3781 12.7156 15 13V15C15 15.5531 14.5531 16 14 16H13C12.4469 16 12 15.5531 12 15V14H8V15C8 15.5531 7.55312 16 7 16H6C5.44688 16 5 15.5531 5 15V13C3.90937 12.1812 3.16563 10.9281 3.025 9.5H2.125C0.95 9.5 0 8.55 0 7.375C0 6.2 0.95 5.25 2.125 5.25H2.25C2.66563 5.25 3 5.58437 3 6C3 6.41563 2.66563 6.75 2.25 6.75H2.125C1.78125 6.75 1.5 7.03125 1.5 7.375C1.5 7.71875 1.78125 8 2.125 8H3.1C3.47812 6.13125 4.90312 4.64062 6.73438 4.1625C7.1375 4.05625 7.5625 4 8 4H12ZM14 8.25C14 8.05109 13.921 7.86032 13.7803 7.71967C13.6397 7.57902 13.4489 7.5 13.25 7.5C13.0511 7.5 12.8603 7.57902 12.7197 7.71967C12.579 7.86032 12.5 8.05109 12.5 8.25C12.5 8.44891 12.579 8.63968 12.7197 8.78033C12.8603 8.92098 13.0511 9 13.25 9C13.4489 9 13.6397 8.92098 13.7803 8.78033C13.921 8.63968 14 8.44891 14 8.25Z" fill="#1E3A8A"/>
                                        </g>
                                        <defs><clipPath id="clip0_257_250"><path d="M0 0H18V16H0V0Z" fill="white"/></clipPath></defs>
                                    </svg>

                                    <!-- 적금 -->
                                    <svg th:case="'적금'" width="16" height="24" viewBox="0 0 16 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M2 7C2 6.44687 1.55313 6 1 6C0.446875 6 0 6.44687 0 7V17.5C0 18.8813 1.11875 20 2.5 20H15C15.5531 20 16 19.5531 16 19C16 18.4469 15.5531 18 15 18H2.5C2.225 18 2 17.775 2 17.5V7ZM14.7063 9.70625C15.0969 9.31563 15.0969 8.68125 14.7063 8.29063C14.3156 7.9 13.6812 7.9 13.2906 8.29063L10 11.5844L8.20625 9.79063C7.81563 9.4 7.18125 9.4 6.79063 9.79063L3.29063 13.2906C2.9 13.6812 2.9 14.3156 3.29063 14.7063C3.68125 15.0969 4.31563 15.0969 4.70625 14.7063L7.5 11.9156L9.29375 13.7094C9.68437 14.1 10.3188 14.1 10.7094 13.7094L14.7094 9.70937L14.7063 9.70625Z" fill="#10B981"/>
                                    </svg>

                                    <!-- 펀드 -->
                                    <svg th:case="'펀드'" width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M9.5 7.5V0.51875C9.5 0.2375 9.71875 0 10 0C13.8656 0 17 3.13438 17 7C17 7.28125 16.7625 7.5 16.4813 7.5H9.5ZM1 8.5C1 4.70937 3.81562 1.57187 7.46875 1.07187C7.75625 1.03125 8 1.2625 8 1.55313V9L12.8906 13.8906C13.1 14.1 13.0844 14.4438 12.8438 14.6125C11.6187 15.4875 10.1187 16 8.5 16C4.35938 16 1 12.6438 1 8.5ZM17.45 9C17.7406 9 17.9688 9.24375 17.9312 9.53125C17.6906 11.2781 16.85 12.8312 15.6219 13.9781C15.4344 14.1531 15.1406 14.1406 14.9594 13.9563L10 9H17.45Z" fill="#9333EA"/>
                                    </svg>

                                    <!-- 기본값(안전장치) -->
                                    <svg th:case="*"
                                         width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="7" stroke="#9CA3AF"/></svg>
                                </th:block>
                            </div>
                            <div style="margin-left: 15px;">
                                <div style="width:100px;color: #2B2F36; font-size: 16px;"><span style="width: 100px;" th:text="${contractList[i+1].pname}"></span></div>
                                <div style="color: #6B7280; font-size: 14px;">만기일: <span th:text="${#temporals.format(contractList[i+1].pend, 'yyyy.MM.dd')}"></span></div>
                            </div>
                            <div style="margin-left: 110px;">
                              <input type="radio" name="what"
                                     th:id="|prod${i+2}|"
                                     th:value="${i+1}"
                                     th:data-pname="${contractList[i+1].pname}"
                                     th:data-ptype="${contractList[i+1].ptype}"
                                     th:data-balance="${contractList[i+1].pbalance}"
                                     th:data-pcnapw="${contractList[i+1].pcnapw}"
                                     th:data-pacc="${contractList[i+1].pacc}"
                                     style="scale: calc(1.7); cursor: pointer;">
                            </div>
                          </div>
                          <div style="display: flex; margin-top: 20px;">
                            <div>현재 잔액</div>
                            <div style="margin-left: auto;"><span th:text="${#numbers.formatInteger(contractList[i+1].pbalance, 3, 'COMMA')}"></span>원</div>
                          </div>
                          <div style="display: flex; margin-top: 15px;">
                            <div>연 이자율</div>
                            <div style="margin-left: auto;"><span th:text="${contractList[i+1].phirate}"></span>%</div>
                          </div>
                          </label>
                          <div style="text-align: center; margin-top: 20px;">
                            <div><a href="#" style="text-decoration: none; color: red;">자세히 보기</a></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div th:if="${i + 2 < contractList.size()}"
                     th:object="${contractList[i + 2]}"
                        style="background-color: white; width: 357px; border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB;">
                  <div style="padding: 21px;">
                    <div>
                      <div style="display: flex;">
                        <div style="">
                          <label th:for="|prod${i+3}|" class="prod-select" style="display:block; cursor:pointer;">
                          <div style="display: flex; justify-content: center;">
                            <div th:styleappend="
                                                ${#strings.equalsIgnoreCase(contractList[i+2].ptype,'IRP')}  ? 'background-color:#e9ecf4;' :
                                                (${#strings.equalsIgnoreCase(contractList[i+2].ptype,'적금')}  ? 'background-color:#eaf8f3;' :
                                                (${#strings.equalsIgnoreCase(contractList[i+2].ptype,'펀드')} ? 'background-color:#f2e8ff;' :
                                                                                                              'background-color:#f3f4f6;'))
                                              "
                                    style="display: flex; justify-content: center; align-items: center; border-radius: 8px; background-color: #e9f8fb; width: 48px; height: 48px;">
                                <th:block th:switch="${#strings.toUpperCase(contractList[i+2].ptype)}">

                                    <!-- IRP -->
                                    <svg th:case="'IRP'" width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_257_250)">
                                            <path d="M12.5 3V3.02187C12.3344 3.00937 12.1687 3 12 3H8C7.48438 3 6.98438 3.06562 6.50625 3.1875C6.50312 3.125 6.5 3.0625 6.5 3C6.5 1.34375 7.84375 0 9.5 0C11.1562 0 12.5 1.34375 12.5 3ZM12 4C12.1094 4 12.2188 4.00313 12.325 4.00938C12.4563 4.01875 12.5875 4.03125 12.7188 4.05C13.2688 3.40938 14.0875 3 15 3H15.3594C15.6844 3 15.9219 3.30625 15.8438 3.62188L15.4125 5.34688C15.9062 5.80938 16.3094 6.37187 16.5844 7H17C17.5531 7 18 7.44688 18 8V11C18 11.5531 17.5531 12 17 12H16C15.7156 12.3781 15.3781 12.7156 15 13V15C15 15.5531 14.5531 16 14 16H13C12.4469 16 12 15.5531 12 15V14H8V15C8 15.5531 7.55312 16 7 16H6C5.44688 16 5 15.5531 5 15V13C3.90937 12.1812 3.16563 10.9281 3.025 9.5H2.125C0.95 9.5 0 8.55 0 7.375C0 6.2 0.95 5.25 2.125 5.25H2.25C2.66563 5.25 3 5.58437 3 6C3 6.41563 2.66563 6.75 2.25 6.75H2.125C1.78125 6.75 1.5 7.03125 1.5 7.375C1.5 7.71875 1.78125 8 2.125 8H3.1C3.47812 6.13125 4.90312 4.64062 6.73438 4.1625C7.1375 4.05625 7.5625 4 8 4H12ZM14 8.25C14 8.05109 13.921 7.86032 13.7803 7.71967C13.6397 7.57902 13.4489 7.5 13.25 7.5C13.0511 7.5 12.8603 7.57902 12.7197 7.71967C12.579 7.86032 12.5 8.05109 12.5 8.25C12.5 8.44891 12.579 8.63968 12.7197 8.78033C12.8603 8.92098 13.0511 9 13.25 9C13.4489 9 13.6397 8.92098 13.7803 8.78033C13.921 8.63968 14 8.44891 14 8.25Z" fill="#1E3A8A"/>
                                        </g>
                                        <defs><clipPath id="clip0_257_250"><path d="M0 0H18V16H0V0Z" fill="white"/></clipPath></defs>
                                    </svg>

                                    <!-- 적금 -->
                                    <svg th:case="'적금'" width="16" height="24" viewBox="0 0 16 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M2 7C2 6.44687 1.55313 6 1 6C0.446875 6 0 6.44687 0 7V17.5C0 18.8813 1.11875 20 2.5 20H15C15.5531 20 16 19.5531 16 19C16 18.4469 15.5531 18 15 18H2.5C2.225 18 2 17.775 2 17.5V7ZM14.7063 9.70625C15.0969 9.31563 15.0969 8.68125 14.7063 8.29063C14.3156 7.9 13.6812 7.9 13.2906 8.29063L10 11.5844L8.20625 9.79063C7.81563 9.4 7.18125 9.4 6.79063 9.79063L3.29063 13.2906C2.9 13.6812 2.9 14.3156 3.29063 14.7063C3.68125 15.0969 4.31563 15.0969 4.70625 14.7063L7.5 11.9156L9.29375 13.7094C9.68437 14.1 10.3188 14.1 10.7094 13.7094L14.7094 9.70937L14.7063 9.70625Z" fill="#10B981"/>
                                    </svg>

                                    <!-- 펀드 -->
                                    <svg th:case="'펀드'" width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M9.5 7.5V0.51875C9.5 0.2375 9.71875 0 10 0C13.8656 0 17 3.13438 17 7C17 7.28125 16.7625 7.5 16.4813 7.5H9.5ZM1 8.5C1 4.70937 3.81562 1.57187 7.46875 1.07187C7.75625 1.03125 8 1.2625 8 1.55313V9L12.8906 13.8906C13.1 14.1 13.0844 14.4438 12.8438 14.6125C11.6187 15.4875 10.1187 16 8.5 16C4.35938 16 1 12.6438 1 8.5ZM17.45 9C17.7406 9 17.9688 9.24375 17.9312 9.53125C17.6906 11.2781 16.85 12.8312 15.6219 13.9781C15.4344 14.1531 15.1406 14.1406 14.9594 13.9563L10 9H17.45Z" fill="#9333EA"/>
                                    </svg>

                                    <!-- 기본값(안전장치) -->
                                    <svg th:case="*"
                                         width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="7" stroke="#9CA3AF"/></svg>
                                </th:block>
                            </div>
                            <div style="margin-left: 15px;">
                                <div style="width:100px; color: #2B2F36; font-size: 16px;"><span  th:text="${contractList[i+2].pname}"></span></div>
                                <div style="color: #6B7280; font-size: 14px;">만기일: <span th:text="${#temporals.format(contractList[i+2].pend, 'yyyy.MM.dd')}"></span></div>
                            </div>
                            <div style="margin-left: 110px;">
                              <input type="radio" name="what"
                                     th:id="|prod${i+3}|"
                                     th:value="${i+2}"
                                     th:data-pname="${contractList[i+2].pname}"
                                     th:data-ptype="${contractList[i+2].ptype}"
                                     th:data-balance="${contractList[i+2].pbalance}"
                                     th:data-pcnapw="${contractList[i+2].pcnapw}"
                                     th:data-pacc="${contractList[i+2].pacc}"
                                     style="scale: calc(1.7); cursor: pointer;">
                            </div>
                          </div>
                          <div style="display: flex; margin-top: 20px;">
                            <div>현재 잔액</div>
                            <div style="margin-left: auto;"><span th:text="${#numbers.formatInteger(contractList[i+2].pbalance, 3, 'COMMA')}"></span>원</div>
                          </div>
                          <div style="display: flex; margin-top: 15px;">
                            <div>연 이자율</div>
                            <div style="margin-left: auto;"><span th:text="${contractList[i+2].phirate}"></span>%</div>
                          </div>
                          </label>
                          <div style="text-align: center; margin-top: 20px;">
                            <div><a href="#" style="text-decoration: none; color: red;">자세히 보기</a></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
            </div>
          </div>
          <div style="margin-top:25px; padding:30px; box-sizing: border-box; background-color: #FEF2F2; width: 100%; border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #FECACA;">
            <div style="display: flex;">
              <div style="margin-right: 15px; margin-top: 5px;">
                <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.99982 1C8.44357 1 8.85295 1.23437 9.07795 1.61875L15.8279 13.1187C16.0561 13.5062 16.0561 13.9844 15.8342 14.3719C15.6123 14.7594 15.1967 15 14.7498 15H1.24982C0.802948 15 0.387323 14.7594 0.165448 14.3719C-0.0564269 13.9844 -0.0533019 13.5031 0.171698 13.1187L6.9217 1.61875C7.1467 1.23437 7.55607 1 7.99982 1ZM7.99982 5C7.5842 5 7.24982 5.33437 7.24982 5.75V9.25C7.24982 9.66562 7.5842 10 7.99982 10C8.41545 10 8.74982 9.66562 8.74982 9.25V5.75C8.74982 5.33437 8.41545 5 7.99982 5ZM8.99982 12C8.99982 11.7348 8.89447 11.4804 8.70693 11.2929C8.51939 11.1054 8.26504 11 7.99982 11C7.73461 11 7.48025 11.1054 7.29272 11.2929C7.10518 11.4804 6.99982 11.7348 6.99982 12C6.99982 12.2652 7.10518 12.5196 7.29272 12.7071C7.48025 12.8946 7.73461 13 7.99982 13C8.26504 13 8.51939 12.8946 8.70693 12.7071C8.89447 12.5196 8.99982 12.2652 8.99982 12Z" fill="#D91A1A"/>
                </svg>
              </div>
              <div>
                <div style="font-size: 20px;">해지 전 확인사항</div>
                <div style="margin-top: 20px;"><span style="color:red;">•</span>&nbsp;&nbsp;만기 전 해지 시 약정 이자율보다 낮은 중도해지 이자율이 적용됩니다.</div>
                <div style="margin-top: 10px;"><span style="color:red;">•</span>&nbsp;&nbsp;펀드 상품의 경우 해지 수수료가 발생할 수 있습니다.</div>
                <div style="margin-top: 10px;"><span style="color:red;">•</span>&nbsp;&nbsp;해지 신청 후 취소가 불가능하오니 신중하게 결정해 주세요.</div>
                <div class="agree-option" style="display:flex; align-items:center; margin-top:20px; gap:8px;">
                  <input type="checkbox" id="agreeAll" style="width:20px; height:20px; margin-top: 6px;">
                  <label for="agreeAll" style="cursor:inherit;">위 내용을 모두 확인했습니다.</label>
                </div>
              </div>
            </div>
          </div>
          <div style="margin-top:25px; padding:30px; box-sizing: border-box; background-color: white; width: 100%;border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB;">
            <div style="font-size:20px; color:#2B2F36;">본인 인증</div>
            <div style="font-size: 16px; color: #4B5563; margin-top: 20px;">인증 방법 선택</div>
            <div style="display: flex; margin-top: 20px;">
              <div style="display: flex; gap: 25px;">
                <div class="auth-option" style="padding-left:17px; display: flex; align-items: center; width: 538px; height: 60px; border:1px solid #D1D5DB; border-radius: 10px;">
                  <div style="margin-right: 15px;">
                    <input type="radio" name="auth" id="" style="transform: scale(1.7);">
                  </div>
                  <svg width="16" height="18" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_543_217)">
                    <path d="M4.5 4.5V6H9.5V4.5C9.5 3.11875 8.38125 2 7 2C5.61875 2 4.5 3.11875 4.5 4.5ZM2.5 6V4.5C2.5 2.01562 4.51562 0 7 0C9.48438 0 11.5 2.01562 11.5 4.5V6H12C13.1031 6 14 6.89687 14 8V14C14 15.1031 13.1031 16 12 16H2C0.896875 16 0 15.1031 0 14V8C0 6.89687 0.896875 6 2 6H2.5Z" fill="#4B5563"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_543_217">
                    <path d="M0 0H14V16H0V0Z" fill="white"/>
                    </clipPath>
                    </defs>
                  </svg>
                  <div style="margin-left: 8px;color:#2B2F36; font-size: 18px;">계좌 비밀번호</div>
                </div>
                <div class="auth-option" style="padding-left:17px; display: flex; align-items: center; width: 538px; height: 60px; border:1px solid #D1D5DB; border-radius: 10px;">
                  <div style="margin-right: 15px;">
                    <input type="radio" name="auth" id="" style="transform: scale(1.7);">
                  </div>
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_543_220)">
                    <path d="M1.5 8C1.5 4.40938 4.40938 1.5 8 1.5C9.97188 1.5 11.7375 2.37812 12.9312 3.76562C13.2 4.08125 13.675 4.11562 13.9875 3.84687C14.3 3.57812 14.3375 3.10313 14.0688 2.79063C12.6031 1.08125 10.4281 0 8 0C3.58125 0 0 3.58125 0 8V9.25C0 9.66562 0.334375 10 0.75 10C1.16562 10 1.5 9.66562 1.5 9.25V8ZM15.8281 6.34688C15.7437 5.94063 15.3438 5.68125 14.9406 5.76875C14.5375 5.85625 14.275 6.25313 14.3625 6.65625C14.4531 7.09062 14.5031 7.54063 14.5031 8.00313V9.25313C14.5031 9.66875 14.8375 10.0031 15.2531 10.0031C15.6687 10.0031 16.0031 9.66875 16.0031 9.25313V8C16.0031 7.43437 15.9438 6.88125 15.8313 6.34688H15.8281ZM8 2.5C7.40625 2.5 6.83125 2.59375 6.29688 2.76875C5.82188 2.925 5.7125 3.50938 6.0375 3.89062C6.25938 4.15 6.625 4.22812 6.95625 4.1375C7.2875 4.04688 7.6375 4 8 4C10.2094 4 12 5.79063 12 8V8.77812C12 9.56563 11.9531 10.35 11.8625 11.1313C11.8094 11.5875 12.1562 12 12.6187 12C12.9875 12 13.3031 11.7313 13.3469 11.3656C13.45 10.5094 13.5031 9.64688 13.5031 8.78125V8C13.5031 4.9625 11.0406 2.5 8.00313 2.5H8ZM4.70937 4.64687C4.425 4.31562 3.91875 4.29063 3.65 4.63438C2.92813 5.5625 2.5 6.73125 2.5 8V8.77812C2.5 9.53438 2.41875 10.2906 2.25625 11.025C2.15 11.5125 2.50312 12 3.00312 12C3.33125 12 3.625 11.7812 3.69688 11.4594C3.89688 10.5813 4 9.68437 4 8.77812V8C4 7.15 4.26562 6.3625 4.71562 5.71562C4.94062 5.39062 4.96562 4.94688 4.70937 4.64687ZM8 5C6.34375 5 5 6.34375 5 8V8.77812C5 9.9 4.85625 11.0125 4.56875 12.0938C4.45 12.5406 4.77812 13 5.24062 13C5.5375 13 5.8 12.8063 5.87813 12.5188C6.20625 11.3 6.375 10.0437 6.375 8.77812V8C6.375 7.10313 7.10313 6.375 8 6.375C8.89688 6.375 9.625 7.10313 9.625 8V8.77812C9.625 9.9125 9.51562 11.0406 9.3 12.15C9.21562 12.5844 9.54062 13 9.98125 13C10.3 13 10.575 12.7812 10.6375 12.4688C10.8781 11.2563 11 10.0219 11 8.77812V8C11 6.34375 9.65625 5 8 5ZM8.75 8C8.75 7.58437 8.41562 7.25 8 7.25C7.58437 7.25 7.25 7.58437 7.25 8V8.77812C7.25 10.65 6.90625 12.5063 6.23438 14.2531L6.05 14.7312C5.9 15.1187 6.09375 15.5531 6.48125 15.7C6.86875 15.8469 7.30312 15.6562 7.45 15.2688L7.63438 14.7906C8.37187 12.8719 8.75 10.8344 8.75 8.77812V8Z" fill="#4B5563"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_543_220">
                    <path d="M0 0H16V16H0V0Z" fill="white"/>
                    </clipPath>
                    </defs>
                  </svg>
                  <div style="margin-left: 8px;color:#2B2F36; font-size: 18px;">간편 인증</div>
                </div>
              </div>
          </div>
          <div style="font-size: 16px; color: #4B5563; margin-top: 20px;">비밀번호 입력</div>
          <div>
            <div class="pw-wrap">
              <input type="password" id="accountPw" class="pw-input" placeholder="계좌 비밀번호를 입력하세요" style="margin-top: -1px; box-sizing: border-box; outline:none; padding-left:15px; font-size: 16px; width: 100%; height: 50px; border:1px solid #D1D5DB; border-radius: 6px;">
              <!-- 주신 아이콘 버튼 그대로 사용, 대상은 위 input의 id -->
              <button class="eye-btn" data-target="accountPw" aria-label="비밀번호 보기/가리기">
                <!-- (아이콘 SVG 원문 그대로) -->
                <svg width="16" height="20" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g clip-path="url(#clip0_185_295)">
                    <path d="M7.8748 5.9375C6.09199 5.9375 4.62637 6.74688 3.50254 7.78867C2.44981 8.76758 1.72246 9.92969 1.35059 10.75C1.72246 11.5703 2.4498 12.7324 3.4998 13.7113C4.62637 14.7531 6.09199 15.5625 7.8748 15.5625C9.65762 15.5625 11.1232 14.7531 12.2471 13.7113C13.2998 12.7324 14.0271 11.5703 14.399 10.75C14.0271 9.92969 13.2998 8.76758 12.2498 7.78867C11.1232 6.74688 9.65762 5.9375 7.8748 5.9375ZM2.6084 6.82891C3.89629 5.63125 5.66543 4.625 7.8748 4.625C10.0842 4.625 11.8533 5.63125 13.1412 6.82891C14.4209 8.01836 15.2768 9.4375 15.6842 10.4137C15.7744 10.6297 15.7744 10.8703 15.6842 11.0863C15.2768 12.0625 14.4209 13.4844 13.1412 14.6711C11.8533 15.8687 10.0842 16.875 7.8748 16.875C5.66543 16.875 3.89629 15.8687 2.6084 14.6711C1.32871 13.4844 0.472852 12.0625 0.0681641 11.0863C-0.0220703 10.8703 -0.0220703 10.6297 0.0681641 10.4137C0.472852 9.4375 1.32871 8.01562 2.6084 6.82891ZM7.8748 12.9375C9.0834 12.9375 10.0623 11.9586 10.0623 10.75C10.0623 9.54141 9.0834 8.5625 7.8748 8.5625C7.85566 8.5625 7.83926 8.5625 7.82012 8.5625C7.85566 8.70195 7.8748 8.84961 7.8748 9C7.8748 9.96523 7.09004 10.75 6.1248 10.75C5.97441 10.75 5.82676 10.7309 5.6873 10.6953C5.6873 10.7145 5.6873 10.7309 5.6873 10.75C5.6873 11.9586 6.66621 12.9375 7.8748 12.9375ZM7.8748 7.25C8.80306 7.25 9.6933 7.61875 10.3497 8.27513C11.0061 8.9315 11.3748 9.82174 11.3748 10.75C11.3748 11.6783 11.0061 12.5685 10.3497 13.2249C9.6933 13.8813 8.80306 14.25 7.8748 14.25C6.94655 14.25 6.05631 13.8813 5.39993 13.2249C4.74355 12.5685 4.3748 11.6783 4.3748 10.75C4.3748 9.82174 4.74355 8.9315 5.39993 8.27513C6.05631 7.61875 6.94655 7.25 7.8748 7.25Z" fill="#9CA3AF"/>
                  </g>
                  <defs><clipPath id="clip0_185_295"><path d="M0 3.75H15.75V17.75H0V3.75Z" fill="white"/></clipPath></defs>
                </svg>
              </button>
            </div>
          </div>
          </div>
          <div style="margin-top:25px; padding:30px; box-sizing: border-box; background-color: white; width: 100%;border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB;">
            <div style="font-size:20px; color:#2B2F36;">해지 신청 요약</div>
            <div style="font-size: 16px; color: #4B5563; margin-top: 25px;">
              <div style="display: flex;">
                <div style="margin-left: 7px;">선택 상품</div>
                <div style="margin-left: auto; margin-right: 10px;"><span id="sumProd">-</span></div>
              </div>
              <hr style="margin-top: 12px;">
            </div>
            <div style="font-size: 16px; color: #4B5563; margin-top: 25px;">
              <div style="display: flex;">
                <div style="margin-left: 7px;">해지 금액</div>
                <div style="margin-left: auto; margin-right: 10px;"><span id="sumAmt">0원</span></div>
              </div>
              <hr style="margin-top: 12px;">
            </div>
            <div style="font-size: 16px; color: #4B5563; margin-top: 25px;">
              <div style="display: flex;">
                <div style="margin-left: 7px;">수령 계좌</div>
                <div style="margin-left: auto; margin-right: 10px;">부산은행 <span id="sumAcct">321-654-78901</span></div>
              </div>
              <hr style="margin-top: 12px;">
            </div>
            <div style="font-size: 16px; color: #4B5563; margin-top: 25px;">
              <div style="display: flex;">
                <div style="margin-left: 7px;">처리 예정일</div>
                <div style="margin-left: auto; margin-right: 10px;"><span id="sumDate">-</span></div>
              </div>
              <hr style="margin-top: 12px;">
            </div>
          </div>
      </div>
        <form id="cancelForm" th:action="@{/mypage/prod/cancel}" method="post">
            <input type="hidden" name="pacc" id="fPacc">
            <input type="hidden" name="pbalance" id="fAmount">
            <input type="hidden" name="recvAcc" id="fRecvAcct" value="321-654-78901">
        </form>
      <div style="display: flex; gap: 20px; margin-top: 25px;">
        <div>
          <button th:onclick="|location.href='@{/mypage/prod}'|" class="btn-pressable btn-sheen" style="box-sizing: border-box; width: 590px; height: 42px; border:none; border-radius: 8px; cursor: pointer; border:1px solid #D1D5DB; background-color: white;">취소</button>
        </div>
        <div>
          <button disabled class="btn-register" id="btnFinal" style="width: 590px;">최종 해지 신청</button>
        </div>
      </div>
    </div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 금액 포맷
            const fmtWon = n => Number(n || 0).toLocaleString('ko-KR') + '원';
            // 오늘 + n일 → "YYYY년 M월 D일"
            const afterDays = (n) => {
                const d = new Date();
                d.setDate(d.getDate() + n);
                return `${d.getFullYear()}년 ${d.getMonth()+1}월 ${d.getDate()}일`;
            };

            const $sumProd = document.getElementById('sumProd');
            const $sumAmt  = document.getElementById('sumAmt');
            const $sumDate = document.getElementById('sumDate');
            const $sumAcct = document.getElementById('sumAcct');

            // 수령계좌 고정
            $sumAcct.textContent = '321-654-78901';

            // 상품 라디오 선택 시 요약 업데이트
            document.querySelectorAll('input[type="radio"][name="what"]').forEach(r => {
                r.addEventListener('change', () => {
                    if (!r.checked) return;

                    const { pname, ptype, balance } = r.dataset; // 라디오에 data-*가 심어져 있어야 함(아래 참고)
                    $sumProd.textContent = pname || ptype || '-';
                    $sumAmt.textContent  = fmtWon(balance);
                    $sumDate.textContent = afterDays(7); // 항상 현재 기준 +7일
                });
            });

            // 최초 체크값 반영
            const init = document.querySelector('input[type="radio"][name="what"]:checked');
            if (init) init.dispatchEvent(new Event('change', { bubbles: true }));
            else $sumDate.textContent = afterDays(7); // 선택 전에도 미리 보여주고 싶다면
        });
    </script>
    <footer>
        <div th:replace="~{layouts/footer.html}"></div>
    </footer>

  <script>
    fetch('https://api.ipify.org?format=json')
      .then(res => res.json())
      .then(data => {
        document.getElementById('ip').textContent = `${data.ip}`;
      })
      .catch(err => {
        document.getElementById('ip').textContent = 'IP를 가져오지 못했습니다.';
        console.error(err);
      });
  </script>
    <script>
    // 요약 카드의 '계좌이체' 카드 클릭 시 모달 열기
    document.addEventListener('DOMContentLoaded', () => {
      const transferCard = document.getElementById('transfer-card'); // ← 방금 단 id
      if (transferCard) {
        transferCard.addEventListener('click', (e) => {
          e.preventDefault();          // 앵커 기본 동작 막기
          overlay.classList.add('show'); // 모달 보이기
          resetFlow();                 // 1단계로 초기화
        });
      }
    });
  </script>
    <script>
        window.addEventListener('DOMContentLoaded', () => {
        const BADGE = {
            'Royal VIP': { color:'white', bg:'#3c4249', w:57, h:22 },
            'Gold VIP'  : { color:'#B8860B', bg:'#FFF6DC', w:46, h:24 },
            'Silver VIP': { color:'#6B7280', bg:'#F3F4F6', w:46, h:24 },
            'Green VIP' : { color:'#15803D', bg:'#DCFCE7', w:46, h:24 },
            'Family'    : { color:'#2563EB', bg:'#DBEAFE', w:46, h:24 },
        };

        document.querySelectorAll('.status-badge').forEach(el => {
            const key = el.textContent.trim();
            const s = BADGE[key];
            if (!s) return;

            Object.assign(el.style, {
            display: 'inline-flex',
            justifyContent: 'center',
            alignItems: 'center',
            padding: '0 8px',
            fontSize: '12px',
            fontWeight: '500',
            lineHeight: '1',
            color: s.color,
            backgroundColor: s.bg,
            borderRadius: '20px',
            height: s.h + 'px',
            minWidth: s.w + 'px',
            boxSizing: 'border-box',
            });
        });
        });
    </script>
    <script>
        // ---- 마스킹 규칙 ----
        function maskCustomerNo(raw) {
            // 숫자만 추출 후 4-4-나머지 형태로 다시 묶고, 앞 8자리는 ****-****
            const digits = raw.replace(/\D/g, "");
            const a = digits.slice(0, 4);
            const b = digits.slice(4, 8);
            const rest = digits.slice(8); // 나머지
            const last = rest ? rest : "";
            return `****-****-${last}`;
        }

        function maskEmail(raw) {
            const [local, domain = ""] = raw.split("@");
            const shown = (local || "").slice(0, 3);
            const maskedLen = Math.max((local || "").length - 3, 0);
            const masked = "*".repeat(maskedLen);
            return `${shown}${masked}${domain ? "@" + domain : ""}`;
        }

        function normalizePhoneDigits(raw) {
            // 숫자만 추출 후 한국형 기본 포맷(3-4-4 or 2-3-4 등)으로 리턴
            const d = raw.replace(/\D/g, "");
            // 02로 시작(서울) 케이스
            if (d.startsWith("02")) {
            const a = d.slice(0, 2);
            const b = d.length === 9 ? d.slice(2, 5) : d.slice(2, 6);
            const c = d.slice(2 + b.length);
            return [a, b, c];
            }
            // 그 외(010, 011 등)
            const a = d.slice(0, 3);
            const b = d.length >= 10 ? d.slice(3, d.length - 4) : d.slice(3, d.length - 4); // 중간 전부
            const c = d.slice(-4);
            return [a, b, c];
        }

        function formatPhone(groups) {
            return groups.filter(Boolean).join("-");
        }

        function maskPhone(raw) {
            const groups = normalizePhoneDigits(raw);
            // 가운데 그룹만 **** 고정
            if (groups.length >= 2) groups[1] = "****";
            return formatPhone(groups);
        }

        // ---- 렌더링 & 토글 ----
        function renderMasked(el) {
            const type = el.dataset.type;
            const raw = el.dataset.raw || "";
            let masked = raw;
            if (type === "custno") masked = maskCustomerNo(raw);
            else if (type === "email") masked = maskEmail(raw);
            else if (type === "mobile") masked = maskPhone(raw);
            el.textContent = masked;
            el.dataset.state = "masked";
        }

        function renderRaw(el) {
            el.textContent = el.dataset.raw || "";
            el.dataset.state = "visible";
        }

        function toggleVisibility(targetId) {
            const el = document.getElementById(targetId);
            if (!el) return;
            if (el.dataset.state === "visible") renderMasked(el);
            else renderRaw(el);
        }

        // 초기 마스킹
        document.querySelectorAll(".maskable").forEach(renderMasked);

        // 눈 아이콘 클릭 핸들러
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.eye-btn').forEach(btn => {
                const target = document.getElementById(btn.dataset.target);
                if (!target) return;

                const togglePw = () => {
                    const isHidden = target.type === 'password';
                    target.type = isHidden ? 'text' : 'password';
                    btn.setAttribute('aria-pressed', String(isHidden));
                    btn.setAttribute('aria-label', isHidden ? '비밀번호 가리기' : '비밀번호 보기');
                    // 커서 유지 UX
                    const pos = target.selectionStart ?? target.value.length;
                    target.setSelectionRange(pos, pos);
                    target.focus();
                };

                btn.addEventListener('click', togglePw);
                btn.addEventListener('keydown', e => {
                    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); togglePw(); }
                });
            });
        });
    </script>
    <script>
  // "보유계좌 목록" 테이블의 5번째 열(잔액)만 3자리 콤마 적용
  document.addEventListener('DOMContentLoaded', function () {
    const table = document.getElementById('accounts-table');
    if (!table) return;

    // 헤더를 제외한 모든 행의 5번째 셀(td:nth-child(5)) 대상
    table.querySelectorAll('tr td:nth-child(5)').forEach(td => {
      const raw = (td.textContent || '').trim();
      if (/^\d+$/.test(raw)) { // 숫자만 있는 경우에만 포맷
        td.textContent = Number(raw).toLocaleString('ko-KR');
      }
    });
  });
</script>
<script>
  // 요약 카드(#summary-cards) 안의 텍스트만 가공
  document.addEventListener('DOMContentLoaded', () => {
    const root = document.getElementById('summary-cards');
    if (!root) return;

    // 텍스트 노드만 순회
    const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
      acceptNode(node) {
        const t = node.nodeValue;
        return (!t || !t.trim()) ? NodeFilter.FILTER_REJECT : NodeFilter.FILTER_ACCEPT;
      }
    });

    const nodes = [];
    for (let n = walker.nextNode(); n; n = walker.nextNode()) nodes.push(n);

    nodes.forEach(node => {
      let text = node.nodeValue;

      // 1) 이름 마스킹: '김철수님/님께' → '김○○님/님께'
      text = text.replace(/([가-힣])([가-힣]{1,3})(?=님(?:께)?)/g,
        (_, s, rest) => s + '○'.repeat(rest.length)
      );

      // 2) 금액 3자리 콤마: '16480000원', '3000000 원' 등
      // - '원' 앞의 모든 공백(일반/개행/NBSP 등)을 허용
      // - 이미 콤마가 있어도 정상화
      text = text.replace(/(\d[\d,]{3,})(?=(?:\s|\u00A0)*원)/g, (m) => {
        const num = m.replace(/,/g, '');
        return Number(num).toLocaleString('ko-KR');
      });

      node.nodeValue = text;
    });
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.amount').forEach(amountEl => {
      // 같은 행(부모) 안의 아이콘 자리 찾기
      const row = amountEl.parentElement;
      const iconEl = row ? row.querySelector('.icon') : null;

      // 숫자 파싱
      const raw = amountEl.textContent.replace(/원/g, '').replace(/,/g, '').trim();
      const num = Number(raw);
      if (!Number.isFinite(num)) return;

      // 표시용 문자열(+/- + 콤마)
      const fmt = Math.abs(num).toLocaleString('ko-KR');
      if (num > 0) {
        amountEl.textContent = `+${fmt}원`;
        if (iconEl) setIcon(iconEl, 'plus');
      } else if (num < 0) {
        amountEl.textContent = `-${fmt}원`;
        if (iconEl) setIcon(iconEl, 'minus');
      } else {
        amountEl.textContent = `0원`;
        if (iconEl) iconEl.innerHTML = ''; // 0원은 아이콘 없음(원하면 바꿔도 됨)
      }
    });

    // 아이콘 세팅: 숨겨둔 SVG를 복제해 id 제거 후 표시
    function setIcon(holder, type) {
      const tpl = document.getElementById(type === 'plus' ? 'icon-plus' : 'icon-minus');
      if (!tpl) return;
      const clone = tpl.cloneNode(true);
      clone.removeAttribute('id');
      clone.style.display = ''; // 보이게
      holder.replaceChildren(clone);
    }
  });
</script>
<script>
  // 숫자→콤마 포맷터 (부호 유지)
  function formatNumberKR(raw) {
    const sign = raw.startsWith('+') || raw.startsWith('-') ? raw[0] : '';
    const digits = raw.replace(/[^\d]/g, '');
    return sign + Number(digits || '0').toLocaleString('ko-KR');
  }

  // .money-scope 내부에서만 "…원"으로 끝나는 숫자에 콤마 적용
  document.addEventListener('DOMContentLoaded', () => {
    // 여러 개의 .money-scope 선택
    const scopes = document.querySelectorAll('.money-scope');
    if (!scopes.length) return;

    const skip = new Set(['SCRIPT', 'STYLE', 'TEXTAREA', 'CODE']);

    // 각 영역별로 처리
    scopes.forEach(scope => {
      const walker = document.createTreeWalker(scope, NodeFilter.SHOW_TEXT, {
        acceptNode(node) {
          if (skip.has(node.parentNode?.nodeName)) return NodeFilter.FILTER_REJECT;
          const t = node.nodeValue;
          // 숫자 있고 '원'이 있을 때만 후보
          return (/\d/.test(t) && /원/.test(t))
            ? NodeFilter.FILTER_ACCEPT
            : NodeFilter.FILTER_REJECT;
        }
      });

      const targets = [];
      for (let n = walker.nextNode(); n; n = walker.nextNode()) targets.push(n);

      targets.forEach(node => {
        node.nodeValue = node.nodeValue.replace(
          /([+\-]?\d[\d,]*)(?=(?:\s|\u00A0)*원)/g, // '원' 앞 숫자(콤마/부호 포함)
          m => formatNumberKR(m)
        );
      });
    });
  });
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const panel = document.querySelector('.money-scope > div[style*="background-color: white"][style*="padding:30px"]');
  const sortSelect = document.getElementById('product-sort');
  if (!panel || !sortSelect) return;

  // 래핑 컨테이너(2열 고정)
  const rows = panel.querySelectorAll(':scope > div[style*="display: flex"][style*="gap: 25px"]');
  const grid = document.createElement('div');
  grid.className = 'products-grid';
  Object.assign(grid.style, {
    display: 'flex',
    flexWrap: 'wrap',
    gap: '25px',
    justifyContent: 'space-between' // 좌우 꽉 채우기
  });

  const headerRow = panel.querySelector(':scope > div[style*="font-size: 18px"]');
  headerRow.after(grid);

  // 카드 이동 + 폭을 2열 비율로 강제
  rows.forEach(r => {
    r.querySelectorAll('.menu-card').forEach(card => {
      // 폭을 고정값(555px)에서 2열 비율로 전환
      card.style.width = 'calc(50% - 12.5px)'; // 12.5px = gap/2
      card.style.boxSizing = 'border-box';     // 보더 포함 계산
      grid.appendChild(card);
    });
    r.remove();
  });

  // --- 이하 정렬 로직 그대로 ---
  function extractBalance(card) {
    const m = card.textContent.match(/([+-]?\d[\d,]*)\s*원/);
    return m ? Number(m[1].replace(/,/g, '')) : 0;
  }
  function extractName(card) {
    const nameEl = card.querySelector('div[style*="font-size: 16px"][style*="color: #2B2F36"]');
    return (nameEl?.textContent || '').trim();
  }
  function extractJoinDate(card) {
    const m = card.textContent.match(/가입일:\s*(\d{4})\.(\d{2})\.(\d{2})/);
    return m ? new Date(`${m[1]}-${m[2]}-${m[3]}T00:00:00`).getTime() : 0;
  }

  const cards = Array.from(grid.querySelectorAll('.menu-card'));
  cards.forEach((card, idx) => {
    card.dataset.index = String(idx);
    card.dataset.balance = String(extractBalance(card));
    card.dataset.name = extractName(card);
    card.dataset.joinTs = String(extractJoinDate(card));
  });

  function applySort(type) {
    const arr = Array.from(grid.querySelectorAll('.menu-card'));
    arr.sort((a, b) => {
      switch (type) {
        case 'high': return b.dataset.balance - a.dataset.balance;
        case 'low' : return a.dataset.balance - b.dataset.balance;
        case 'name': return (a.dataset.name||'').localeCompare(b.dataset.name||'', 'ko');
        case 'new' : return b.dataset.joinTs - a.dataset.joinTs;
        default    : return a.dataset.index - b.dataset.index;
      }
    });
    arr.forEach(card => grid.appendChild(card));
  }

  applySort(sortSelect.value || 'all');
  sortSelect.addEventListener('change', e => applySort(e.target.value));
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const panel = document.getElementById('aiReco');
  if (!panel) return;

  // X 버튼
  const closeBtn = panel.querySelector('[data-close]');
  if (!closeBtn) return;

  // 공간 고정이 더 확실하길 원하면 최초 높이를 최소높이로 잠가도 됨 (선택)
  // const h = panel.getBoundingClientRect().height;
  // panel.style.minHeight = h + 'px';

  const fadeOut = () => {
    panel.classList.add('is-fading');   // opacity만 0으로
    panel.setAttribute('aria-hidden', 'true');
    // transitionend 콜백에서 아무 것도 하지 마세요! (공간 유지 위해)
  };

  closeBtn.style.cursor = 'pointer';
  closeBtn.setAttribute('role', 'button');
  closeBtn.setAttribute('tabindex', '0');
  closeBtn.addEventListener('click', fadeOut);
  closeBtn.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fadeOut(); }
  });
});
</script>


<script>
  // 박스 전체 클릭/키보드로 라디오 선택
  document.addEventListener('DOMContentLoaded', () => {
    const options = document.querySelectorAll('.auth-option');

    function refreshSelectedUI() {
      options.forEach(opt => {
        const r = opt.querySelector('input[type="radio"]');
        opt.classList.toggle('is-selected', r?.checked);
        // 접근성 역할/상태 부여(선택)
        opt.setAttribute('role', 'radio');
        opt.setAttribute('tabindex', '0');
        opt.setAttribute('aria-checked', r?.checked ? 'true' : 'false');
      });
    }

    options.forEach(opt => {
      const radio = opt.querySelector('input[type="radio"]');
      if (!radio) return;

      // 박스 아무 곳이나 클릭 → 해당 라디오 선택
      opt.addEventListener('click', (e) => {
        // 이미 라디오 자체를 클릭한 경우 중복 처리 방지
        if (e.target === radio) return;
        radio.checked = true;
        radio.dispatchEvent(new Event('change', { bubbles: true }));
        refreshSelectedUI();
      });

      // 키보드 접근성: Enter/Space로도 선택
      opt.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          radio.checked = true;
          radio.dispatchEvent(new Event('change', { bubbles: true }));
          refreshSelectedUI();
        }
      });

      // 라디오가 직접 클릭되었을 때도 UI 동기화
      radio.addEventListener('change', refreshSelectedUI);
    });

    // 초기 상태 반영
    refreshSelectedUI();
  });
</script>
    <script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', () => {
    const btnFinal   = document.getElementById('btnFinal');
    const agreeAll   = document.getElementById('agreeAll');
    const pwInput    = document.getElementById('accountPw');
    const prodRadios = document.querySelectorAll('input[name="what"]');
    const authRadios = document.querySelectorAll('input[name="auth"]');
    const toastEl    = document.getElementById('toast');

    // 폼 & hidden
    const form     = document.getElementById('cancelForm');
    const fPacc    = document.getElementById('fPacc');
    const fAmount  = document.getElementById('fAmount');
    const fRecvAcct= document.getElementById('fRecvAcct'); // 기본값 이미 세팅됨

    if (!btnFinal) return;

    // ✅ 버튼 활성화 조건
    function isProductSelected() { return !!document.querySelector('input[name="what"]:checked'); }
    function isAgreeChecked()    { return agreeAll?.checked === true; }
    function isAuthSelected()    { return !!document.querySelector('input[name="auth"]:checked'); }
    function isPasswordFilled()  { return (pwInput?.value || '').trim().length > 0; }

    // ✅ 버튼 상태 갱신
    function updateFinalButton() {
    const canSubmit =
    isProductSelected() &&
    isAgreeChecked()   &&
    isAuthSelected()   &&
    isPasswordFilled();

    btnFinal.disabled = !canSubmit;
    btnFinal.setAttribute('aria-disabled', String(!canSubmit));
        btnFinal.classList.toggle('is-ready', canSubmit);
    btnFinal.style.cursor = canSubmit ? 'pointer' : 'not-allowed';
    }

    // ✅ 토스트 메시지
    function showToast(msg) {
    if (!toastEl) { alert(msg); return; }
    toastEl.textContent = msg;
    toastEl.style.display = 'block';
    requestAnimationFrame(() => toastEl.classList.add('show'));
    setTimeout(() => {
    toastEl.classList.remove('show');
    setTimeout(() => { toastEl.style.display = 'none'; }, 220);
    }, 2200);
    }

    // ✅ 이벤트 바인딩
    agreeAll?.addEventListener('change', updateFinalButton);
    pwInput?.addEventListener('input', updateFinalButton);
    prodRadios.forEach(r => r.addEventListener('change', updateFinalButton));
    authRadios.forEach(r => r.addEventListener('change', updateFinalButton));

    updateFinalButton();

    // ✅ 버튼 클릭 시
    btnFinal.addEventListener('click', (e) => {
        e.preventDefault(); // 기본 클릭 동작 방지 (우리가 직접 submit)
    if (btnFinal.disabled) return;

    const selectedProd = document.querySelector('input[name="what"]:checked');
    if (!selectedProd) return;

        const realPw  = selectedProd.dataset.pcnapw || '';
        const inputPw = (pwInput.value || '').trim();

    // ❌ 비밀번호 불일치
    if (inputPw !== realPw) {
    showToast('비밀번호가 틀립니다.');
    return;
    }

    // hidden 값 채우기 (서버로 보낼 원시값)
    const pacc   = selectedProd.dataset.pacc || '';
    const amount = (selectedProd.dataset.balance || '0').replace(/[, ]/g, ''); // 숫자만

    if (!pacc) {
        showToast('요청값(pacc)을 찾을 수 없습니다.');
        return;
    }

    fPacc.value   = pacc;      // name=pacc
    fAmount.value = amount;    // name=pbalance (해지 금액)
    // fRecvAcct 는 value="321-654-78901" 이미 설정됨

    // ✅ 비밀번호 일치 → 진행
    const prevText = btnFinal.textContent;
    btnFinal.textContent = '처리 중...';
    btnFinal.disabled = true;
    btnFinal.setAttribute('aria-disabled', 'true');
    btnFinal.style.cursor = 'wait';

    showToast('해지 신청이 완료되었습니다.')
    setTimeout(() => {
        form.submit();
    }, 2400);
    });
    });
    </script>
<div id="toast" role="status" aria-live="polite" aria-atomic="true" style="display:none;">
  해지 신청이 완료되었습니다.
</div>
<style>
  /* 완료 토스트 */
#toast{
  position: fixed;
  left: 50%; bottom: 28px;
  transform: translateX(-50%);
  min-width: 260px; max-width: 90vw;
  padding: 14px 16px;
  border-radius: 10px;
  background: #111827; color: #fff;
  box-shadow: 0 10px 24px rgba(0,0,0,.28);
  font-size: 14px; text-align: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity .22s ease, transform .22s ease;
}
#toast.show{
  display: block; opacity: 1; transform: translate(-50%, -4px);
}
</style>

</body>
</html>
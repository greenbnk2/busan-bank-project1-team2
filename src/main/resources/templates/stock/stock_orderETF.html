<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
<!--    <script th:src="@{/js/kiwoom/lightweight-charts.standalone.production.js}"></script>-->
    <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
    <title>stock_orderETF</title>
    <style>
        main {
            background-color: #F6F6F8;
            padding: 10px 20px 80px;
        }
        body {
            background-color: #F6F6F8;
        }
    </style>
    <style>
        /* íƒ­ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .tab-list {
            list-style: none;
            display: flex;
            padding: 0;
            margin: 0;
        }
        .tab-list li {
            margin-right: 20px;
        }
        .tab-link {
            text-decoration: none;
            color: #444;
            padding-bottom: 6px; /* ë°‘ì¤„ê³¼ ê°„ê²© ë§ì¶”ê¸° */
            display: inline-block;
        }
        /* ì„ íƒëœ íƒ­ ìŠ¤íƒ€ì¼ (ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ë°‘ì¤„) */
        .tab-link.active {
            color: #000;
            font-weight: 500;
        }
        .tabs-wrapper {
            position: relative;
            border-bottom: 1px solid grey;
        }
        .tab-underline {
            position: absolute;
            bottom: 0;
            height: 2px;
            background-color: #000;
            left: 0;
            width: 0;
            transition: left 0.2s ease, width 0.2s ease;
        }

        .stock-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            padding: 10px 0;
            border-radius: 12px;
            transition: background-color 0.2s ease;  /* ì„œì„œíˆ ë³€í•˜ë„ë¡ */
        }
        .stock-row:hover {
            background-color: #ECEFF3;  /* ì›í•˜ëŠ” íšŒìƒ‰ìœ¼ë¡œ ì¡°ì ˆ */
        }
        /* í‘œ ì œëª© ì˜ì—­ */
        .stock-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            margin-top: 20px;
        }
        .circle-badge {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            flex-shrink: 0;
        }
    </style>
    <style>
        .rate-up {
            color: #d60000;   /* ë¹¨ê°„ìƒ‰ */
        }
        .rate-down {
            color: #0051c7;   /* íŒŒë€ìƒ‰ */
        }
        .rate-zero {
            color: #555555;   /* ë³´í•© */
        }
    </style>
    <style>
        .stock-table a {
            text-decoration: none;
            color: black;
        }
    </style>
    <style>
        .order-tabs {
            position: relative;
            background: #f3f3f5;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            border-radius: 8px;
            padding: 2px;              /* ì•ˆìª½ ì—¬ë°± */
            font-size: 14px;
        }

        .order-tab {
            text-align: center;
            padding: 5px 0;
            margin-top: 2px;
            z-index: 1;                /* í° ë°•ìŠ¤ë³´ë‹¤ ìœ„ì— ë³´ì´ê²Œ */
            cursor: pointer;
            user-select: none;
        }

        .order-tab.active {
            font-weight: 500;
        }

        .order-tabs-active {
            position: absolute;
            top: 2px;
            bottom: 2px;
            left: 2px;
            border-radius: 6px;
            background: #ffffff;
            z-index: 0;
            transition: left 0.4s ease, width 0.4s ease;
        }
    </style>
    <style>
        .price-tabs {
            position: relative;
            background: #f3f3f5;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            border-radius: 8px;
            padding: 2px;
            font-size: 14px;
            margin-bottom: 14px;
        }

        .price-tab {
            text-align: center;
            padding: 5px 0;
            margin-top: 2px;
            z-index: 1;
            cursor: pointer;
            user-select: none;
        }

        .price-tab.active {
            font-weight: 500;
        }

        .price-tabs-active {
            position: absolute;
            top: 2px;
            bottom: 2px;
            left: 2px;
            border-radius: 6px;
            background: #ffffff;
            z-index: 0;
            transition: left 0.4s ease, width 0.4s ease;
        }
    </style>
    <style>
        .order-section {
            height: 100%;
        }
        .order-section[data-section="wait"] > div {

            display: flex;
            justify-content: center;  /* ê°€ìš´ë° ì •ë ¬ */
            align-items: center;
            text-align: center;
        }
    </style>
    <style>
        .price-tabs {
            position: relative;
            background: #f3f3f5;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            border-radius: 8px;
            padding: 2px;
            font-size: 14px;
            margin-bottom: 14px;
        }

        .price-tab {
            text-align: center;
            padding: 5px 0;
            margin-top: 2px;
            z-index: 1;
            cursor: pointer;
            user-select: none;
        }

        .price-tab.active {
            font-weight: 500;
        }

        .price-tabs-active {
            position: absolute;
            top: 2px;
            bottom: 2px;
            left: 2px;
            border-radius: 6px;
            background: #ffffff;
            z-index: 0;
            transition: left 0.4s ease, width 0.4s ease;
        }
    </style>
    <style>
        .sell-price-tabs {
            position: relative;
            background: #f3f3f5;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            border-radius: 8px;
            padding: 2px;
            font-size: 14px;
            margin-bottom: 14px;
        }

        .sell-price-tab {
            text-align: center;
            padding: 5px 0;
            margin-top: 2px;
            z-index: 1;
            cursor: pointer;
            user-select: none;
        }

        .sell-price-tab.active {
            font-weight: 500;
        }

        .sell-price-tabs-active {
            position: absolute;
            top: 2px;
            bottom: 2px;
            left: 2px;
            border-radius: 6px;
            background: #ffffff;
            z-index: 0;
            transition: left 0.4s ease, width 0.4s ease;
        }
    </style>
    <style>
        .modal-overlay {
            position: fixed;
            inset: 0;
            display: flex;                 /* í•­ìƒ flex, ëŒ€ì‹  íˆ¬ëª…ë„/í¬ì¸í„°ë¡œ ìˆ¨ê¹€ */
            align-items: center;
            justify-content: center;
            z-index: 9999;

            opacity: 0;
            /*visibility: hidden;*/
            pointer-events: none;
            transition: opacity 0.25s ease;
        }

        .order-modal {
            width: 460px;
            max-width: calc(100% - 40px);
            background: #ffffff;
            border-radius: 16px;
            padding: 24px 28px 20px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.18);
            font-size: 15px;
            color: #222;
        }

        /* ë³´ì—¬ì¤„ ë•Œ ë¶™ì´ëŠ” í´ë˜ìŠ¤ */
        .modal-overlay.show {
            opacity: 1;
            /*visibility: visible;*/
            pointer-events: auto;
        }

        .order-modal-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 24px;
        }

        .order-modal-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .order-modal-label {
            color: #666;
            font-size: 14px;
        }

        .order-modal-value {
            font-size: 15px;
            font-weight: 500;
        }

        .order-modal-sub {
            font-size: 13px;
            color: #999;
        }

        .order-modal-divider {
            border-top: 1px solid #eee;
            margin: 14px 0 18px;
        }

        .order-modal-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-modal-actions {
            display: flex;
            margin-top: 24px;
            gap: 10px;
        }

        .order-modal-btn {
            flex: 1;
            border-radius: 10px;
            border: none;
            padding: 12px 0;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .order-modal-btn-cancel {
            background: #f4f4f5;
            color: #333;
        }

        .order-modal-btn-confirm {
            background: #e6424f;
            color: #ffffff;
        }

        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .modal-switch {
            position: relative;
            width: 46px;
            height: 26px;
            border-radius: 13px;
            background: #e4e4ea;
            display: inline-flex;
            align-items: center;
            padding: 3px;
            box-sizing: border-box;
            cursor: pointer;
        }

        .modal-switch input {
            display: none;
        }

        .modal-switch-slider {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffffff;
            transition: transform 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25);
        }

        .modal-switch input:checked + .modal-switch-slider {
            transform: translateX(18px);
        }
    </style>
    <style>
        .toast {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: #181e27;
            color: #ffffff;
            border-radius: 12px;
            padding: 8px 18px;
            font-size: 14px;
            display: flex;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease, transform 0.2s ease;
            z-index: 10000;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        .toast-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #22c55e;
            margin-right: 8px;
        }
    </style>
    <style>
        .hoga-root {
            padding: 0 16px 12px;
            font-size: 13px;
        }

        .hoga-header {
            display: grid;
            grid-template-columns: 1fr 1.2fr 1fr;
            padding: 4px 0;
            border-bottom: 1px solid #e5e8eb;
            color: #80838a;
        }

        .hoga-table {
            max-height: 500px;
        }

        .hoga-row {
            display: grid;
            grid-template-columns: 1fr 1.2fr 1fr;
            padding: 3px 0;
            align-items: center;
            font-size: 12px;
        }

        .hoga-row.ask .hoga-price {
            color: #de0000;  /* ë§¤ë„(ë¹¨ê°•) */
        }

        .hoga-row.bid .hoga-price {
            color: #0051c7;  /* ë§¤ìˆ˜(íŒŒë‘) */
        }

        .hoga-qty {
            text-align: right;
            color: #6b7280;
        }

        .hoga-price {
            text-align: right;
        }

        .hoga-center {
            text-align: center;
            padding: 6px 0;
            margin: 4px 0;
            border-top: 1px solid #e5e8eb;
            border-bottom: 1px solid #e5e8eb;
            font-size: 13px;
            font-weight: 600;
        }

        .hoga-center-main {
            font-size: 16px;
            margin-right: 4px;
        }

        .hoga-center-rate.up {
            color: #d60000;
        }
        .hoga-center-rate.down {
            color: #0051c7;
        }
        .hoga-center-rate.zero {
            color: #555;
        }

        .hoga-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding-top: 6px;
            border-top: 1px solid #f3f3f5;
            font-size: 12px;
            color: #374151;
        }
        /* ì™¼ìª½ = ë§¤ë„ì”ëŸ‰(íŒŒë‘), ì˜¤ë¥¸ìª½ = ë§¤ìˆ˜ì”ëŸ‰(ë¹¨ê°•) */
        .hoga-ask-qty {
            padding-right: 15px;
            text-align: right;
            color: #0051c7;   /* íŒŒë‘ */
        }
        .hoga-bid-qty {
            padding-left: 15px;
            text-align: left;
            color: #d60000;   /* ë¹¨ê°• */
        }
        .hoga-price {
            text-align: center;
        }
    </style>
    <style>
        .ticker-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: #fff;
            border-bottom: 1px solid #ddd;
            overflow: hidden;
            z-index: 9999;

            display: flex;
            align-items: center;   /* ì„¸ë¡œ ê°€ìš´ë° ì •ë ¬ */
        }

        .ticker-content {
            display: inline-block;
            white-space: nowrap;
            animation: tickerMove 1000s linear infinite;
        }

        @keyframes tickerMove {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
    </style>
    <style>
        .ticker-rate-up {
            color: #d60000; /* ë¹¨ê°• */
        }

        .ticker-rate-down {
            color: #0051c7; /* íŒŒë‘ */
        }

        .ticker-rate-zero {
            color: #555;    /* ë³´í•© */
        }
    </style>
    <style>
        .order-card {
            position: relative;
        }

        /* ê¸°ë³¸: ì˜¤ë²„ë ˆì´ëŠ” ìˆ¨ê²¨ë‘ê¸° */
        .order-card .order-login-overlay {
            display: none;
        }

        /* ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ì“¸ í´ë˜ìŠ¤ */
        .order-card.not-logged-in .order-card-body {
            filter: blur(2px);
            opacity: 0.4;
            pointer-events: none;
            user-select: none;
        }

        .order-card.not-logged-in .order-login-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255,255,255,0.80);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .order-login-box {
            text-align: center;
            padding: 16px 20px;
        }

        .order-login-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .order-login-desc {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 14px;
            line-height: 1.4;
        }

        .order-login-btn {
            padding: 8px 18px;
            border-radius: 999px;
            border: none;
            background: #e6424f;
            color: #fff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
    </style>
    <style>
        .diff-up {
            color: #d60000;  /* ìƒìŠ¹ = ë¹¨ê°• */
        }
        .diff-down {
            color: #0051c7;  /* í•˜ë½ = íŒŒë‘ */
        }
        .diff-zero {
            color: #555555;  /* ë³´í•© */
        }
    </style>
</head>
<body th:attr="data-stock-code=${code}, data-stock-name=${stockName}, data-logged-in=${session.loginUser != null}, data-toast-result=${toastResult}">
<header>
    <div th:replace="~{layouts/header.html}"></div>
</header>

<main>
    <div>
        <div>
            <div class="stock-name">
                <div style="">
                    <div style="font-size: 15px; font-weight: 500;"
                         th:text="${stockName}">ì‚¼ì„±ì „ì</div>
                    <div style="display: flex; align-items: center;">
                        <div id="topCurrentPrice" style="font-size: 20px; font-weight: 500; ">-</div>
                        <div id="lastDiffText" data-base-label="ì§€ë‚œ ì •ê·œì¥ë³´ë‹¤"
                        style="margin-left: 10px;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tabs-wrapper" style="margin-top: 50px; border-bottom: 1px solid grey;">
            <ul class="tab-list" id="subTabs" style="list-style: none; display: flex;">
                <li style=" margin-right: 20px;">
                    <a href="#" class="tab-link active" style="text-decoration: none;color: black;">ì°¨íŠ¸ Â· í˜¸ê°€</a>
                </li>
                <li style="margin-right: 20px;">
                    <a href="#" class="tab-link" style=" text-decoration: none; color: black;">ì¢…ëª©ì •ë³´</a>
                </li>
                <li>
                    <a href="#" class="tab-link" style=" text-decoration: none; color: black;">ë‰´ìŠ¤ Â· ê³µì‹œ</a>
                </li>
            </ul>
            <!-- ê²€ì€ìƒ‰ ì›€ì§ì´ëŠ” ë°‘ì¤„ -->
            <div class="tab-underline" id="subTabsUnderline"></div>
        </div>
        <div style="width: 100%; display: flex;">
            <div style="width: 50%;">
                <div style="padding: 15px;box-sizing: border-box; margin-top:25px;border-radius: 16px;background-color: white; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB; overflow: hidden; width: 100%; height: 610px;">
                    <div>
                        <div style="color: #13263A; font-size: 14px; margin-bottom: 20px; ">
                            ì°¨íŠ¸
                        </div>

<!--                        ì°¨íŠ¸ ì˜ì—­-->
                        <div id="stockChartContainer"
                             style="width: 100%; height: 540px;"></div>
                    </div>
                </div>
            </div>
            <div style="box-sizing: border-box;margin-top:25px; margin-left:10px; border-radius: 16px;background-color: white; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB; overflow: hidden; width: 30%; height: 610px;">
                <div>
                    <div style="color: #13263A; font-size: 14px; font-weight: 500; margin-top: 14px;margin-bottom: 2px;margin-left: 15px;">
                        í˜¸ê°€
                    </div>

                    <!-- âœ… í˜¸ê°€ì°½ ì „ì²´ ì»¨í…Œì´ë„ˆ -->
                    <div id="hogaRoot" class="hoga-root">
                        <!-- í—¤ë” -->
                        <div class="hoga-header">
                            <span style="text-align: end;padding-right: 14px;">ë§¤ë„ì”ëŸ‰</span>
                            <span style="text-align: center;">í˜¸ê°€</span>
                            <span style="text-align: start;padding-left: 14px;">ë§¤ìˆ˜ì”ëŸ‰</span>
                        </div>

                        <!-- í–‰ë“¤ì´ ë“¤ì–´ê°ˆ ì˜ì—­ (JSê°€ í–‰ ë§Œë“¤ì–´ ë„£ìŒ) -->
                        <div id="hogaTable" class="hoga-table"></div>

                        <!-- í•˜ë‹¨ í•©ê³„ -->
                        <div class="hoga-footer">
                            <div>íŒë§¤ëŒ€ê¸° <span id="hogaTotalAsk">0</span></div>
                            <div>êµ¬ë§¤ëŒ€ê¸° <span id="hogaTotalBid">0</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="orderCard" class="order-card"
                 style="position:relative; box-sizing: border-box;margin-top:25px; margin-left:10px;
            border-radius: 16px;background-color: white; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #E5E7EB; overflow: hidden; width: 20%; height: 610px;">
            <!-- ë¹„ë¡œê·¸ì¸ ì‹œì—ë§Œ ë³´ì—¬ì¤„ ì˜¤ë²„ë ˆì´ -->
            <div class="order-login-overlay">
                <div class="order-login-box">
                    <div class="order-login-title">ë¡œê·¸ì¸ì„ ì§„í–‰í•´ì£¼ì„¸ìš”</div>
                    <div class="order-login-desc">
                        ì£¼ì‹ ì£¼ë¬¸ì€ ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                    <button type="button" class="order-login-btn"
                            th:onclick="|location.href='@{/member/main}'|">
                        ë¡œê·¸ì¸ í•˜ëŸ¬ê°€ê¸°
                    </button>
                </div>
            </div>
            <!-- ë¡œê·¸ì¸ ì‹œ ë³´ì„ -->
                <div>
                    <div style="color: #13263A; margin-bottom: 20px; padding: 15px;">
                        <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px; display: flex;">
                            <div style="flex: 1; margin-top: 4px;">ì£¼ë¬¸í•˜ê¸°</div>
                            <div style="font-weight: 500; font-size: 14px; width: 81%;">
                                <select id="accountSelect" style="outline: none; border:1px solid #e5e8eb; width: 100%; border-radius: 8px; padding-left: 8px; height: 30px;">
                                    <option th:if="${#lists.isEmpty(accountList)}" disabled selected>ê³„ì¢Œê°€ ì—†ì–´ìš”</option>
                                    <option th:each="acc : ${accountList}"
                                    th:value = "${acc.pacc}"
                                    th:text="${acc.pacc} + ' ' + ${acc.pname}"
                                            th:data-balance="${acc.pbalance}">
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="order-tabs" id="orderTabs">
                            <div class="order-tabs-active" id="orderTabsActive"></div>

                            <div class="order-tab active" data-type="buy">êµ¬ë§¤</div>
                            <div class="order-tab" data-type="sell">íŒë§¤</div>
                            <div class="order-tab" data-type="wait">ëŒ€ê¸°</div>
                        </div>
                        <div id="orderContents" style="margin-top: 16px;">
                                <!-- ì—¬ê¸°ë¶€í„°ëŠ” ê¸°ì¡´ êµ¬ë§¤ ì„¹ì…˜ (ëŒ€ë¶€ë¶„ ê·¸ëŒ€ë¡œ ì‚¬ìš©) -->
                                <section class="order-section" data-section="buy">
                                    <form id="buyForm" th:action="@{/stock/buyEtf}" method="post">
                                        <!-- ì¢…ëª© ì½”ë“œ/ì´ë¦„ ë„˜ê¸°ê¸° -->
                                        <input type="hidden" name="code" th:value="${code}">
                                        <input type="hidden" name="name" th:value="${stockName}">
                                        <!-- ë¡œê·¸ì¸ ì‚¬ìš©ì ì•„ì´ë”” -->
                                        <input type="hidden" name="pcuid"
                                               th:value="${session.loginUser != null ? pcuid : ''}">

                                        <!-- ì¢…ëª©ëª… -->
                                        <input type="hidden" name="pname" th:value="${stockName}"/>

                                        <!-- ì¶œê¸ˆ ê³„ì¢Œ (pacc) -->
                                        <input type="hidden" name="pacc" id="buyPaccHidden">

                                        <!-- ì„œë²„ë¡œ ë³´ë‚¼ ì‹¤ì œ ê°’ (ìˆ«ìë§Œ) -->
                                        <input type="hidden" name="pprice" id="buyPriceHidden">
                                        <input type="hidden" name="pstock" id="buyStockHidden">
                                        <input type="hidden" name="psum" id="buyPsumHidden">
                                        <div style="display: flex; margin-top: 14px; align-items: center; justify-content: space-between;padding-left: 10px; padding-right: 10px;">
                                            <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px;">ì£¼ë¬¸ ìœ í˜•</div>
                                            <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px; width: 75%;">
                                                <select style="outline: none; border:1px solid #e5e8eb; width: 100%; border-radius: 8px; padding-left: 10px; height: 30px;">
                                                    <option value="ì¼ë°˜">ì¼ë°˜ ì£¼ë¬¸</option>
                                                    <option value="ì •ê·œì¥">ì •ê·œì¥ ì£¼ë¬¸ ì˜ˆì•½</option>
                                                    <option value="ì¡°ê±´">ì¡°ê±´ ì£¼ë¬¸</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div style="display: flex; justify-content: space-between;padding-left: 10px; padding-right: 10px;margin-bottom: 6px;">
                                            <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px;padding-top: 5px;">êµ¬ë§¤ ê°€ê²©</div>
                                            <div style="font-weight: 500; font-size: 14px; margin-bottom: 8px; width: 75%;">
                                                <div class="price-tabs" id="priceTabs">
                                                    <div class="price-tabs-active" id="priceTabsActive"></div>
                                                    <div class="price-tab active" data-type="limit">ì§€ì •ê°€</div>
                                                    <div class="price-tab" data-type="market">ì‹œì¥ê°€</div>
                                                </div>
                                                <div style="position:relative;">
                                                    <input id="buyPriceInput" type="text" style="width: 91%; outline: none; padding-left:10px; padding-right:10px; border:1px solid #e5e8eb;font-weight: 500; font-size: 14px; border-radius: 8px; height: 30px;">
                                                    <span style="position: absolute; top:50%; right: 10px; transform: translateY(-50%); font-size: 14px; color:#999;">ì›</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="display: flex; justify-content: space-between;padding-left: 10px; padding-right: 10px;">
                                            <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px;padding-top: 5px;">ìˆ˜ëŸ‰</div>
                                            <div style="font-weight: 500; font-size: 14px; margin-bottom: 8px; width: 75%;">
                                                <div style="position: relative;">
                                                    <input id="buyQtyInput" type="text" style="width: 91%; outline: none; padding-left:10px; padding-right:10px; border:1px solid #e5e8eb;font-weight: 500; font-size: 14px; border-radius: 8px; height: 30px;">
                                                    <span style="position: absolute; top:50%; right: 10px; transform: translateY(-50%); font-size: 14px; color:#999;">ì£¼</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="border-top:1px solid #f3f3f5; margin-top: 20px;"></div>
                                        <div style="display: flex; margin-top: 20px; align-items: center; justify-content: space-between;padding-left: 10px; padding-right: 10px;">
                                            <div style="font-weight: 500; font-size: 14px; margin-bottom: -1px;">
                                                êµ¬ë§¤ê°€ëŠ¥ ê¸ˆì•¡
                                            </div>
                                            <div style="">
                                                <span id="accountBalance" style="font-size: 14px;"
                                                      th:text="${#lists.isEmpty(accountList) ? 0 : (accountList[0].pbalance != null ? #numbers.formatInteger(accountList[0].pbalance, 0, 'COMMA') : 0)}">
                                                    0
                                                </span><span style="font-size: 14px;">ì›</span>
                                            </div>
                                        </div>
                                    <div style="display: flex; margin-top: 28px; align-items: center; justify-content: space-between;padding-left: 10px; padding-right: 10px;">
                                        <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px;">ì´ ì£¼ë¬¸ ê¸ˆì•¡</div>
                                        <div style="text-align: end; font-weight: 500; font-size: 14px; margin-bottom: 14px; width: 75%;">
                                            <span id="buyTotalAmount">0ì›</span>
                                        </div>
                                    </div>
                                    <div style="margin-top: 10px;">
                                        <button type="button" id="openOrderModal" style="cursor: pointer; background: #e6424f; border:none; border-radius: 8px; width: 100%; color: white; padding: 10px; font-size: 18px; font-weight: 700;">êµ¬ë§¤í•˜ê¸°</button>
                                    </div>
                                </form>
                            </section>
                            <section class="order-section" data-section="sell" style="display: none;">
                                <!-- ğŸ”¸ 1) ë³´ìœ  ìˆ˜ëŸ‰ì´ ì—†ì„ ë•Œ: ëŒ€ê¸° í™”ë©´ì²˜ëŸ¼ -->
                                <th:block th:if="${stock == null or stock.pstock == 0}">
                                    <div style="width: 100%; height: 440px; display: flex; justify-items: center; justify-content: center; align-items: center;">
                                        <div style="">
                                            <div style="text-align: center;">
                                                <svg width="26" height="28" viewBox="0 0 20 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M5.65785 0.0418114C5.30216 -0.0209313 4.9376 -0.0129925 4.58498 0.0651743C4.23236 0.143341 3.89859 0.290205 3.60273 0.497378C3.30688 0.704551 3.05473 0.967976 2.86069 1.27261C2.66666 1.57724 2.53453 1.91711 2.47185 2.27281L0.0418532 16.0598C-0.0848826 16.778 0.0788577 17.5171 0.497057 18.1146C0.915257 18.7121 1.55366 19.119 2.27185 19.2458L14.0899 21.3298C14.8079 21.4563 15.5468 21.2924 16.144 20.8742C16.7413 20.456 17.148 19.8178 17.2749 19.0998L19.7069 5.31181C19.7696 4.95612 19.7617 4.59156 19.6835 4.23894C19.6053 3.88632 19.4585 3.55255 19.2513 3.25669C19.0441 2.96084 18.7807 2.70869 18.4761 2.51465C18.1714 2.32061 17.8316 2.18848 17.4759 2.12581L5.65785 0.0418114ZM6.93385 4.32881C6.83599 4.30959 6.73527 4.31008 6.6376 4.33026C6.53993 4.35043 6.44727 4.38989 6.36503 4.44631C6.28279 4.50273 6.21263 4.57499 6.15865 4.65885C6.10468 4.74272 6.06797 4.83651 6.05068 4.93473C6.03339 5.03295 6.03586 5.13364 6.05795 5.23089C6.08005 5.32815 6.12131 5.42002 6.17934 5.50113C6.23737 5.58225 6.311 5.65097 6.39591 5.70329C6.48082 5.7556 6.57531 5.79046 6.67385 5.80581L14.5519 7.19581C14.7478 7.23029 14.9495 7.1855 15.1125 7.07129C15.2755 6.95708 15.3864 6.78281 15.4209 6.58681C15.4553 6.39082 15.4105 6.18915 15.2963 6.02618C15.1821 5.86321 15.0078 5.75229 14.8119 5.71781L6.93385 4.32881ZM5.37085 8.87681C5.40548 8.68096 5.51648 8.50687 5.67945 8.39285C5.84241 8.27884 6.04399 8.23422 6.23985 8.26881L14.1179 9.65781C14.2164 9.67317 14.3109 9.70802 14.3958 9.76034C14.4807 9.81265 14.5543 9.88138 14.6124 9.96249C14.6704 10.0436 14.7117 10.1355 14.7338 10.2327C14.7558 10.33 14.7583 10.4307 14.741 10.5289C14.7237 10.6271 14.687 10.7209 14.6331 10.8048C14.5791 10.8886 14.5089 10.9609 14.4267 11.0173C14.3444 11.0737 14.2518 11.1132 14.1541 11.1334C14.0564 11.1535 13.9557 11.154 13.8579 11.1348L5.97885 9.74481C5.7832 9.71018 5.60929 9.59932 5.4953 9.43658C5.38131 9.27384 5.33655 9.07252 5.37085 8.87681ZM5.54485 12.2068C5.44699 12.1876 5.34628 12.1881 5.2486 12.2083C5.15093 12.2284 5.05827 12.2679 4.97603 12.3243C4.89379 12.3807 4.82363 12.453 4.76965 12.5369C4.71567 12.6207 4.67897 12.7145 4.66168 12.8127C4.64439 12.911 4.64686 13.0116 4.66895 13.1089C4.69105 13.2061 4.73231 13.298 4.79034 13.3791C4.84837 13.4602 4.922 13.529 5.00691 13.5813C5.09182 13.6336 5.18631 13.6685 5.28485 13.6838L10.2089 14.5528C10.4048 14.5873 10.6065 14.5425 10.7695 14.4283C10.9325 14.3141 11.0434 14.1398 11.0779 13.9438C11.1123 13.7478 11.0675 13.5462 10.9533 13.3832C10.8391 13.2202 10.6648 13.1093 10.4689 13.0748L5.54485 12.2068Z" fill="#999A9C"/>
                                                </svg>
                                            </div>
                                            <div>íŒë§¤í•  ìˆ˜ ìˆëŠ” ì£¼ì‹ì´ ì—†ì–´ìš”</div>
                                        </div>
                                    </div>
                                </th:block>
                                <th:block th:unless="${stock == null or stock.pstock == 0}">
                                    <!-- ğŸ”¥ íŒë§¤ ìš”ì²­ì„ ë³´ë‚¼ form -->
                                    <input type="hidden" id="holdPsum"
                                           th:value="${stock != null ? stock.psum : 0}">
                                    <input type="hidden" id="holdQty"
                                           th:value="${stock != null ? stock.pstock : 0}">
                                    <form id="sellForm" th:action="@{/stock/sellEtf}" method="post">
                                    <!-- ì¢…ëª© ì½”ë“œ/ì´ë¦„ -->
                                    <input type="hidden" name="code" th:value="${code}">
                                    <input type="hidden" name="name" th:value="${stockName}">

                                    <!-- ë¡œê·¸ì¸ ì‚¬ìš©ì ì•„ì´ë”” -->
                                    <input type="hidden" name="pcuid" th:value="${session.loginUser != null ? pcuid : ''}">

                                    <!-- ì¢…ëª©ëª… -->
                                    <input type="hidden" name="pname" th:value="${stockName}">

                                    <!-- ê³„ì¢Œ -->
                                    <input type="hidden" name="pacc" id="sellPaccHidden">

                                    <!-- ì´ ë§¤ë„ ê¸ˆì•¡ (ê°€ê²© Ã— ìˆ˜ëŸ‰) -->
                                    <input type="hidden" name="psum" id="sellPsumHidden">
                                    <div style="display: flex; margin-top: 14px; align-items: center; justify-content: space-between;padding-left: 10px; padding-right: 10px;">
                                                <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px;">ì£¼ë¬¸ ìœ í˜•</div>
                                                <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px; width: 75%;">
                                                    <select style="outline: none; border:1px solid #e5e8eb; width: 100%; border-radius: 8px;padding-left: 10px; height: 30px;">
                                                        <option value="ì¼ë°˜">ì¼ë°˜ ì£¼ë¬¸</option>
                                                        <option value="ì •ê·œì¥">ì •ê·œì¥ ì£¼ë¬¸ ì˜ˆì•½</option>
                                                        <option value="ì¡°ê±´">ì¡°ê±´ ì£¼ë¬¸</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div style="display: flex; justify-content: space-between;padding-left: 10px; padding-right: 10px;margin-bottom: 6px;">
                                                <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px;padding-top: 5px;">íŒë§¤ ê°€ê²©</div>
                                                <div style="font-weight: 500; font-size: 14px; margin-bottom: 8px; width: 75%;">
                                                    <div class="sell-price-tabs" id="sellPriceTabs">
                                                        <div class="sell-price-tabs-active" id="sellPriceTabsActive"></div>
                                                        <div class="sell-price-tab active" data-type="limit">ì§€ì •ê°€</div>
                                                        <div class="sell-price-tab" data-type="market">ì‹œì¥ê°€</div>
                                                    </div>
                                                    <div style="position:relative;">
                                                        <input type="text" th:value="${stock != null ? stock.pprice : ''}" id="sellPriceInput" style="width: 91%; outline: none; padding-left:10px; padding-right:10px; border:1px solid #e5e8eb;font-weight: 500; font-size: 14px; border-radius: 8px; height: 30px;">
                                                        <span style="position: absolute; top:50%; right: 10px; transform: translateY(-50%); font-size: 14px; color:#999;">ì›</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="display: flex; justify-content: space-between;padding-left: 10px; padding-right: 10px;">
                                                <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px;padding-top: 5px;">ìˆ˜ëŸ‰</div>
                                                <div style="font-weight: 500; font-size: 14px; margin-bottom: 8px; width: 75%;">
                                                    <div style="position: relative;">
                                                        <input type="text" id="sellQtyInput" th:value="${stock != null ? stock.pstock : 0}" style="width: 91%; outline: none; padding-left:10px; padding-right:10px; border:1px solid #e5e8eb;font-weight: 500; font-size: 14px; border-radius: 8px; height: 30px;">
                                                        <span style="position: absolute; top:50%; right: 10px; transform: translateY(-50%); font-size: 14px; color:#999;">ì£¼</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="border-top:1px solid #f3f3f5; margin-top: 20px;"></div>
                                            <div style="display: flex; margin-top: 24px; align-items: center; justify-content: space-between;padding-left: 10px; padding-right: 10px;">
                                            <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px;">í˜„ì¬ ìˆ˜ìµ</div>
                                            <div style="text-align: end; font-weight: 500; font-size: 14px; margin-bottom: 14px; width: 70%; color: #5184fc;"
                                                 id="currentProfitBox">
                                                -5,100ì›(-7.2%)
                                            </div>
                                        </div>
                                    <div style="display: flex; margin-top: 14px; align-items: center; justify-content: space-between;padding-left: 10px; padding-right: 10px;">
                                        <div style="font-weight: 500; font-size: 14px; margin-bottom: 14px;">ì´ ê¸ˆì•¡</div>
                                        <div style="text-align: end; font-weight: 500; font-size: 14px; margin-bottom: 14px; width: 75%;">
                                            <span id="sellTotalAmount">0ì›</span>
                                        </div>
                                    </div>
                                    <div style="margin-top: 10px;">
                                        <button id="openSellModal" type="button" style="cursor: pointer; background: #5184fc; border:none; border-radius: 8px; width: 100%; color: white; padding: 10px; font-size: 18px; font-weight: 700;">íŒë§¤í•˜ê¸°</button>
                                    </div>
                                </form>
                                </th:block>
                            </section>
                            <section class="order-section" data-section="wait" style="display: none;">
                                <div style="width: 100%; height: 440px; display: flex; justify-items: center; align-items: center;">
                                    <div style="">
                                        <div>
                                            <svg width="26" height="28" viewBox="0 0 20 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.65785 0.0418114C5.30216 -0.0209313 4.9376 -0.0129925 4.58498 0.0651743C4.23236 0.143341 3.89859 0.290205 3.60273 0.497378C3.30688 0.704551 3.05473 0.967976 2.86069 1.27261C2.66666 1.57724 2.53453 1.91711 2.47185 2.27281L0.0418532 16.0598C-0.0848826 16.778 0.0788577 17.5171 0.497057 18.1146C0.915257 18.7121 1.55366 19.119 2.27185 19.2458L14.0899 21.3298C14.8079 21.4563 15.5468 21.2924 16.144 20.8742C16.7413 20.456 17.148 19.8178 17.2749 19.0998L19.7069 5.31181C19.7696 4.95612 19.7617 4.59156 19.6835 4.23894C19.6053 3.88632 19.4585 3.55255 19.2513 3.25669C19.0441 2.96084 18.7807 2.70869 18.4761 2.51465C18.1714 2.32061 17.8316 2.18848 17.4759 2.12581L5.65785 0.0418114ZM6.93385 4.32881C6.83599 4.30959 6.73527 4.31008 6.6376 4.33026C6.53993 4.35043 6.44727 4.38989 6.36503 4.44631C6.28279 4.50273 6.21263 4.57499 6.15865 4.65885C6.10468 4.74272 6.06797 4.83651 6.05068 4.93473C6.03339 5.03295 6.03586 5.13364 6.05795 5.23089C6.08005 5.32815 6.12131 5.42002 6.17934 5.50113C6.23737 5.58225 6.311 5.65097 6.39591 5.70329C6.48082 5.7556 6.57531 5.79046 6.67385 5.80581L14.5519 7.19581C14.7478 7.23029 14.9495 7.1855 15.1125 7.07129C15.2755 6.95708 15.3864 6.78281 15.4209 6.58681C15.4553 6.39082 15.4105 6.18915 15.2963 6.02618C15.1821 5.86321 15.0078 5.75229 14.8119 5.71781L6.93385 4.32881ZM5.37085 8.87681C5.40548 8.68096 5.51648 8.50687 5.67945 8.39285C5.84241 8.27884 6.04399 8.23422 6.23985 8.26881L14.1179 9.65781C14.2164 9.67317 14.3109 9.70802 14.3958 9.76034C14.4807 9.81265 14.5543 9.88138 14.6124 9.96249C14.6704 10.0436 14.7117 10.1355 14.7338 10.2327C14.7558 10.33 14.7583 10.4307 14.741 10.5289C14.7237 10.6271 14.687 10.7209 14.6331 10.8048C14.5791 10.8886 14.5089 10.9609 14.4267 11.0173C14.3444 11.0737 14.2518 11.1132 14.1541 11.1334C14.0564 11.1535 13.9557 11.154 13.8579 11.1348L5.97885 9.74481C5.7832 9.71018 5.60929 9.59932 5.4953 9.43658C5.38131 9.27384 5.33655 9.07252 5.37085 8.87681ZM5.54485 12.2068C5.44699 12.1876 5.34628 12.1881 5.2486 12.2083C5.15093 12.2284 5.05827 12.2679 4.97603 12.3243C4.89379 12.3807 4.82363 12.453 4.76965 12.5369C4.71567 12.6207 4.67897 12.7145 4.66168 12.8127C4.64439 12.911 4.64686 13.0116 4.66895 13.1089C4.69105 13.2061 4.73231 13.298 4.79034 13.3791C4.84837 13.4602 4.922 13.529 5.00691 13.5813C5.09182 13.6336 5.18631 13.6685 5.28485 13.6838L10.2089 14.5528C10.4048 14.5873 10.6065 14.5425 10.7695 14.4283C10.9325 14.3141 11.0434 14.1398 11.0779 13.9438C11.1123 13.7478 11.0675 13.5462 10.9533 13.3832C10.8391 13.2202 10.6648 13.1093 10.4689 13.0748L5.54485 12.2068Z" fill="#999A9C"/>
                                            </svg>
                                        </div>
                                        <div>ëŒ€ê¸°ì¤‘ì¸ ì£¼ë¬¸ì´ ì—†ì–´ìš”</div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer>
    <div th:replace="~{layouts/footer.html}"></div>
</footer>

<!-- ì£¼ë¬¸ í™•ì¸ ëª¨ë‹¬ -->
<div id="orderConfirmModal" class="modal-overlay">
    <div class="order-modal" onclick="event.stopPropagation();">
        <div class="order-modal-title" id="modalTitle"
             th:text="${stockName} + ' êµ¬ë§¤ 1ì£¼'">ì˜¤ë¼í´ êµ¬ë§¤ 1ì£¼</div>

        <div class="order-modal-row">
            <div class="order-modal-label">1ì£¼ í¬ë§ê°€ê²©</div>
            <!-- ë‹¨ê°€ê°€ ë“¤ì–´ê°ˆ ê³³ -->
            <div class="order-modal-value" id="modalUnitPrice">10,005ì›</div>
        </div>

        <div class="order-modal-row">
            <div class="order-modal-label">
                ì˜ˆìƒ ìˆ˜ìˆ˜ë£Œ<br>
                <span class="order-modal-sub">êµ¬ë§¤ ìˆ˜ìˆ˜ë£Œ ë¬´ë£Œ</span>
            </div>
            <div class="order-modal-value">0ì›</div>
        </div>

        <div class="order-modal-row">
            <div class="order-modal-label">ì´ ì£¼ë¬¸ ê¸ˆì•¡</div>
            <!-- ì´ ì£¼ë¬¸ ê¸ˆì•¡ì´ ë“¤ì–´ê°ˆ ê³³ -->
            <div class="order-modal-value" id="modalTotalAmount">10,005ì›</div>
        </div>

        <div class="order-modal-divider"></div>

        <div class="order-modal-bottom">
            <div class="order-modal-label">ë‹¤ìŒë¶€í„° í™•ì¸ì°½ ì—†ì´ ê±°ë˜í•˜ê¸°</div>
            <label class="modal-switch">
                <input type="checkbox" id="skipConfirm">
                <span class="modal-switch-slider"></span>
            </label>
        </div>

        <div class="order-modal-actions">
            <button id="modalCancelBtn" class="order-modal-btn order-modal-btn-cancel">
                ì·¨ì†Œ
            </button>
            <button id="modalConfirmBtn" class="order-modal-btn order-modal-btn-confirm">
                êµ¬ë§¤
            </button>
        </div>
    </div>
</div>

<!-- íŒë§¤ í™•ì¸ ëª¨ë‹¬ -->
<div id="sellConfirmModal" class="modal-overlay">
    <div class="order-modal" onclick="event.stopPropagation();">
        <div class="order-modal-title"
             id="sellModalTitle"
             th:text="${stockName} + ' íŒë§¤ 1ì£¼'">ì˜¤ë¼í´ íŒë§¤ 1ì£¼</div>

        <div class="order-modal-row">
            <div class="order-modal-label">1ì£¼ íŒë§¤ê°€ê²©</div>
            <div class="order-modal-value" id="sellModalUnitPrice">10,005ì›</div>
        </div>

        <div class="order-modal-row">
            <div class="order-modal-label">
                ì˜ˆìƒ ìˆ˜ìˆ˜ë£Œ<br>
                <span class="order-modal-sub">íŒë§¤ ìˆ˜ìˆ˜ë£Œ ë¬´ë£Œ</span>
            </div>
            <div class="order-modal-value">0ì›</div>
        </div>

        <div class="order-modal-row">
            <div class="order-modal-label">ì´ ì£¼ë¬¸ ê¸ˆì•¡</div>
            <div class="order-modal-value" id="sellModalTotalAmount">10,005ì›</div>
        </div>

        <div class="order-modal-divider"></div>

        <div class="order-modal-bottom">
            <div class="order-modal-label">ë‹¤ìŒë¶€í„° í™•ì¸ì°½ ì—†ì´ ê±°ë˜í•˜ê¸°</div>
            <label class="modal-switch">
                <input type="checkbox" id="sellSkipConfirm">
                <span class="modal-switch-slider"></span>
            </label>
        </div>

        <div class="order-modal-actions">
            <button id="sellModalCancelBtn"
                    class="order-modal-btn order-modal-btn-cancel">
                ì·¨ì†Œ
            </button>
            <button id="sellModalConfirmBtn"
                    class="order-modal-btn order-modal-btn-confirm"
                    style="background:#5184fc;">
                íŒë§¤
            </button>
        </div>
    </div>
</div>

<!-- ì£¼ë¬¸ ì™„ë£Œ í† ìŠ¤íŠ¸ -->
<div id="orderToast" class="toast">
    <span class="toast-icon">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
             xmlns="http://www.w3.org/2000/svg">
            <path d="M11.5 4L6 9.5L3.5 7"
                  stroke="white" stroke-width="1.6"
                  stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </span>
    <span id="orderToastText"
          th:text="${stockName} + ' ì£¼ë¬¸ ì™„ë£Œ'">ì˜¤ë¼í´ êµ¬ë§¤ ì£¼ë¬¸ ì™„ë£Œ</span>
</div>

<div id="tickerBar" class="ticker-bar">
    <div id="tickerContent" class="ticker-content">
        <!-- âœ… ìµœì´ˆ ì§„ì… ì‹œ ETF ì„œë²„ ë°ì´í„°ë¡œ ì±„ìš°ê¸° -->
        <th:block th:each="item : ${etfs}">
            <span style="margin-right:40px;">
                <span th:text="${item.name}">KODEX 200</span>
                <span th:class="${
                    item.changeRate > 0 ? 'ticker-rate-up' :
                    (item.changeRate < 0 ? 'ticker-rate-down' : 'ticker-rate-zero')
                }">
                    <span th:text="${#numbers.formatInteger(item.price,0,'COMMA')}">24,200</span>ì›
                    (
                    <span th:text="${
                        (item.changeRate > 0 ? '+' : (item.changeRate < 0 ? '-' : '')) +
                        #numbers.formatDecimal(T(java.lang.Math).abs(item.changeRate), 1, 2)
                    } + '%'">+0.00%</span>
                    )
                </span>
            </span>
        </th:block>
    </div>
</div>
<script>
    // í˜ì´ì§€ ê³µí†µìœ¼ë¡œ ì“°ëŠ” ì¢…ëª© ì½”ë“œ, ì´ë¦„
    window.STOCK_CODE = document.body.dataset.stockCode;
    window.STOCK_NAME = document.body.dataset.stockName;
</script>
<script>
    // ì¼ë°˜ íƒ­ active ì²˜ë¦¬ (ìœ„ìª½ íƒ­)
    function initTabs(ulId) {
        const tabList = document.getElementById(ulId);
        if (!tabList) return;

        const links = tabList.querySelectorAll('.tab-link');

        links.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                links.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });
    }

    // ë°‘ì¤„ì´ ì›€ì§ì´ëŠ” íƒ­ ì²˜ë¦¬ (ì•„ë˜ìª½ íƒ­)
    function initMovingUnderline(ulId, underlineId) {
        const tabList = document.getElementById(ulId);
        const underline = document.getElementById(underlineId);
        if (!tabList || !underline) return;

        const links = tabList.querySelectorAll('.tab-link');

        // liì˜ offset ê¸°ì¤€ìœ¼ë¡œ ë°‘ì¤„ ì´ë™
        function moveUnderline(target) {
            const li = target.parentElement;    // <li>
            underline.style.width = li.offsetWidth + 'px';
            underline.style.left  = li.offsetLeft + 'px';
        }

        // ì´ˆê¸° ìœ„ì¹˜: active ë˜ì–´ìˆëŠ” íƒ­ ê¸°ì¤€
        const activeLink = tabList.querySelector('.tab-link.active') || links[0];
        if (activeLink) {
            moveUnderline(activeLink);
        }

        links.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();

                // active ì²˜ë¦¬
                links.forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                // ë°‘ì¤„ ì´ë™
                moveUnderline(this);
            });
        });

        // ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìœ„ì¹˜ ë‹¤ì‹œ ê³„ì‚°
        window.addEventListener('resize', () => {
            const currentActive = tabList.querySelector('.tab-link.active') || links[0];
            if (currentActive) moveUnderline(currentActive);
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        // initTabs('marketTabs');                          // ìœ„ìª½ íƒ­
        initMovingUnderline('subTabs', 'subTabsUnderline'); // ì•„ë˜ìª½ ì›€ì§ì´ëŠ” ì–¸ë”ë¼ì¸ íƒ­
    });
</script>
<script>
    function getRandomColor() {
        const colors = ["#1E90FF", "#FF6347", "#6A5ACD", "#2E8B57", "#FF8C00", "#DC143C"];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    function getColorForName(name) {
        const key = `badgeColor_${name}`;

        // ì´ë¯¸ ì €ì¥ëœ ìƒ‰ì´ ìˆë‹¤ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        const stored = localStorage.getItem(key);
        if (stored) return stored;

        // ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
        const newColor = getRandomColor();
        localStorage.setItem(key, newColor);
        return newColor;
    }

    function createCircleBadge(text, color) {
        const badge = document.createElement("div");
        badge.className = "circle-badge";
        badge.style.backgroundColor = color;
        badge.textContent = text;
        return badge;
    }

    function initCircleBadges() {
        const names = document.querySelectorAll(".stock-name");

        names.forEach(nameEl => {
            // ìƒ‰ì„ ê²°ì •í•  ê¸°ì¤€ ì´ë¦„ (data-stock-nameì´ ìˆìœ¼ë©´ ê·¸ ê°’, ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸)
            const fullName = (nameEl.dataset.stockName || nameEl.innerText).trim();
            const firstChar = fullName.charAt(0);

            // í•­ìƒ ë™ì¼í•œ ìƒ‰ì„ ê°€ì ¸ì˜¤ê±°ë‚˜ ìƒì„±
            const color = getColorForName(fullName);

            const badge = createCircleBadge(firstChar, color);

            // stock-name ìì²´ë¥¼ flex ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¤ì–´ì„œ
            // ì™¼ìª½ì— ë±ƒì§€, ì˜¤ë¥¸ìª½ì— ê¸°ì¡´ ë‚´ìš©(2ì¤„)ì´ ì˜¤ë„ë¡
            nameEl.style.display = "flex";
            nameEl.style.alignItems = "center";

            // ê¸°ì¡´ ë‚´ìš©ì€ ê·¸ëŒ€ë¡œ ë‘” ì±„, ë§¨ ì•ì— ë±ƒì§€ë§Œ ë¼ì›Œ ë„£ê¸°
            nameEl.insertBefore(badge, nameEl.firstChild);
        });
    }

    document.addEventListener("DOMContentLoaded", function () {
        initCircleBadges();
    });
</script>
<script>
    function initOrderTabs(containerId, activeBoxId) {
        const container = document.getElementById(containerId);
        const activeBox = document.getElementById(activeBoxId);
        if (!container || !activeBox) return;

        const tabs = container.querySelectorAll('.order-tab');
        // ğŸ‘‰ ì£¼ë¬¸ ì¹´ë“œ ì•ˆì— ìˆëŠ” ì„¹ì…˜ë“¤ë§Œ ëŒ€ìƒìœ¼ë¡œ
        const sections = document.querySelectorAll('#orderContents .order-section');

        function moveBox(target) {
            activeBox.style.left = target.offsetLeft + 'px';
            activeBox.style.width = target.offsetWidth + 'px';
        }

        // ì„¹ì…˜ show/hide
        function showSection(type) {
            sections.forEach(sec => {
                const secType = sec.dataset.section;   // buy / sell / wait
                sec.style.display = (secType === type ? 'block' : 'none');
            });
        }

        // ì´ˆê¸° ìƒíƒœ: active íƒ­ ê¸°ì¤€
        const activeTab = container.querySelector('.order-tab.active') || tabs[0];
        if (activeTab) {
            moveBox(activeTab);
            showSection(activeTab.dataset.type);
        }

        // íƒ­ í´ë¦­ ì‹œ
        tabs.forEach(tab => {
            tab.addEventListener('click', function () {
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                moveBox(this);

                const type = this.dataset.type;  // 'buy' / 'sell' / 'wait'
                showSection(type);
            });
        });

        // ë¦¬ì‚¬ì´ì¦ˆ ì‹œ underline ìœ„ì¹˜ ì¬ê³„ì‚°
        window.addEventListener('resize', () => {
            const current = container.querySelector('.order-tab.active') || tabs[0];
            if (current) moveBox(current);
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        initOrderTabs('orderTabs', 'orderTabsActive');
    });
</script>

<script>
    function initPriceTabs(containerId, activeBoxId) {
        const container = document.getElementById(containerId);
        const activeBox = document.getElementById(activeBoxId);
        if (!container || !activeBox) return;

        const tabs = container.querySelectorAll('.price-tab');

        function moveBox(target) {
            activeBox.style.left = target.offsetLeft + 'px';
            activeBox.style.width = target.offsetWidth + 'px';
        }

        const activeTab = container.querySelector('.price-tab.active') || tabs[0];
        if (activeTab) moveBox(activeTab);

        tabs.forEach(tab => {
            tab.addEventListener('click', function () {
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                moveBox(this);

                // this.dataset.type â†’ 'limit' ë˜ëŠ” 'market'
                // í•„ìš”ì‹œ ì£¼ë¬¸ ë¡œì§ ì—°ê²° ê°€ëŠ¥
            });
        });

        window.addEventListener('resize', () => {
            const current = container.querySelector('.price-tab.active') || tabs[0];
            if (current) moveBox(current);
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        initPriceTabs('priceTabs', 'priceTabsActive');
    });
</script>
<script>
    function initSellPriceTabs(containerId, activeBoxId) {
        const container = document.getElementById(containerId);
        const activeBox = document.getElementById(activeBoxId);
        if (!container || !activeBox) return;

        const tabs = container.querySelectorAll('.sell-price-tab');

        function moveBox(target) {
            activeBox.style.left = target.offsetLeft + 'px';
            activeBox.style.width = target.offsetWidth + 'px';
        }

        const activeTab = container.querySelector('.sell-price-tab.active') || tabs[0];
        if (activeTab) moveBox(activeTab);

        tabs.forEach(tab => {
            tab.addEventListener('click', function () {
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                moveBox(this);

                // this.dataset.type â†’ 'limit' ë˜ëŠ” 'market'
                // í•„ìš”ì‹œ ì£¼ë¬¸ ë¡œì§ ì—°ê²° ê°€ëŠ¥
            });
        });

        window.addEventListener('resize', () => {
            const current = container.querySelector('.sell-price-tab.active') || tabs[0];
            if (current) moveBox(current);
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        initSellPriceTabs('sellPriceTabs', 'sellPriceTabsActive');
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // === êµ¬ë§¤ ëª¨ë‹¬ ===
        const openBtn    = document.getElementById('openOrderModal');   // êµ¬ë§¤í•˜ê¸° ë²„íŠ¼
        const modal      = document.getElementById('orderConfirmModal');
        const cancelBtn  = document.getElementById('modalCancelBtn');
        const confirmBtn = document.getElementById('modalConfirmBtn');

        const priceInput   = document.getElementById('buyPriceInput');
        const qtyInput     = document.getElementById('buyQtyInput');
        const titleEl      = document.getElementById('modalTitle');
        const unitPriceEl  = document.getElementById('modalUnitPrice');
        const totalEl      = document.getElementById('modalTotalAmount');
        const balanceEl    = document.getElementById('accountBalance');

        if (openBtn && modal) {
            openBtn.addEventListener('click', function () {
                const price = parseInputNumber(priceInput.value);
                const qty   = parseInputNumber(qtyInput.value);

                if (!price || !qty) {
                    alert('êµ¬ë§¤ ê°€ê²©ê³¼ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                    return;
                }

                const balance = balanceEl
                    ? parseInputNumber(balanceEl.textContent)
                    : 0;

                const total = price * qty;

                // ğŸ”´ ì”ì•¡ ë¶€ì¡± ì‹œ: ëª¨ë‹¬ ë„ìš°ì§€ ë§ê³  í† ìŠ¤íŠ¸ë§Œ
                if (total > balance) {
                    showErrorToast('êµ¬ë§¤ê°€ëŠ¥ ê¸ˆì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                    return;
                }

                const stockName = window.STOCK_NAME || '';

                // ì œëª©: "PLUS ê¸€ë¡œë²Œíœ´ë¨¼â€¦ êµ¬ë§¤ 4ì£¼"
                if (titleEl) {
                    titleEl.textContent =
                        `${stockName} êµ¬ë§¤ ${qty.toLocaleString('ko-KR')}ì£¼`;
                }

                // ë‹¨ê°€
                if (unitPriceEl) {
                    unitPriceEl.textContent = formatWon(price);
                }

                // ì´ ì£¼ë¬¸ ê¸ˆì•¡ = ë‹¨ê°€ Ã— ìˆ˜ëŸ‰
                if (totalEl) {
                    totalEl.textContent = formatWon(price * qty);
                }

                // í•„ìš”í•˜ë©´ ë‚˜ì¤‘ì— ì£¼ë¬¸ ìš”ì²­ ë³´ë‚¼ ë•Œ ì“°ë ¤ê³  ì €ì¥
                modal.dataset.price = price;
                modal.dataset.qty   = qty;

                modal.classList.add('show');   // ëª¨ë‹¬ ë„ìš°ê¸°
            });

            // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
            modal.addEventListener('click', function () {
                modal.classList.remove('show');
            });
        }

        if (cancelBtn && modal) {
            cancelBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                modal.classList.remove('show');
            });
        }

        if (confirmBtn && modal) {
            confirmBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                const price = parseInputNumber(priceInput.value);
                const qty   = parseInputNumber(qtyInput.value);
                if (!price || !qty) {
                    alert('êµ¬ë§¤ ê°€ê²©ê³¼ ìˆ˜ëŸ‰ì„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.');
                    return;
                }

                const accountSelect = document.getElementById('accountSelect');
                if (!accountSelect || !accountSelect.value) {
                    alert('ì¶œê¸ˆ ê³„ì¢Œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                    return;
                }

                const total = price * qty;

                // hidden inputì— ì‹¤ì œ ìˆ«ì ì±„ìš°ê¸°
                document.getElementById('buyPriceHidden').value = price;
                document.getElementById('buyStockHidden').value = qty;
                document.getElementById('buyPsumHidden').value  = total;

                document.getElementById('buyPaccHidden').value = accountSelect.value;

                modal.classList.remove('show');

                document.getElementById('buyForm').submit();

            });
        }

        // === íŒë§¤ ëª¨ë‹¬ ===
        const openSellBtn    = document.getElementById('openSellModal');   // íŒë§¤í•˜ê¸° ë²„íŠ¼
        const sellModal      = document.getElementById('sellConfirmModal');
        const sellCancelBtn  = document.getElementById('sellModalCancelBtn');
        const sellConfirmBtn = document.getElementById('sellModalConfirmBtn');

        if (openSellBtn && sellModal) {
            openSellBtn.addEventListener('click', function () {
                const price = parseInputNumber(document.getElementById('sellPriceInput').value);
                const qty   = parseInputNumber(document.getElementById('sellQtyInput').value);

                if (!price || !qty) {
                    alert('íŒë§¤ ê°€ê²©ê³¼ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                    return;
                }

                const stockName = window.STOCK_NAME || '';
                const titleEl   = document.getElementById('sellModalTitle');
                const unitEl    = document.getElementById('sellModalUnitPrice');
                const totalEl   = document.getElementById('sellModalTotalAmount');

                // ì œëª©: "XXX íŒë§¤ 3ì£¼"
                if (titleEl) {
                    titleEl.textContent =
                        `${stockName} íŒë§¤ ${qty.toLocaleString('ko-KR')}ì£¼`;
                }

                // 1ì£¼ íŒë§¤ê°€ê²©
                if (unitEl) {
                    unitEl.textContent = formatWon(price);
                }

                // ì´ ì£¼ë¬¸ ê¸ˆì•¡ = ê°€ê²© Ã— ìˆ˜ëŸ‰
                const total = price * qty;
                if (totalEl) {
                    totalEl.textContent = formatWon(total);
                }

                // ë‚˜ì¤‘ì— í•„ìš”í•˜ë©´ ì“°ë„ë¡ ì €ì¥
                sellModal.dataset.price = price;
                sellModal.dataset.qty   = qty;

                sellModal.classList.add('show');
            });

            sellModal.addEventListener('click', function () {
                sellModal.classList.remove('show');
            });
        }

        if (sellCancelBtn && sellModal) {
            sellCancelBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                sellModal.classList.remove('show');
            });
        }

        if (sellConfirmBtn && sellModal) {
            sellConfirmBtn.addEventListener('click', function (e) {
                e.stopPropagation();

                const price = parseInputNumber(document.getElementById('sellPriceInput').value);
                const qty   = parseInputNumber(document.getElementById('sellQtyInput').value);

                if (!price || !qty) {
                    alert('íŒë§¤ ê°€ê²©ê³¼ ìˆ˜ëŸ‰ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.');
                    return;
                }

                const accountSelect = document.getElementById('accountSelect');
                document.getElementById('sellPaccHidden').value = accountSelect.value;

                const total = price * qty;
                document.getElementById('sellPsumHidden').value = total;

                sellModal.classList.remove('show');

                // í¼ ì œì¶œ
                document.getElementById('sellForm').submit();
            });
        }
    });
</script>

<script>
    function showOrderToast(actionText) {
        const toast = document.getElementById('orderToast');
        const text  = document.getElementById('orderToastText');
        if (!toast || !text) return;

        const name = window.STOCK_NAME || '';
        text.textContent = `${name} ${actionText} ì£¼ë¬¸ ì™„ë£Œ`;

        toast.classList.add('show');

        clearTimeout(window._orderToastTimer);
        window._orderToastTimer = setTimeout(function () {
            toast.classList.remove('show');
        }, 1300);
    }

    function showErrorToast(message) {
        const toast = document.getElementById('orderToast');
        const text  = document.getElementById('orderToastText');
        if (!toast || !text) return;

        text.textContent = message;

        toast.classList.add('show');
        clearTimeout(window._orderToastTimer);
        window._orderToastTimer = setTimeout(function () {
            toast.classList.remove('show');
        }, 1300);
    }

    // âœ… ì—¬ëŸ¬ ë²ˆ ì•ˆ ëœ¨ê²Œ í”Œë˜ê·¸
    window.priceToastShown = false;

    // info ëŠ” ì„ íƒê°’(ì—†ì–´ë„ ë™ì‘í•˜ë„ë¡) â€“ initPriceFromRanks ì—ì„œë„ ì¬ì‚¬ìš©
    function showPriceAlertToast(info) {
        console.log('[showPriceAlertToast] info =', info);

        const toast = document.getElementById('orderToast');
        const text  = document.getElementById('orderToastText');
        if (!toast || !text) return;

        // â— info ì—†ìœ¼ë©´ ì•„ë¬´ ê²ƒë„ ì•ˆ ë„ì›€ (ìˆ«ì ì—†ëŠ” í† ìŠ¤íŠ¸ ë°©ì§€)
        if (!info
            || typeof info.dropRate !== 'number'
            || typeof info.difference !== 'number') {
            return;
        }

        const name = window.STOCK_NAME || '';

        const dropRateFixed = info.dropRate.toFixed(2);
        const diffAbs       = Math.abs(info.difference);
        const diffText      = diffAbs.toLocaleString('ko-KR');
        const maxText       = info.histMaxPrice
            ? info.histMaxPrice.toLocaleString('ko-KR') + 'ì›'
            : '';

        const extraLine =
            `<br><span style="font-size:12px;opacity:0.8;">
            ìµœê·¼ 300ê°œ ê³ ì ${maxText ? ' (' + maxText + ')' : ''} ëŒ€ë¹„
            <b>${dropRateFixed}%</b>
            (${diffText}ì›) í•˜ë½
         </span>`;

        text.innerHTML = `ì§€ê¸ˆì´ ${name} ë§¤ìˆ˜ ê¸°íšŒì—ìš”${extraLine}`;

        toast.classList.add('show');
        clearTimeout(window._orderToastTimer);
        window._orderToastTimer = setTimeout(() => {
            toast.classList.remove('show');
        }, 1300);
    }

</script>
<script>
    // í˜¸ê°€ ë ˆë²¨ ê°œìˆ˜
    const HOGA_LEVELS = 10;

    // í˜ì´ì§€ ë¡œë”© ì‹œ í˜¸ê°€ í…Œì´ë¸” ë¼ˆëŒ€ ë§Œë“¤ê¸°
    document.addEventListener('DOMContentLoaded', function () {
        buildHogaTable();
    });

    function buildHogaTable() {
        const table = document.getElementById('hogaTable');
        if (!table) return;

        // ğŸ”º ë§¤ë„ 10í˜¸ ~ 1í˜¸ (ìœ„ìª½)
        for (let level = HOGA_LEVELS; level >= 1; level--) {
            const row = document.createElement('div');
            row.className = 'hoga-row ask';
            row.dataset.level = level;


            row.innerHTML = `
            <div class="hoga-qty hoga-ask-qty" id="askQty${level}">-</div>
            <div class="hoga-price" id="askPrice${level}">-</div>
            <div class="hoga-qty"></div>
        `;
            table.appendChild(row);
        }

        // ê°€ìš´ë° í˜„ì¬ê°€/ë“±ë½
        const center = document.createElement('div');
        center.className = 'hoga-center';
        center.innerHTML = `
        <span class="hoga-center-main" id="hogaCurrentPrice">-</span>
        <span class="hoga-center-rate zero" id="hogaCurrentRate">0.00%</span>
    `;
        table.appendChild(center);

        // ğŸ”µ ë§¤ìˆ˜ 1í˜¸ ~ 10í˜¸ (ì•„ë˜ìª½)
        for (let level = 1; level <= HOGA_LEVELS; level++) {
            const row = document.createElement('div');
            row.className = 'hoga-row bid';
            row.dataset.level = level;


            row.innerHTML = `
            <div class="hoga-qty"></div>
            <div class="hoga-price" id="bidPrice${level}">-</div>
            <div class="hoga-qty hoga-bid-qty" id="bidQty${level}">-</div>
        `;
            table.appendChild(row);
        }
    }

    // ì²œë‹¨ìœ„ ì½¤ë§ˆ
    function formatNumber(n) {
        if (n == null || n === "" || isNaN(n)) return "-";

        // ìŒìˆ˜ ê¸°í˜¸ ì œê±°
        const cleaned = String(n).replace("-", "");

        return Number(cleaned).toLocaleString("ko-KR");
    }

    // ë“±ë½ë¥  ìƒ‰ìƒ í´ë˜ìŠ¤
    function getRateClass(rate) {
        const r = Number(rate);
        if (isNaN(r) || r === 0) return 'zero';
        return r > 0 ? 'up' : 'down';
    }

    /**
     * âœ… í‚¤ì›€ 0D + 0A ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í˜¸ê°€ì°½ ì—…ë°ì´íŠ¸
     *  - values0D: 0Dì˜ values (FID ë§µ)
     *  - values0A: 0Aì˜ values (í˜„ì¬ê°€/ë“±ë½ë¥  ë“±, optional)
     */
    function updateOrderBook(values0D, values0A) {
        if (!values0D) return;

        // ---- 1) 0D â†’ í˜¸ê°€/ì”ëŸ‰ ì„¸íŒ… (ì§€ê¸ˆ ì½”ë“œ ê·¸ëŒ€ë¡œ) ----
        for (let level = 1; level <= HOGA_LEVELS; level++) {
            const askPriceFid = String(40 + level);  // 41~50 ë§¤ë„í˜¸ê°€1~10
            const askQtyFid   = String(60 + level);  // 61~70 ë§¤ë„í˜¸ê°€ ìˆ˜ëŸ‰1~10
            const bidPriceFid = String(50 + level);  // 51~60 ë§¤ìˆ˜í˜¸ê°€1~10
            const bidQtyFid   = String(70 + level);  // 71~80 ë§¤ìˆ˜í˜¸ê°€ ìˆ˜ëŸ‰1~10

            const bidPrice = values0D[bidPriceFid];
            const askPrice = values0D[askPriceFid];
            const bidQty   = values0D[bidQtyFid];
            const askQty   = values0D[askQtyFid];

            const bidPriceEl = document.getElementById('bidPrice' + level);
            const bidQtyEl   = document.getElementById('bidQty' + level);
            const askPriceEl = document.getElementById('askPrice' + level);
            const askQtyEl   = document.getElementById('askQty' + level);

            if (bidPriceEl) bidPriceEl.textContent = bidPrice ? formatNumber(bidPrice) : '-';
            if (bidQtyEl)   bidQtyEl.textContent   = bidQty   ? formatNumber(bidQty)   : '-';
            if (askPriceEl) askPriceEl.textContent = askPrice ? formatNumber(askPrice) : '-';
            if (askQtyEl)   askQtyEl.textContent   = askQty   ? formatNumber(askQty)   : '-';
        }

        // ì´ ì”ëŸ‰
        const totalAsk = values0D['121']; // ë§¤ë„í˜¸ê°€ ì´ì”ëŸ‰
        const totalBid = values0D['125']; // ë§¤ìˆ˜í˜¸ê°€ ì´ì”ëŸ‰
        const totalBidEl = document.getElementById('hogaTotalBid');
        const totalAskEl = document.getElementById('hogaTotalAsk');
        if (totalBidEl) totalBidEl.textContent = totalBid ? formatNumber(totalBid) : '0';
        if (totalAskEl) totalAskEl.textContent = totalAsk ? formatNumber(totalAsk) : '0';

        setBuyPriceFromBestBid(values0D);

        // ---- 2) í˜„ì¬ê°€/ë“±ë½ë¥ : 0Aê°€ ìˆìœ¼ë©´ 0A ìš°ì„ , ì—†ìœ¼ë©´ 0D ê°’ ì‚¬ìš© ----
        const priceEl = document.getElementById('hogaCurrentPrice');
        const rateEl  = document.getElementById('hogaCurrentRate');

// 1ìˆœìœ„: 6102 / 6112 (ì‹¤ì œ í˜„ì¬ê°€ ì„¸íŠ¸)
// í˜¹ì‹œ ì—†ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ì„œ 23 / 201ì„ fallback ìœ¼ë¡œ ë‘ 
        const priceRaw = values0D['6102'] || values0D['23'];
        const rateRaw  = values0D['6112'] || values0D['201'];

        if (priceEl && priceRaw != null && priceRaw !== "") {
            priceEl.textContent = formatNumber(priceRaw);
        }

        if (rateEl && rateRaw != null && rateRaw !== "") {
            const r = Number(rateRaw);
            if (!isNaN(r)) {
                const sign = r > 0 ? '+' : (r < 0 ? '-' : '');
                rateEl.textContent = `${sign}${Math.abs(r).toFixed(2)}%`;

                rateEl.classList.remove('up','down','zero');
                if (r > 0) rateEl.classList.add('up');
                else if (r < 0) rateEl.classList.add('down');
                else rateEl.classList.add('zero');
            }
        }
    }
</script>
<script>
    const protocol = (location.protocol === 'https:') ? 'wss:' : 'ws:';
    const ws = new WebSocket(
        `${protocol}//${location.host}/BNK/ws/hoga?code=${STOCK_CODE}`
    );

    let last0AValues = null;
    let last0DValues = null;

    ws.onopen = () => console.log('ë¸Œë¼ìš°ì € WS ì—´ë¦° ìƒíƒœ');

    ws.onmessage = function (event) {
        console.log('ë¸Œë¼ìš°ì €ê°€ ë°›ì€ ë©”ì‹œì§€:', event.data);

        const root = JSON.parse(event.data);
        if (!root || !root.data || !Array.isArray(root.data)) return;

        const row = root.data[0];
        const type = row.type;
        const values = row.values;

        // ë””ë²„ê¹…ìš©: ì–´ë–¤ íƒ€ì…ì´ ì˜¤ëŠ”ì§€ í™•ì¸
        console.log('>>> type =', type);

        if (type === '0D') {
            // í˜¸ê°€ì”ëŸ‰
            last0DValues = values;
            // 0Aê°€ ì´ë¯¸ í•œ ë²ˆì´ë¼ë„ ì™”ë‹¤ë©´ ê°™ì´ ë°˜ì˜
            updateOrderBook(last0DValues, last0AValues);
            updateTopPrice(last0DValues);

            // ì‹¤ì‹œê°„ ì°¨íŠ¸
            updateChartFromTick(values);
        } else if (type === '0A') {
            // ì‹œì„¸ (í˜„ì¬ê°€, ë“±ë½ë¥ )
            last0AValues = values;
            // 0Dê°€ ì´ë¯¸ ìˆë‹¤ë©´ ê°™ì´ ë°˜ì˜
            updateOrderBook(last0DValues, last0AValues);
        }
    };


</script>
<script>
    function updateTopPrice(values0D) {
        if (!values0D) return;

        const nowPriceRaw = values0D['6102'];   // í˜„ì¬ê°€
        const diffRaw     = values0D['6110'];   // ì „ì¼ ëŒ€ë¹„
        const rateRaw     = values0D['6112'];   // ë“±ë½ë¥  %

        const nowPriceEl = document.getElementById('topCurrentPrice');
        if (!nowPriceEl) return;

        // í˜„ì¬ê°€ í‘œì‹œ
        const nowPrice = parseKiwoomAbs(nowPriceRaw);
        if (nowPrice != null) {
            nowPriceEl.textContent = formatNumber(nowPrice) + 'ì›';
            updateCurrentProfit(nowPrice);
        }

        // ì „ì¼ ëŒ€ë¹„ / ë“±ë½ë¥  í‘œì‹œ â†’ ì—¬ê¸°ì„œë§Œ renderLastDiff ì‚¬ìš©
        if (diffRaw != null && rateRaw != null) {
            const diff = Number(diffRaw);
            const rate = Number(rateRaw);

            // í™”ë©´ ê·¸ë¦¬ê¸°
            renderLastDiff({
                diffPrice: diff,
                diffRate : rate
            });

            // -7% í† ìŠ¤íŠ¸ ì²´í¬
            checkToastByChangeRate(rate);
        }
    }
</script>
<script>
    let chart, candleSeries;
    let currentBar = null;  // í˜„ì¬ ì§„í–‰ ì¤‘ì¸ 1ë¶„ë´‰
    
    function initStockChart() {
        const container = document.getElementById('stockChartContainer');
        console.log('LightweightCharts =', window.LightweightCharts);
        if (!container || !window.LightweightCharts) return;

        chart = LightweightCharts.createChart(container, {
            width: container.clientWidth,
            height: container.clientHeight,
            layout: {
                background: { color: '#FFFFFF' },
                textColor: '#222222',
            },
            grid: {
                vertLines: { color: '#EEEEEE' },
                horzLines: { color: '#EEEEEE' },
            },
            rightPriceScale: {
                borderColor: '#D1D5DB',
            },
            timeScale: {
                borderColor: '#D1D5DB',
                timeVisible: true,
                secondsVisible: false,
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
            },
        });

        candleSeries = chart.addCandlestickSeries({
            upColor: '#d60000',
            downColor: '#0051c7',
            borderUpColor: '#d60000',
            borderDownColor: '#0051c7',
            wickUpColor: '#d60000',
            wickDownColor: '#0051c7',
        });

        // âœ… ì´ˆê¸° ì¼ë´‰ ë°ì´í„° ë¡œë”© (time ì„ "ìœ ë‹‰ìŠ¤ ì´ˆ"ë¡œ í†µì¼)
        fetch(`/BNK/api/chart/${STOCK_CODE}?interval=1m`)
            .then(res => res.json())
            .then(rows => {
                console.log('chart api rows =', rows);
                if (!Array.isArray(rows)) return;

                // âœ… ì—¬ê¸°ì„œ íˆìŠ¤í† ë¦¬ ì„¸íŒ… + ìµœê³ ê°€ ê³„ì‚°ê¹Œì§€ ê°™ì´ í•¨
                setHistoryCandles(rows);
            })
            .catch(err => console.error('ì°¨íŠ¸ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜', err));

        window.addEventListener('resize', () => {
            if (!chart || !container) return;
            chart.applyOptions({
                width: container.clientWidth,
                height: container.clientHeight,
            });
        });
    }

    document.addEventListener('DOMContentLoaded', initStockChart);

    // ğŸ”¹ ì‹¤ì‹œê°„ í‹±(0D)ì´ ì˜¬ ë•Œ 1ë¶„ë´‰ ì—…ë°ì´íŠ¸
    function updateChartFromTick(values) {
        if (!candleSeries || !values) return;

        const price = parseKiwoomAbs(values['6102']);
        if (price != null) {
            checkBuyToastWithHistory(price);
        }

        const barTime = getBarTimeFromValues(values); // ì´ë¯¸ ìœ ë‹‰ìŠ¤ ì´ˆ ìˆ«ì

        if (!currentBar || currentBar.time !== barTime) {
            // ìƒˆë¡œìš´ 1ë¶„ë´‰ ì‹œì‘
            currentBar = {
                time: barTime,
                open: price,
                high: price,
                low : price,
                close: price,
            };
        } else {
            // ì§„í–‰ ì¤‘ì¸ ë´‰ ê°±ì‹ 
            currentBar.high = Math.max(currentBar.high, price);
            currentBar.low  = Math.min(currentBar.low,  price);
            currentBar.close = price;
        }

        candleSeries.update(currentBar);
    }
</script>

<script>
    // ğŸ”¹ í‚¤ì›€ ìˆ«ì ë¬¸ìì—´ â†’ ìˆ«ì
    //  - " -97850", "-97850" â†’ 97850 (ê°€ê²©/ìˆ˜ëŸ‰ìš©)
    //  - "+3", "-0.70" ë“±ì€ ê·¸ëŒ€ë¡œ ë¶€í˜¸ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•ŒëŠ” Number()ë§Œ ì“°ë©´ ë¨
    function parseKiwoomAbs(str) {
        if (str == null) return null;
        const n = Number(String(str).replace(/\s/g, ''));
        if (isNaN(n)) return null;
        return Math.abs(n);
    }
    // ğŸ”¹ FID 21: "144213" â†’ í˜„ì¬ ë‚ ì§œì˜ 14:42:13 â†’ unix(second)
    function getBarTimeFromValues(values) {
        const t = (values['21'] || '').trim(); // hhmmss
        if (t.length < 4) {
            // ëŒ€ì¶© í˜„ì¬ì‹œê° ê¸°ì¤€ìœ¼ë¡œ UTC ì´ˆ
            const now = new Date();
            const utcMs = Date.UTC(
                now.getFullYear(),
                now.getMonth(),
                now.getDate(),
                now.getHours(),
                now.getMinutes(),
                0
            );
            return Math.floor(utcMs / 1000);
        }

        const hh = Number(t.slice(0, 2));
        const mm = Number(t.slice(2, 4));

        const today = new Date();
        const utcMs = Date.UTC(
            today.getFullYear(),
            today.getMonth(),
            today.getDate(),
            hh,
            mm,
            0
        );

        // âœ… LightweightCharts ì—ëŠ” í•­ìƒ UTC ì´ˆ ë„˜ê¸°ê¸°
        return Math.floor(utcMs / 1000);
    }
</script>
<script>
    const ALERT_PRICE = 574000;
</script>
<script>
    async function initPriceFromRanks() {
        if (!window.STOCK_CODE) {
            console.log('[initPriceFromRanks] STOCK_CODE ì—†ìŒ');
            return;
        }

        try {
            const res = await fetch('/BNK/api/ranks', {
                method: 'GET',
                cache: 'no-store'
            });
            if (!res.ok) {
                console.error('[initPriceFromRanks] ranks api ì‹¤íŒ¨', res.status);
                return;
            }

            const ranks = await res.json();
            console.log('[initPriceFromRanks] ranks =', ranks);

            if (!Array.isArray(ranks)) {
                console.error('[initPriceFromRanks] ë°°ì—´ ì•„ë‹˜');
                return;
            }

            const item = ranks.find(r => r.code === STOCK_CODE);
            console.log('[initPriceFromRanks] ì°¾ì€ item =', item);

            if (!item) {
                console.log('[initPriceFromRanks] í˜„ì¬ ì¢…ëª© ì½”ë“œ ëª» ì°¾ìŒ:', STOCK_CODE);
                return;
            }

            const nowPrice = Number(item.price);
            if (isNaN(nowPrice)) {
                console.log('[initPriceFromRanks] nowPrice NaN', item.price);
                return;
            }

            const nowPriceEl = document.getElementById('topCurrentPrice');
            if (nowPriceEl) {
                nowPriceEl.textContent = nowPrice.toLocaleString('ko-KR') + 'ì›';
            }

            updateCurrentProfit(nowPrice);

            const changeEl = document.getElementById('topChangeInfo');
            if (changeEl && item.changeRate != null) {
                const rate = Number(item.changeRate);
                const sign = rate > 0 ? '+' : (rate < 0 ? '-' : '');
                const absRate = Math.abs(rate).toFixed(2);

                let color = '#555555';
                if (rate > 0) color = '#d60000';
                else if (rate < 0) color = '#0051c7';
                changeEl.style.color = color;

                changeEl.innerHTML = `${sign}${absRate}%`;

                // ğŸ”¥ ë­í‚¹ API ê¸°ì¤€ -7% ì²´í¬
                checkToastByChangeRate(rate);
            }

            console.log('[initPriceFromRanks] nowPrice =', nowPrice, ', ALERT_PRICE =', ALERT_PRICE, ', priceToastShown =', window.priceToastShown);

            // if (!window.priceToastShown && typeof ALERT_PRICE !== 'undefined') {
            //     if (nowPrice <= ALERT_PRICE) {
            //         window.priceToastShown = true;
            //         console.log('[initPriceFromRanks] í† ìŠ¤íŠ¸ ë„ì›€!');
            //         showPriceAlertToast();
            //     } else {
            //         console.log('[initPriceFromRanks] ì¡°ê±´ ë¯¸ì¶©ì¡±, í† ìŠ¤íŠ¸ ì•ˆ ë„ì›€');
            //     }
            // }

        } catch (e) {
            console.error('initPriceFromRanks ì˜¤ë¥˜:', e);
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        initPriceFromRanks();
    });

</script>
<script>
    // ì „ì—­
    let toastAlreadyShown = false;
    let histMaxPrice = null;

    // 1) 300ê°œ íˆìŠ¤í† ë¦¬ ì„¸íŒ…í•  ë•Œ
    function setHistoryCandles(rows) {
        const candles = rows.map(item => ({
            time: Number(item.time),
            open: Number(item.open),
            high: Number(item.high),
            low : Number(item.low),
            close: Number(item.close),
        })).filter(c => !isNaN(c.open));

        candleSeries.setData(candles);

        // ğŸ”¹ ìµœê·¼ 300ê°œ ì¤‘ ìµœê³ ê°€ ì €ì¥
        histMaxPrice = Math.max(...candles.map(c => c.close));
    }

    // 2) ì‹¤ì‹œê°„ í‹± ë“¤ì–´ì˜¬ ë•Œ (updateChartFromTick ì•ˆ/ë°–)
    function checkBuyToastWithHistory(currentPrice) {
        if (!histMaxPrice || toastAlreadyShown) return;

        const difference = histMaxPrice - currentPrice;   // ì–¼ë§ˆ ë¹ ì¡ŒëŠ”ì§€(ì›)
        const dropRate   = (difference / histMaxPrice) * 100; // ëª‡ % ë¹ ì¡ŒëŠ”ì§€

        const THRESHOLD = 10; // 10% ì´ìƒ ë¹ ì¡Œì„ ë•Œ

        // âš ï¸ ì¡°ê±´ë§Œ ë§Œì¡±í•˜ë©´ ë”± í•œ ë²ˆë§Œ í† ìŠ¤íŠ¸
        if (dropRate >= THRESHOLD) {
            toastAlreadyShown = true;

            showPriceAlertToast({
                dropRate,
                difference,
                histMaxPrice,
                currentPrice
            });
        }
    }

</script>
<script>
    // ì „ì¼ ëŒ€ë¹„ ë“±ë½ë¥ ì„ ê¸°ì¤€ìœ¼ë¡œ í† ìŠ¤íŠ¸ ì²´í¬ (-7% ì´í•˜)
    function checkToastByChangeRate(rate) {
        if (toastAlreadyShown) return;           // ì´ë¯¸ í•œ ë²ˆ ëœ¬ ë’¤ë©´ íŒ¨ìŠ¤
        if (typeof rate !== 'number' || isNaN(rate)) return;

        // -7% ì´í•˜(ì¦‰, 7% ì´ìƒ í•˜ë½)ë©´ í† ìŠ¤íŠ¸
        if (rate <= -7) {
            toastAlreadyShown = true;

            const toast = document.getElementById('orderToast');
            const text  = document.getElementById('orderToastText');
            if (!toast || !text) return;

            const name    = window.STOCK_NAME || '';
            const absRate = Math.abs(rate).toFixed(2);

            // ê¸°ì¡´ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            text.innerHTML = `ì§€ê¸ˆì´ ${name} ë§¤ìˆ˜ ê¸°íšŒì—ìš”
            <br><span style="font-size:12px;opacity:0.8;">
            ì§€ë‚œ ì •ê·œì¥ë³´ë‹¤ <b>${absRate}%</b> í•˜ë½
         </span>`;

            toast.classList.add('show');
            clearTimeout(window._orderToastTimer);
            window._orderToastTimer = setTimeout(() => {
                toast.classList.remove('show');
            }, 1300);
        }
    }

</script>
    <script>
        function updateTicker(list) {
            let currentItem = null;
        const html = list.map(r => {
        const rate  = Number(r.changeRate);
        const price = Number(r.price);

        const rateClass =
        rate > 0 ? 'ticker-rate-up' :
        rate < 0 ? 'ticker-rate-down' :
        'ticker-rate-zero';

        const sign =
        rate > 0 ? '+' :
        rate < 0 ? '-' : '';

        const absRate   = Math.abs(rate).toFixed(2);
        const priceText = price.toLocaleString('ko-KR');

        // ğŸ‘‡ ì§€ê¸ˆ ë³´ê³  ìˆëŠ” ì¢…ëª©ì¸ì§€ ì²´í¬ (codeê°€ ìˆìœ¼ë©´ codeë¡œ, ì—†ìœ¼ë©´ nameìœ¼ë¡œ)
        if (
            (r.code && r.code === window.STOCK_CODE) ||
            (!r.code && r.name === window.STOCK_NAME)
        ) {
            currentItem = r;
        }

        return `
                <span style="margin-right:40px;">
                    ${r.name}
                    <span class="${rateClass}">
                        ${priceText}ì› (${sign}${absRate}%)
                    </span>
                </span>
            `;
    }).join('');

        document.getElementById('tickerContent').innerHTML = html + html;

            // ğŸ‘‡ í˜„ì¬ í™”ë©´ ì¢…ëª©ì´ ë¦¬ìŠ¤íŠ¸ì— ìˆìœ¼ë©´ ìƒë‹¨ ê°€ê²©/ìˆ˜ìµë¥  ê°±ì‹ 
            if (currentItem) {
                const nowPrice = Number(currentItem.price);
                if (!isNaN(nowPrice)) {
                    const nowPriceEl = document.getElementById('topCurrentPrice');
                    if (nowPriceEl) {
                        nowPriceEl.textContent = nowPrice.toLocaleString('ko-KR') + 'ì›';
                    }
                    // âœ… ì—¬ê¸°ì„œ í˜„ì¬ ìˆ˜ìµ ê³„ì‚°
                    updateCurrentProfit(nowPrice);
                }

                const changeEl = document.getElementById('topChangeInfo');
                if (changeEl && currentItem.changeRate != null) {
                    const rate = Number(currentItem.changeRate);
                    const sign = rate > 0 ? '+' : (rate < 0 ? '-' : '');
                    const absRate = Math.abs(rate).toFixed(2);

                    let color = '#555555';
                    if (rate > 0) color = '#d60000';
                    else if (rate < 0) color = '#0051c7';
                    changeEl.style.color = color;

                    changeEl.innerHTML = `${sign}${absRate}%`;

                    // í•„ìš”í•˜ë©´ ì—¬ê¸°ë„ -7% í† ìŠ¤íŠ¸ ì¬ì‚¬ìš© ê°€ëŠ¥
                    // checkToastByChangeRate(rate);
                }
            }
    }
</script>

<script>
    // ğŸ”¥ ETFë§Œ ë³´ëŠ” ë£¨í”„
    async function fetchEtfLoop() {
        try {
            const res = await fetch('/BNK/api/etf', { cache: 'no-store' });
            if (!res.ok) return;

            const list = await res.json();
            if (Array.isArray(list)) {
                updateTicker(list);   // ìœ„ì˜ í•¨ìˆ˜ë¡œ ticker ê°±ì‹ 
            }
        } catch (e) {
            console.error('etf ticker fetch error', e);
        } finally {
            setTimeout(fetchEtfLoop, 1500);   // 1.5ì´ˆë§ˆë‹¤ ë°˜ë³µ
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchEtfLoop();   // í˜ì´ì§€ ë“¤ì–´ì˜¤ë©´ ETF ticker ì‹œì‘
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const buyInput = document.getElementById('buyPriceInput');
        const qtyInput = document.getElementById('buyQtyInput');
        if (!buyInput) return;

        // ì‚¬ìš©ìê°€ ì§ì ‘ ê±´ë“œë¦° ê¸°ë¡ + ê¸ˆì•¡ ì¬ê³„ì‚°
        ['focus', 'input', 'change'].forEach(ev => {
            buyInput.addEventListener(ev, () => {
                buyInput.dataset.userEdited = '1';   // ì‚¬ìš©ìê°€ í•œ ë²ˆì´ë¼ë„ ìˆ˜ì •
                updateBuyTotal();                   // ì´ì•¡ ê°±ì‹ 
            });
        });

        if (qtyInput) {
            ['input', 'change'].forEach(ev => {
                qtyInput.addEventListener(ev, updateBuyTotal); // ìˆ˜ëŸ‰ ë°”ë€” ë•Œë§ˆë‹¤ ì´ì•¡ ê°±ì‹ 
            });
        }
    });
</script>
<script>
    function setBuyPriceFromBestBid(values0D) {
        const input = document.getElementById('buyPriceInput');
        if (!input || !values0D) return;

        // ì‚¬ìš©ìê°€ ì´ë¯¸ ì…ë ¥/ìˆ˜ì •í–ˆìœ¼ë©´ ê±´ë“œë¦¬ì§€ ì•ŠìŒ
        if (input.dataset.userEdited === '1') return;

        const bestBidRaw = values0D['41'];    // ë§¤ë„í˜¸ê°€1
        if (!bestBidRaw) return;

        const formatted = formatNumber(bestBidRaw);
        if (formatted === '-' || formatted === '') return;

        input.value = formatted;  // ì˜ˆ: "101,300"
    }
</script>
<script>
    // ë¬¸ìì—´(ì½¤ë§ˆ í¬í•¨) â†’ ìˆ«ì, ë¹ˆ ë¬¸ìì—´ì´ë©´ 0
    function parseInputNumber(str) {
        if (!str) return 0;
        const cleaned = String(str).replace(/[^0-9]/g, '');
        if (cleaned === '') return 0;
        return Number(cleaned);
    }
    function formatWon(n) {
        return n.toLocaleString('ko-KR') + 'ì›';
    }

    // êµ¬ë§¤ê°€ê²© Ã— ìˆ˜ëŸ‰ â†’ ì´ ì£¼ë¬¸ ê¸ˆì•¡ ê°±ì‹ 
    function updateBuyTotal() {
        const priceInput = document.getElementById('buyPriceInput');
        const qtyInput   = document.getElementById('buyQtyInput');
        const totalEl    = document.getElementById('buyTotalAmount');

        if (!priceInput || !qtyInput || !totalEl) return;

        const price = parseInputNumber(priceInput.value);
        const qty   = parseInputNumber(qtyInput.value);

        const total = price * qty;   // ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ 0ì´ë©´ 0

        if (!total) {
            totalEl.textContent = '0ì›';
        } else {
            totalEl.textContent = formatNumber(total) + 'ì›';
        }
    }
    function updateSellTotal() {
        const priceInput = document.getElementById('sellPriceInput');
        const qtyInput   = document.getElementById('sellQtyInput');
        const totalEl    = document.getElementById('sellTotalAmount');

        if (!priceInput || !qtyInput || !totalEl) return;

        const price = parseInputNumber(priceInput.value);
        const qty   = parseInputNumber(qtyInput.value);

        const total = price * qty;   // ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ 0ì´ë©´ 0

        if (!total) {
            totalEl.textContent = '0ì›';
        } else {
            totalEl.textContent = formatNumber(total) + 'ì›';
        }
    }
    document.addEventListener('DOMContentLoaded', function () {
        const sellPriceInput = document.getElementById('sellPriceInput');
        const sellQtyInput   = document.getElementById('sellQtyInput');

        if (!sellPriceInput || !sellQtyInput) return;

        ['input', 'change'].forEach(ev => {
            sellPriceInput.addEventListener(ev, updateSellTotal);
            sellQtyInput.addEventListener(ev, updateSellTotal);
        });

        // ì´ˆê¸° ê°’(ë³´ìœ  ìˆ˜ëŸ‰)ì´ ìˆì„ ë•Œë„ í•œ ë²ˆ ê³„ì‚°
        updateSellTotal();
    });
</script>
<script>
    // ğŸ”¥ ETFë§Œ ë³´ëŠ” ë£¨í”„
    async function fetchEtfLoop() {
        try {
            const res = await fetch('/BNK/api/etf', { cache: 'no-store' });
            if (!res.ok) return;

            const list = await res.json();
            if (Array.isArray(list)) {
                updateTicker(list);   // ìœ„ì˜ í•¨ìˆ˜ë¡œ ticker ê°±ì‹ 
            }
        } catch (e) {
            console.error('etf ticker fetch error', e);
        } finally {
            setTimeout(fetchEtfLoop, 1500);   // 1.5ì´ˆë§ˆë‹¤ ë°˜ë³µ
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchEtfLoop();   // í˜ì´ì§€ ë“¤ì–´ì˜¤ë©´ ETF ticker ì‹œì‘
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const loggedIn = document.body.dataset.loggedIn === 'true';
        const card = document.getElementById('orderCard');
        if (!card) return;

        // ğŸ”¹ ë¡œê·¸ì¸ ì•ˆëœ ê²½ìš° â†’ ì¹´ë“œ íë¦¬ê²Œ + ì˜¤ë²„ë ˆì´ í‘œì‹œ
        if (!loggedIn) {
            card.classList.add('not-logged-in');
        }
        // ğŸ”¹ ë¡œê·¸ì¸ëœ ê²½ìš° â†’ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨ (ê·¸ëƒ¥ ì •ìƒ UI)
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const select  = document.getElementById('accountSelect');
        const balance = document.getElementById('accountBalance');

        if (!select || !balance) return;

        function updateBalanceFromSelect() {
            const opt = select.options[select.selectedIndex];
            if (!opt) return;

            const raw = opt.dataset.balance;   // ë¬¸ìì—´
            const num = Number(raw || 0);

            if (isNaN(num)) {
                balance.textContent = '0';
            } else {
                balance.textContent = num.toLocaleString('ko-KR');
            }
        }

        // ì´ˆê¸° 1ë²ˆ ì„¸íŒ… (ì²« ë²ˆì§¸ ê³„ì¢Œ ê¸°ì¤€)
        if (select.options.length > 0 && !select.disabled) {
            updateBalanceFromSelect();
        }

        // ê³„ì¢Œ ë³€ê²½ ì‹œë§ˆë‹¤ ì”ì•¡ ê°±ì‹ 
        select.addEventListener('change', updateBalanceFromSelect);
    });
</script>
<script>
    function updateCurrentProfit(nowPrice) {
        const psumInput  = document.getElementById('holdPsum');
        const qtyInput   = document.getElementById('holdQty');
        const box        = document.getElementById('currentProfitBox');

        if (!psumInput || !qtyInput || !box) return;

        const psum = Number(psumInput.value || 0);   // ì´ ë§¤ìˆ˜ ê¸ˆì•¡
        const qty  = Number(qtyInput.value || 0);    // ë³´ìœ  ìˆ˜ëŸ‰

        if (!psum || !qty || !nowPrice) {
            box.textContent = '0ì›(0.0%)';
            return;
        }

        // í˜„ì¬ í‰ê°€ê¸ˆì•¡ = í˜„ì¬ê°€ Ã— ìˆ˜ëŸ‰
        const currentAmount = nowPrice * qty;

        // í‰ê°€ì†ìµ = í˜„ì¬ í‰ê°€ê¸ˆì•¡ - ë§¤ìˆ˜ê¸ˆì•¡
        const profit = currentAmount - psum;

        // ìˆ˜ìµë¥  = í‰ê°€ì†ìµ / ë§¤ìˆ˜ê¸ˆì•¡ Ã— 100
        const profitRate = (profit / psum) * 100;

        const sign = profit > 0 ? '+' : (profit < 0 ? '-' : '');
        const absProfit = Math.abs(profit);
        const absRate   = Math.abs(profitRate).toFixed(1);

        // formatNumberëŠ” ì´ë¯¸ ìœ„ì— ì •ì˜ë¼ ìˆìœ¼ë‹ˆê¹Œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        box.textContent = `${sign}${formatNumber(absProfit)}ì›(${sign}${absRate}%)`;

        // ì›ê¸ˆ ëŒ€ë¹„ ì†ì‹¤ì´ë©´ íŒŒë€ìƒ‰, ì´ìµì´ë©´ ë¹¨ê°„ìƒ‰ ê°™ì€ ì‹ìœ¼ë¡œ ì¶”ê°€ë„ ê°€ëŠ¥
        if (profit > 0) {
            box.style.color = '#d60000';
        } else if (profit < 0) {
            box.style.color = '#0051c7';
        } else {
            box.style.color = '#555555';
        }
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const result = document.body.dataset.toastResult;

        if (result === 'buy') {
            // ğŸ‘‰ 'êµ¬ë§¤' / 'íŒë§¤'ëŠ” í† ìŠ¤íŠ¸ ë¬¸êµ¬ì— ë“¤ì–´ê°ˆ í…ìŠ¤íŠ¸
            showOrderToast('êµ¬ë§¤');
        } else if (result === 'sell') {
            showOrderToast('íŒë§¤');
        }
    });
</script>
<script>
    function renderLastDiff({ diffPrice, diffRate }) {
        const el = document.getElementById('lastDiffText');
        if (!el) return;

        const label = el.dataset.baseLabel || 'ì§€ë‚œ ì •ê·œì¥ë³´ë‹¤';

        const signPrice = diffPrice > 0 ? '+' : diffPrice < 0 ? '-' : '';
        const signRate  = diffRate > 0 ? '+' : diffRate < 0 ? '-' : '';

        const absPrice = Math.abs(diffPrice).toLocaleString('ko-KR');
        const absRate  = Math.abs(diffRate).toFixed(2);

        // ë“±ë½ ë°©í–¥ì— ë”°ë¼ í´ë˜ìŠ¤ ì„ íƒ
        let cls = 'diff-zero';
        if (diffRate > 0) cls = 'diff-up';
        else if (diffRate < 0) cls = 'diff-down';

        // âš  textContent ëŒ€ì‹  innerHTML ì‚¬ìš©í•´ì„œ ìˆ«ìë§Œ ìƒ‰ì¹ 
        el.innerHTML =
            `${label} ` +
            `<span class="${cls}">${signPrice}${absPrice}ì›</span> ` +
            `<span class="${cls}">(${signRate}${absRate}%)</span>`;
    }
</script>
</body>
</html>
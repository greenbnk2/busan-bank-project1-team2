<div style="margin-top:10px;"></div>
<header>
    <div th:replace="~{layouts/info/_header.html}"></div>
</header>
<main>
    <!-- branch section -->
    <section class="branch-section">
        <div class="branch-text">
            <h1>영업점안내</h1>
            <div class="subtitle">가까운 곳에서 고객님을 기다리겠습니다.</div>
        </div>
    </section>

    <div class="tab-menu">
        <button class="active">영업점</button>
        <button>365코너</button>
        <button>24/365코너</button>
        <button>해외지점</button>
        <button>대여금고</button>
        <button>롯데ATM</button>
        <button>STM</button>
        <button>외화ATM</button>
    </div>

    <div class="search-box">
        <select>
            <option>전체</option>
        </select>
        <input type="text" placeholder="본점">
        <button class="btn-register">검색</button>
    </div>

    <div class="result">
        <p><strong>본점</strong>에 대한 검색결과는 <b>1건</b>입니다.</p>

        <div class="branch-item">
            <strong>1. 본점영업부</strong>
            <span>전화: (020) 051-661-4000</span><br>
            <span>주소: (484-00) 부산 남구 문현금융로 30, 1층 (문현동, 부산은행본점)</span><br>
            <span>[대기고객수] <mark
                    style="background:#d91a1a;color:white;padding:2px 4px;border-radius:2px;">단위초과</mark></span>
        </div>

        <div class="map-wrap">
            <!-- 카카오맵 임시 삽입 -->
            <iframe src="https://map.kakao.com/?q=부산은행%20본점" width="100%" height="400" style="border:0;"
                loading="lazy"></iframe>
        </div>
    </div>
</main>


<meta name="theme-color" content="#E60012" />
<link rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23E60012'/%3E%3Ctext x='50' y='58' font-size='56' text-anchor='middle' fill='white' font-family='Arial, Helvetica, sans-serif'%3EB%3C/text%3E%3C/svg%3E" />
<style>
    body {

            font-family: "Noto Sans KR", sans-serif;
            margin-top: 60px;
            background-color: #F6F6F8;
            color: #222;
            padding: 0;
            line-height: 1.7;
        }
    </style>
<style>
    .btn-register {
        --bg1: #D91A1A;
        --bg2: #F03A3A;
        --shadow: rgba(217, 26, 26, .45);
        position: relative;
        box-sizing: border-box;
        width: 90px;
        height: 42px;
        border: none;
        border-radius: 8px;
        color: #fff;
        cursor: pointer;
        background: linear-gradient(180deg, var(--bg2), var(--bg1));
        outline: none;
        box-shadow: 0 6px 14px -10px var(--shadow);
        transition:
            background .18s ease,
            box-shadow .18s ease,
            transform .12s ease;
            /* 프레스만 사용할 예정 */
            will-change: background, box-shadow, transform;
        }

        /* Hover: 컬러와 섀도우만 아주 미세하게 (리프트 없음) */
        .btn-register:hover {
            background: linear-gradient(180deg, #f24a4a, #d61a1a);
            box-shadow: 0 8px 18px -12px var(--shadow);
            transform: none;
            /* 확실하게 떠오르지 않도록 고정 */
        }

</style>

<footer style="margin-top: 50px;">
    <div th:replace="~{layouts/footer.html}"></div>
</footer>
<script>
    document.addEventListener("DOMContentLoaded", async () => {

        let branchData = [];

        // 1) API 호출
        try {
            const res = await fetch('/BNK/api/branch');
            branchData = await res.json();
        } catch (e) {
            alert("지점 정보를 불러올 수 없습니다.");
            return;
        }

        const city = document.getElementById("citySelect");
        const district = document.getElementById("districtSelect");
        const keyword = document.getElementById("keywordInput");
        const searchBtn = document.getElementById("searchBtn");

        const listBox = document.getElementById("branchList");
        const mapIframe = document.getElementById("branchMap");
        const totalBox = document.getElementById("branchTotal");

        /* ⭐ 전국 시/도 목록 (행정안전부 기준 17개) */
        const cities = [
            "서울특별시", "부산광역시", "대구광역시", "인천광역시", "광주광역시",
            "대전광역시", "울산광역시", "세종특별자치시",
            "경기도", "강원도", "충청북도", "충청남도",
            "전라북도", "전라남도", "경상북도", "경상남도", "제주특별자치도"
        ];

        /* ⭐ 시/도 select 채우기 */
        cities.forEach(cityName => {
            const opt = document.createElement("option");
            opt.value = cityName;
            opt.textContent = cityName;
            city.appendChild(opt);
        });

        /* ⭐ 기본값을 부산광역시로 고정 */
        city.value = "부산광역시";


        /* ⭐ 부산 전체 구군 동적 추가 */
        const districts = [
            "중구", "서구", "동구", "영도구", "부산진구", "동래구",
            "남구", "북구", "해운대구", "사하구", "금정구",
            "강서구", "연제구", "수영구", "사상구", "기장군"
        ];
        districts.forEach(name => {
            const opt = document.createElement("option");
            opt.value = name;
            opt.textContent = name;
            district.appendChild(opt);
        });
        /* ⭐ 끝 */

        /* ⭐ 탭 메뉴 이벤트 */
        const tabButtons = document.querySelectorAll(".tab-menu button");
        let currentType = "영업점";

        tabButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                tabButtons.forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                currentType = btn.textContent;
                filter();
            });
        });

        function renderList(data) {
            totalBox.textContent = data.length;
            listBox.innerHTML = "";

            if (data.length === 0) {
                listBox.innerHTML = `<div style="padding:20px;color:#999;">검색 결과가 없습니다.</div>`;
                return;
            }

            data.forEach(b => {
                const html = `
            <div class="branch-result-item" data-name="${b.brname}">
                <h3>${b.brname}</h3>
                <div class="info">
                    ☎ ${b.brtel}<br>
                    ${b.braddr}
                </div>
                <div class="service-icons">
                    서비스: ${b.service || "정보 없음"}
                </div>
                <div class="waiting">
                    대기고객: ${b.wait || 0}명
                </div>
            </div>`;
                listBox.insertAdjacentHTML("beforeend", html);
            });

            document.querySelectorAll(".branch-result-item").forEach(item => {
                item.addEventListener("click", () => {
                    const q = encodeURIComponent(`부산은행 ${item.dataset.name}`);
                    mapIframe.src = `https://map.kakao.com/?q=${q}`;
                });
            });
        }

        function filter() {
            let fd = [...branchData];

            if (currentType !== "영업점") {
                fd = fd.filter(b => b.type === currentType);
            }

            const c = city.value;
            const d = district.value;
            const k = keyword.value.trim();

            fd = fd.filter(b => {
                const addr = b.braddr || "";
                const okCity = c ? addr.includes(c) : true;
                const okDist = d ? addr.includes(d) : true;
                const okKeyword = k ? (b.brname.includes(k) || addr.includes(k)) : true;
                return okCity && okDist && okKeyword;
            });

            renderList(fd);
        }

        city.addEventListener("change", filter);
        district.addEventListener("change", filter);
        searchBtn.addEventListener("click", filter);
        keyword.addEventListener("keydown", e => {
            if (e.key === "Enter") filter();
        });

        renderList(branchData);
    });
</script>

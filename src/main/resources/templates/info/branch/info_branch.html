<div style="margin-top:10px;"></div>
<header>
    <div th:replace="~{layouts/info/_header.html}"></div>
    <meta name="theme-color" content="#E60012"/>
    <link rel="icon"
          href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23E60012'/%3E%3Ctext x='50' y='58' font-size='56' text-anchor='middle' fill='white' font-family='Arial, Helvetica, sans-serif'%3EB%3C/text%3E%3C/svg%3E"/>
    <style>
        body {

            font-family: "Noto Sans KR", sans-serif;
            margin-top: 60px;
            background-color: #F6F6F8;
            color: #222;
            padding: 0;
            line-height: 1.7;
        }


        header,
        nav,
        main {
            max-width: 1200px;
            background-color: #F6F6F8;
            margin: 0 auto;
            padding: 20px 20px;
        }


        h2 {
            font-size: 1.6rem;
            font-weight: 700;
            margin: 40px 0 10px;
            border-bottom: 2px solid #d91a1a;
            display: inline-block;
            padding-bottom: 5px;
        }


        .branch-section {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            justify-content: space-between;
        }

        .branch-text {
            flex: 1 1 60%;
        }

        /*

            .tab-menu {
                display: flex;
                gap: 6px;
                margin: 20px 0;
            }

            .tab-menu button {
                border: 1px solid #ddd;
                background: #fff;
                padding: 8px 16px;
                border-radius: 4px;
                cursor: pointer;
            }

            .tab-menu button.active {
                background-color: #d91a1a;
                color: #fff;
                border-color: #d91a1a;
            }*/

        /* ------------------------------- */
        /* íƒ­ ë©”ë‰´ ë ˆì´ì•„ì›ƒ */
        /* ------------------------------- */
        .tab-menu {
            display: flex;
            gap: 8px;
            margin: 20px 0;
        }

        /* ------------------------------- */
        /* ê¸°ë³¸ íƒ­ ìŠ¤íƒ€ì¼ (pension-tab ìŠ¤íƒ€ì¼ ê¸°ë°˜) */
        /* ------------------------------- */
        .tab-menu button {
            padding: 10px 10px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            color: #555;
            transition: all 0.18s ease;
        }

        /* hover */
        .tab-menu button:hover {
            background: #fafafa;
            border-color: #d91a1a;
            color: #d91a1a;
        }

        /******************************************/
        /* íƒ­ ë©”ë‰´ */
        /******************************************/
        .pension-tab {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }


        /* ------------------------------- */
        /* í™œì„±(active) ìŠ¤íƒ€ì¼ */
        /* ------------------------------- */
        .tab-menu button.active {
            background: #ffe6e6;
            border-color: #D91A1A;
            color: #D91A1A;
            font-weight: 600;
        }


        select,
        input[type="text"] {
            width: 20%;
            box-sizing: border-box;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            background: #fff;
            padding: 10px 12px;
            font-size: 14px;
            color: #111827;
            outline: none;
            transition: box-shadow .15s ease, border-color .15s ease;
        }


        button.search {
            background-color: #d91a1a;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 20px;
            cursor: pointer;
        }

        .result {
            border-top: 1px solid #ddd;
            margin-top: 30px;
            padding-top: 20px;
        }

        .branch-item {
            border-left: 3px solid #d91a1a;
            padding-left: 10px;
            margin-bottom: 15px;
        }

        .branch-item strong {
            display: block;
            margin-bottom: 4px;
            font-size: 1.1rem;
        }

        .branch-item span {
            display: inline-block;
            margin-top: 4px;
            font-size: 0.9rem;
        }

        .btn-register {
            --bg1: #D91A1A;
            --bg2: #F03A3A;
            --shadow: rgba(217, 26, 26, .45);
            position: relative;
            box-sizing: border-box;
            width: 90px;
            height: 42px;
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            background: linear-gradient(180deg, var(--bg2), var(--bg1));
            outline: none;
            box-shadow: 0 6px 14px -10px var(--shadow);
            transition: background .18s ease,
            box-shadow .18s ease,
            transform .12s ease;
            /* í”„ë ˆìŠ¤ë§Œ ì‚¬ìš©í•  ì˜ˆì • */
            will-change: background, box-shadow, transform;
        }

        /* Hover: ì»¬ëŸ¬ì™€ ì„€ë„ìš°ë§Œ ì•„ì£¼ ë¯¸ì„¸í•˜ê²Œ (ë¦¬í”„íŠ¸ ì—†ìŒ) */
        .btn-register:hover {
            background: linear-gradient(180deg, #f24a4a, #d61a1a);
            box-shadow: 0 8px 18px -12px var(--shadow);
            transform: none;
            /* í™•ì‹¤í•˜ê²Œ ë– ì˜¤ë¥´ì§€ ì•Šë„ë¡ ê³ ì • */
        }

        /* Active: ì‚´ì§ ëˆŒë¦¬ëŠ” í”„ë ˆìŠ¤ íš¨ê³¼ë§Œ */
        .btn-register:active {
            transform: scale(.98);
            box-shadow: 0 4px 10px -10px var(--shadow);
        }

        /* í‚¤ë³´ë“œ í¬ì»¤ìŠ¤ ì ‘ê·¼ì„± */
        .btn-register:focus-visible {
            outline: 3px solid rgba(240, 58, 58, .55);
            outline-offset: 2px;
        }

        /* ëª¨ì…˜ ìµœì†Œí™” ì¡´ì¤‘ */
        @media (prefers-reduced-motion: reduce) {
            .btn-register {
                transition: none !important;
            }
        }

        @media (prefers-color-scheme: dark) {
            .btn-register {
                --shadow: rgba(240, 58, 58, .35);
            }
        }

        .branch-layout {
            display: flex;
            gap: 30px;
            margin-top: 30px;
            width: 100%;
            height: 780px; /* ì „ì²´ ë†’ì´ */
        }

        /* ì™¼ìª½: ë©”ë‰´ + ê²€ìƒ‰ + ë¦¬ìŠ¤íŠ¸ */
        .branch-left {
            flex: 1 1 45%;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            padding-right: 6px;
        }

        /* ì˜¤ë¥¸ìª½ ì§€ë„ */
        .branch-map-area {
            flex: 1 1 55%;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* ê²€ìƒ‰ UI */
        .branch-search-wrapper {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .branch-select {
            border: 1.5px solid #ddd;
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 15px;
            background: #fff;
            cursor: pointer;
            width: 140px;
        }

        .branch-search-box {
            flex: 1;
            display: flex;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 8px;
            background: #fafafa;
        }

        .branch-search-box input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 15px;
            outline: none;
        }

        .branch-search-box button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #D91A1A;
        }

        /* ë¦¬ìŠ¤íŠ¸ ìŠ¤í¬ë¡¤ */
        .branch-list-box {
            flex: 1;
            margin-top: 15px;
            overflow-y: auto;
            padding-right: 8px;
        }

        /* ì¹´ë“œí˜• ë¦¬ìŠ¤íŠ¸ */
        .branch-result-item {
            background: #fff;
            border-radius: 8px;
            border: 1px solid #eee;
            padding: 18px 20px;
            margin-bottom: 14px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            cursor: pointer;
        }

        .branch-result-item:hover {
            background: #fff6f6;
        }

        .branch-result-item h3 {
            font-size: 18px;
            font-weight: 700;
            color: #d91a1a;
            margin-bottom: 6px;
        }

        .branch-result-item .info {
            font-size: 15px;
            color: #333;
            line-height: 1.6;
        }

        .branch-result-item .waiting {
            font-size: 15px;
            margin-top: 8px;
            color: #d91a1a;
            font-weight: 600;
        }


    </style>
</header>

<main>

    <!-- ì „ì²´ ë ˆì´ì•„ì›ƒ -->
    <div class="branch-layout">

        <!-- â­ ì™¼ìª½ : ë©”ë‰´ê²€ìƒ‰ + ê²€ìƒ‰ë°•ìŠ¤ + ë¦¬ìŠ¤íŠ¸ -->
        <div class="branch-left">

            <!-- ë©”ë‰´ íƒ­ -->
            <div class="tab-menu">
                <button class="active" data-type="ì˜ì—…ì ">ì˜ì—…ì </button>
                <button data-type="365">365ì½”ë„ˆ</button>
                <button data-type="24/365">24/365ì½”ë„ˆ</button>
                <button data-type="ëŒ€ì—¬ê¸ˆê³ ">ëŒ€ì—¬ê¸ˆê³ </button>
                <button data-type="ì™¸í™”ATM">ì™¸í™”ATM</button>
            </div>


            <!-- ê²€ìƒ‰ ì¡°ê±´ -->
            <div class="branch-search-wrapper">
                <select id="citySelect" class="branch-select">
                    <option value="">ì‹œ/ë„ ì„ íƒ</option>
                </select>


                <select id="districtSelect" class="branch-select">
                    <option value="">êµ¬/êµ° ì„ íƒ</option>
                </select>


                <div class="branch-search-box">
                    <input type="text" id="keywordInput" placeholder="ì§€ì ëª… ë˜ëŠ” ì£¼ì†Œ ê²€ìƒ‰">
                    <button id="searchBtn"><i class="fas fa-search"></i></button>
                </div>
            </div>

            <!-- ê²€ìƒ‰ ê²°ê³¼ -->
            <div class="branch-count">
                ì´ <strong id="branchTotal">0</strong> ê±´
            </div>

            <!-- ë¦¬ìŠ¤íŠ¸ -->
            <div id="branchList" class="branch-list-box"></div>

        </div>

        <!-- â­ ì˜¤ë¥¸ìª½ : ì§€ë„ -->
        <div class="branch-map-area">
            <iframe id="branchMap"
                    src="https://map.kakao.com/?q=ë¶€ì‚°ì€í–‰%20ë³¸ì "
                    width="100%" height="100%" style="border:0;" loading="lazy"></iframe>
        </div>

    </div>

</main>

<footer style="margin-top: 50px;">
    <div th:replace="~{layouts/footer.html}"></div>
</footer>
<script>
    document.addEventListener("DOMContentLoaded", async () => {

        let branchData = [];

        // 1) API í˜¸ì¶œ
        try {
            const res = await fetch('/BNK/api/branch');
            branchData = await res.json();
        } catch (e) {
            alert("ì§€ì  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        const city = document.getElementById("citySelect");
        const district = document.getElementById("districtSelect");
        const keyword = document.getElementById("keywordInput");
        const searchBtn = document.getElementById("searchBtn");

        const listBox = document.getElementById("branchList");
        const mapIframe = document.getElementById("branchMap");
        const totalBox = document.getElementById("branchTotal");

        /* â­ ì „êµ­ ì‹œ/ë„ ëª©ë¡ (í–‰ì •ì•ˆì „ë¶€ ê¸°ì¤€ 17ê°œ) */
        const cities = [
            "ì„œìš¸íŠ¹ë³„ì‹œ", "ë¶€ì‚°ê´‘ì—­ì‹œ", "ëŒ€êµ¬ê´‘ì—­ì‹œ", "ì¸ì²œê´‘ì—­ì‹œ", "ê´‘ì£¼ê´‘ì—­ì‹œ",
            "ëŒ€ì „ê´‘ì—­ì‹œ", "ìš¸ì‚°ê´‘ì—­ì‹œ", "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ",
            "ê²½ê¸°ë„", "ê°•ì›ë„", "ì¶©ì²­ë¶ë„", "ì¶©ì²­ë‚¨ë„",
            "ì „ë¼ë¶ë„", "ì „ë¼ë‚¨ë„", "ê²½ìƒë¶ë„", "ê²½ìƒë‚¨ë„", "ì œì£¼íŠ¹ë³„ìì¹˜ë„"
        ];

        /* â­ ì‹œ/ë„ select ì±„ìš°ê¸° */
        cities.forEach(cityName => {
            const opt = document.createElement("option");
            opt.value = cityName;
            opt.textContent = cityName;
            city.appendChild(opt);
        });

        /* â­ ê¸°ë³¸ê°’ì„ ë¶€ì‚°ê´‘ì—­ì‹œë¡œ ê³ ì • */
        city.value = "ë¶€ì‚°ê´‘ì—­ì‹œ";


        /* â­ ë¶€ì‚° ì „ì²´ êµ¬êµ° ë™ì  ì¶”ê°€ */
        const districts = [
            "ì¤‘êµ¬", "ì„œêµ¬", "ë™êµ¬", "ì˜ë„êµ¬", "ë¶€ì‚°ì§„êµ¬", "ë™ë˜êµ¬",
            "ë‚¨êµ¬", "ë¶êµ¬", "í•´ìš´ëŒ€êµ¬", "ì‚¬í•˜êµ¬", "ê¸ˆì •êµ¬",
            "ê°•ì„œêµ¬", "ì—°ì œêµ¬", "ìˆ˜ì˜êµ¬", "ì‚¬ìƒêµ¬", "ê¸°ì¥êµ°"
        ];
        districts.forEach(name => {
            const opt = document.createElement("option");
            opt.value = name;
            opt.textContent = name;
            district.appendChild(opt);
        });
        /* â­ ë */

        /* â­ íƒ­ ë©”ë‰´ ì´ë²¤íŠ¸ */
        const tabButtons = document.querySelectorAll(".tab-menu button");
        let currentType = "ì˜ì—…ì ";

        tabButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                tabButtons.forEach(b => b.classList.remove("active"));
                btn.classList.add("active");

                // ğŸ”¥ ì´ ë¶€ë¶„ ë³€ê²½
                currentType = btn.dataset.type;

                filter();
            });
        });


        function renderList(data) {
            totalBox.textContent = data.length;
            listBox.innerHTML = "";

            if (data.length === 0) {
                listBox.innerHTML = `<div style="padding:20px;color:#999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }

            data.forEach(b => {
                const html = `
            <div class="branch-result-item" data-name="${b.brname}">
                <h3>${b.brname}</h3>
                <div class="info">
                    â˜ ${b.brtel}<br>
                    ${b.braddr}
                </div>
                <div class="service-icons">
                    ì„œë¹„ìŠ¤: ${b.service || "ì •ë³´ ì—†ìŒ"}
                </div>
                <div class="waiting">
                    ëŒ€ê¸°ê³ ê°: ${b.wait || 0}ëª…
                </div>
            </div>`;
                listBox.insertAdjacentHTML("beforeend", html);
            });

            document.querySelectorAll(".branch-result-item").forEach(item => {
                item.addEventListener("click", () => {
                    const q = encodeURIComponent(`ë¶€ì‚°ì€í–‰ ${item.dataset.name}`);
                    mapIframe.src = `https://map.kakao.com/?q=${q}`;
                });
            });
        }

        function filter() {
            let fd = [...branchData];

            // ğŸ”¥ TYPE í•„í„°ë§ í•µì‹¬ (ê³µë°±, null, ìœ ë‹ˆì½”ë“œ ì°¨ì´ê¹Œì§€ ëª¨ë‘ ë°©ì§€)
            if (currentType !== "ì˜ì—…ì ") {
                fd = fd.filter(b => (b.type || "").trim() === currentType.trim());
            }

            const c = city.value;
            const d = district.value;
            const k = keyword.value.trim();

            fd = fd.filter(b => {
                const addr = b.braddr || "";
                const okCity = c ? addr.includes(c) : true;
                const okDist = d ? addr.includes(d) : true;
                const okKeyword = k ? (b.brname.includes(k) || addr.includes(k)) : true;
                return okCity && okDist && okKeyword;
            });

            renderList(fd);
        }


        city.addEventListener("change", filter);
        district.addEventListener("change", filter);
        searchBtn.addEventListener("click", filter);
        keyword.addEventListener("keydown", e => {
            if (e.key === "Enter") filter();
        });

        renderList(branchData);
    });
</script>

<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ë³¸ì¸ì¸ì¦</title>
<!--
    ë‚ ì§œ : 2025/11/24
    ì´ë¦„ : ì´ì¤€ìš°
    ë‚´ìš© : ê³µë™ì¸ì¦ì„œ ëª¨ì˜ ì¶”ê°€ ì‘ì—…
-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <div th:replace="~{layouts/header.html}"></div>

<div id="bnk-chatbot-container" style="position: fixed; right: 20px; bottom: 20px; z-index: 9999;">
<div id="bnk-chatbot-slot"></div>
</div>
<main>
    <h1 style="text-align: center;">íšŒì›ê°€ì…</h1>
    <div class="stepper">
        <div class="step"><span class="dot">1</span>ì•½ê´€ë™ì˜</div>
        <div class="sep"></div>
        <div class="step active"><span class="dot">2</span>ë³¸ì¸ì¸ì¦</div>
        <div class="sep"></div>
        <div class="step"><span class="dot">3</span>ì •ë³´ì…ë ¥</div>
        <div class="sep"></div>
        <div class="step"><span class="dot">4</span>ê°€ì…ì™„ë£Œ</div>
    </div>

    <h2 style="margin: 18px 180px 0 ; font-size: 28px;">ë³¸ì¸ì¸ì¦</h2>
    <p style="color: #6b7280; margin: 5px 180px 10px;">ì•ˆì „í•œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©ì„ ìœ„í•´ ë³¸ì¸ì¸ì¦ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.</p>

    <form id="authForm" method="post" th:action="@{/member/auth/save}">
    <div class="form-card">
            <!-- ì¸ì¦ ë°©ì‹(ì¹´ë“œí˜•) -->
            <div class="verify-methods" role="tablist" aria-label="ì¸ì¦ ë°©ì‹ ì„ íƒ">
                <button type="button" id="method-phone" class="method-card" role="tab" aria-selected="false" aria-controls="panel-phone" aria-pressed="false">
                    <div class="m-title">
                        <span class="m-badge">ğŸªª</span>
                        <div>
                            <div class="m-name">íœ´ëŒ€í° ì¸ì¦</div>
                            <div class="m-sub">SMS ì¸ì¦ë²ˆí˜¸ë¡œ ë¹ ë¥¸ ì¸ì¦</div>
                        </div>
                    </div>
                    <ul class="m-list">
                        <li>ë³¸ì¸ ëª…ì˜ íœ´ëŒ€í° í•„ìš”</li>
                        <li>ì¸ì¦ë²ˆí˜¸ SMS ë°œì†¡</li>
                        <li>ì•½ 1-2ë¶„ ì†Œìš”</li>
                    </ul>
                </button>

                <button type="button" id="method-cert" class="method-card" role="tab" aria-selected="false" aria-controls="panel-cert" aria-pressed="false">
                    <div class="m-title">
                        <span class="m-badge1">âœ·</span>
                        <div>
                            <div class="m-name">ê³µë™ì¸ì¦ì„œ</div>
                            <div class="m-sub">ì €ì¥ëœ ì¸ì¦ì„œë¡œ ì´ìš©</div>
                        </div>
                    </div>
                    <ul class="m-list">
                        <li>PCì— ì €ì¥ëœ ì¸ì¦ì„œë§Œ ê°€ëŠ¥</li>
                        <li>ê¸°ì¡´ ë°œê¸‰ë°›ì€ ì¸ì¦ì„œ</li>
                        <li>ì¦‰ì‹œ ì¸ì¦ ì™„ë£Œ</li>
                    </ul>
                </button>
            </div>

            <!-- íœ´ëŒ€í° ì¸ì¦(í…Œì´ë¸” ë ˆì´ì•„ì›ƒ) -->
            <section id="panel-phone" class="auth-panel" role="tabpanel" aria-labelledby="method-phone" aria-hidden="true">
                <div class="form-card">
                    <table class="auth-table">
                        <tbody>
                        <!-- ì´ë¦„ / ìƒë…„ì›”ì¼ -->
                        <tr class="field">
                            <th scope="row" class="field-name">ì´ë¦„</th>
                            <td><input type="text" name="mname" class="input" placeholder="ì´ë¦„ ì…ë ¥"
                                       th:value="${auth?.mname}"></td>
                            <th scope="row"><label for="birthInput" class="field-label">ìƒë…„ì›”ì¼</label></th>
                            <td style="display:flex; align-items:center; gap:12px;">
                                <input id="birthInput" name="mbirth" type="text" class="input"
                                       placeholder="YYYY-MM-DD" required
                                       th:value="${auth?.mbirth}">
                            </td>
                        </tr>
                        <!-- ì„±ë³„ / í†µì‹ ì‚¬ -->
                        <tr class="field">
                            <th scope="row" class="field-name">ì„±ë³„</th>
                            <td>
                                <select name="mgender" class="input" required>
                                    <option>ì„ íƒ</option>
                                    <option value="M" th:selected="${auth?.mgender == 'M'}">ë‚¨ì„±</option>
                                    <option value="F" th:selected="${auth?.mgender == 'F'}">ì—¬ì„±</option>
                                </select>
                            </td>

                            <th scope="row" class="field-name">í†µì‹ ì‚¬</th>
                            <td>
                                <select name="mcarrier" class="input" required>
                                    <option>ì„ íƒ</option>
                                    <option value="SKT" th:selected="${auth?.mcarrier == 'SKT'}">SKT</option>
                                    <option value="KT" th:selected="${auth?.mcarrier == 'KT'}">KT</option>
                                    <option value="LG" th:selected="${auth?.mcarrier == 'LG'}">LG</option>
                                </select>
                            </td>
                        </tr>

                        <!-- íœ´ëŒ€í° ë²ˆí˜¸ / ì¸ì¦ë²ˆí˜¸ -->
                        <tr class="field">
                            <th scope="row"><label class="field-label">íœ´ëŒ€í°ë²ˆí˜¸</label></th>
                            <td>
                                <div class="field-row" style="display:flex; gap:8px;">
                                    <input type="text" name="mphone" class="input" placeholder="010-1234-5678">
                                    <button type="button" class="btn-register" id="btnPhoneReq" style="width:90px;">ì¸ì¦ìš”ì²­</button>
                                </div>
                            </td>

                            <th scope="row"><label class="field-label">ì¸ì¦ë²ˆí˜¸</label></th>
                            <td>
                                <div class="field-row" style="display:flex; gap:8px;">
                                    <input type="text" class="input" id="phoneCode" placeholder="ì¸ì¦ë²ˆí˜¸ ì…ë ¥" style="flex:1;">
                                    <button type="button" class="btn-register" id="btnPhoneVerify" style="width:90px;">í™•ì¸</button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <div class="note-blue" style="margin-top:20px;">
                                    <span class="bullet" style="background-color:#2563eb;">!</span>
                                    ë³¸ì¸ ëª…ì˜ì˜ íœ´ëŒ€í°ìœ¼ë¡œë§Œ ì¸ì¦ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. íƒ€ì¸ ëª…ì˜ íœ´ëŒ€í° ì‚¬ìš© ì‹œ ì¸ì¦ì— ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <div class="helper-box">
                                    <div class="helper-title">ì•ˆë‚´ì‚¬í•­</div>
                                    <ul class="helper-list">
                                        <li>ì…ë ¥í•˜ì‹  ì •ë³´ëŠ” ë³¸ì¸í™•ì¸ ìš©ë„ë¡œë§Œ ì‚¬ìš©ë˜ë©° ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                                        <li>í†µì‹ ì‚¬ ì ê²€ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ìƒíƒœì— ë”°ë¼ ì¸ì¦ì´ ì§€ì—°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                        <li>ì¸ì¦ë²ˆí˜¸ëŠ” 3ë¶„ê°„ ìœ íš¨í•˜ë©°, ì‹œê°„ ì´ˆê³¼ ì‹œ ì¬ì „ì†¡ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</li>
                                    </ul>
                                </div>
                            </td>
                        </tr>

                        <tr>
                            <td colspan="4">
                                <div class="btns">
                                    <a th:href="@{/member/main}" class="btn-pressable"
                                       style="display:inline-block;box-sizing:border-box;width:50%;height:42px;line-height:42px;border-radius:8px;border:1px solid #D1D5DB;background-color:#fff;text-align:center;color:#111;text-decoration:none;">
                                        ì·¨ì†Œ
                                    </a>
                                    <button type="submit" class="btn-register next-link" id="btnNext" style="width: 50%">ë‹¤ìŒ</button>
                                </div>
                            </td>
                        </tr>

                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ê³µë™ì¸ì¦ì„œ(í…Œì´ë¸” ë ˆì´ì•„ì›ƒ) -->
            <section id="panel-cert" class="auth-panel" role="tabpanel" aria-labelledby="method-cert" aria-hidden="true" >
                <div class="form-card">
                    <table class="auth-table">
                        <tbody>
                        <tr>
                            <td colspan="4">
                                <h2 style="margin: 0 0 0 10px;">PCì— ì €ì¥ëœ ê³µë™ì¸ì¦ì„œë¥¼ ì„ íƒí•˜ì—¬ ì¸ì¦ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.</h2>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <div class="btns">
                                    <button type="button" class="btn-register" id="btnFinanceCert" style="width:720px;">
                                        ê³µë™ì¸ì¦ì„œ ì„ íƒ
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <div id="jointStatus" class="joint-status" style="display:none;">
                                    ê³µë™ì¸ì¦ì„œ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ì˜ ì •ë³´ë¥¼ ì…ë ¥í•œ í›„ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ì§„í–‰í•´ ì£¼ì„¸ìš”.
                                </div>
                            </td>
                        </tr>
                        <!-- ì²˜ìŒì—” ìˆ¨ê²¨ì ¸ ìˆë‹¤ê°€ ì¸ì¦ ì„±ê³µ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” ì˜ì—­ -->
                        <tr class="joint-extra" style="display:none;">
                            <th scope="row" class="field-name">ì´ë¦„</th>
                            <td>
                                <input type="text" class="input joint-visible" placeholder="ì´ë¦„ ì…ë ¥"
                                       oninput="document.getElementById('h_mname').value = this.value;">
                                <input type="hidden" id="h_mname" name="mname">
                            </td>

                            <th scope="row" class="field-name">ìƒë…„ì›”ì¼</th>
                            <td style="display:flex; align-items:center; gap:12px;">
                                <input id="jointBirthInput" class="input joint-visible" placeholder="YYYY-MM-DD"
                                       oninput="document.getElementById('h_mbirth').value = this.value;">
                                <input type="hidden" id="h_mbirth" name="mbirth">
                            </td>
                        </tr>
                        <tr class="joint-extra" style="display:none;">
                            <th scope="row" class="field-name">ì„±ë³„</th>
                            <td>
                                <select class="input joint-visible"
                                        onchange="document.getElementById('h_mgender').value = this.value;">
                                    <option value="" hidden>ì„ íƒ</option>
                                    <option value="M">ë‚¨ì„±</option>
                                    <option value="F">ì—¬ì„±</option>
                                </select>
                                <input type="hidden" id="h_mgender" name="mgender">
                            </td>

                            <th scope="row" class="field-name">í†µì‹ ì‚¬</th>
                            <td>
                                <select class="input joint-visible"
                                        onchange="document.getElementById('h_mcarrier').value = this.value;">
                                    <option value="" hidden>ì„ íƒ</option>
                                    <option value="SKT">SKT</option>
                                    <option value="KT">KT</option>
                                    <option value="LG">LG</option>
                                </select>
                                <input type="hidden" id="h_mcarrier" name="mcarrier">
                            </td>
                        </tr>
                        <tr class="joint-extra" style="display:none; width: 254px">
                            <th scope="row" class="field-name">íœ´ëŒ€í°ë²ˆí˜¸</th>
                            <td>
                                <input type="text" class="input joint-visible" placeholder="010-1234-5678"
                                       oninput="document.getElementById('h_mphone').value = this.value;">
                                <input type="hidden" id="h_mphone" name="mphone">
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <div class="note-blue" style="margin-top:20px;">
                                    <span class="bullet" style="background-color:#2563eb;">!</span>
                                    ì¸ì¦ì„œê°€ ì—†ëŠ” ê²½ìš° ì€í–‰/ê³µê³µê¸°ê´€ì—ì„œ ë°œê¸‰ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <div class="helper-box">
                                    <div class="helper-title">ì•ˆë‚´ì‚¬í•­</div>
                                    <ul class="helper-list">
                                        <li>ì…ë ¥í•˜ì‹  ì •ë³´ëŠ” ì¸ì¦ì„œ í™•ì¸ ëª©ì ì—ë§Œ ì‚¬ìš©ë˜ë©° ë³„ë„ë¡œ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                                        <li>ì‹œìŠ¤í…œ ì ê²€ ë° ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì— ë”°ë¼ ì¸ì¦ì„œ í™•ì¸ì´ ì§€ì—°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                        <li>ì¸ì¦ ìš”ì²­ì€ ì¼ì • ì‹œê°„ ë‚´ ì™„ë£Œí•´ì•¼ í•˜ë©°, ë§Œë£Œ ì‹œ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <div class="btns">
                                    <a th:href="@{/member/main}" class="btn-pressable"
                                       style="display:inline-block;box-sizing:border-box;width:50%;height:42px;line-height:42px;border-radius:8px;border:1px solid #D1D5DB;background-color:#fff;text-align:center;color:#111;text-decoration:none;">
                                        ì·¨ì†Œ
                                    </a>
                                    <button type="submit" class="btn-register next-link" id="btnNext" style="width: 50%">ë‹¤ìŒ</button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </form>
</main>

<!-- ê³µë™ì¸ì¦ì„œ ëª¨ë‹¬ -->
<div id="certModal" aria-hidden="true">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="certModalTitle">
        <div class="modal-header">
            <h3 id="certModalTitle" style="margin:0;">ê³µë™ì¸ì¦ì„œ ë¡œê·¸ì¸</h3>
            <button type="button" class="modal-close" title="ë‹«ê¸°" data-close-modal>&times;</button>
        </div>
        <div class="modal-body">
            <!-- ê³µë™ì¸ì¦ì„œ íŒŒì¼ ì„ íƒ ì¶”ê°€ -->
            <div class="field" style="margin-bottom:10px;">
                <label class="field-name" style="display:block; margin-bottom:6px;">ì¸ì¦ì„œ íŒŒì¼</label>
                <!-- ì›ë˜ ì‹¤ì œ êµ¬í˜„ì€ .pfx,.p12 íŒŒì¼  ì²¨ë¶€ -->
                <input type="file" class="input btn-pressable" id="jointCertFile" accept=".jpg,.jpeg,.png">
                <p style="margin:4px 0 0; font-size:12px; color:#6b7280;">
                    * í•˜ë“œë””ìŠ¤í¬ì— ì €ì¥ëœ ê³µë™ì¸ì¦ì„œ(.png.jpg) íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
                </p>
            </div>

            <!-- ë¹„ë°€ë²ˆí˜¸ 123456 ê³ ì •-->
            <div class="field">
                <label class="field-name" style="display:block; margin-bottom:6px;">ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" class="input" id="certPw" placeholder="ì¸ì¦ì„œ ì•”í˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”">
            </div>
            <p style="margin:10px 0 0; color:#6b7280; font-size:13px;">
                * ì•ˆì „í•œ ê¸ˆìœµê±°ë˜ë¥¼ ìœ„í•´ 6ê°œì›”ë§ˆë‹¤ ì¸ì¦ì„œ ì•”í˜¸ë¥¼ ë³€ê²½í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.
            </p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-pressable" data-close-modal
                    style="width:48%; height:42px; border:1px solid #D1D5DB; border-radius:8px; background:#fff;">
                ì·¨ì†Œ
            </button>
            <button type="button" class="btn-register" id="btnCertSubmit" style="width:48%;">í™•ì¸</button>
        </div>
    </div>
</div>
<script>
    document.getElementById("authForm").addEventListener("submit", (e) => {
        if (!verifyState.phone && !verifyState.joint) {
            e.preventDefault();
            alert("íœ´ëŒ€í° ì¸ì¦ ë˜ëŠ” ê³µë™ì¸ì¦ì„œ ì¸ì¦ì„ ì™„ë£Œí•´ì•¼ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            return;
        }

        if (verifyState.joint) {
            const name = document.getElementById("h_mname").value.trim();
            const birth = document.getElementById("h_mbirth").value.trim();
            const gender = document.getElementById("h_mgender").value.trim();
            const carrier = document.getElementById("h_mcarrier").value.trim();
            const phone = document.getElementById("h_mphone").value.trim();

            if (!name || !birth || !gender || !carrier || !phone) {
                e.preventDefault();
                alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì•¼ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                return;
            }
        }
    });
</script>
<script>
    function syncInputNames(useJoint) {

        // ê³µë™ì¸ì¦ì„œ hidden í•„ë“œ name ê´€ë¦¬
        document.querySelectorAll('#panel-cert input[type="hidden"]').forEach(el => {
            if (useJoint) {
                el.name = el.id.replace('h_', '');
            } else {
                el.removeAttribute('name');
            }
        });
    }

    // ì¸ì¦ íƒ­ ìŠ¤ìœ„ì¹˜
    (function () {
        const btnPhone = document.getElementById('method-phone');
        const btnCert  = document.getElementById('method-cert');
        const panelPhone = document.getElementById('panel-phone');
        const panelCert  = document.getElementById('panel-cert');

        function show(panelBtn, panelEl) {
            [btnPhone, btnCert].forEach(b => {
                const active = b === panelBtn;
                b.classList.toggle('active', active);
                b.setAttribute('aria-selected', String(active));
                b.setAttribute('aria-pressed', String(active));
            });

            [panelPhone, panelCert].forEach(p => {
                const on = p === panelEl;
                p.hidden = !on;
                p.setAttribute('aria-hidden', String(!on));
            });
        }

        btnPhone.addEventListener('click', () => {
            show(btnPhone, panelPhone);
            syncInputNames(false);
        });

        btnCert.addEventListener('click',  () => {
            show(btnCert, panelCert);
            syncInputNames(true);
        });

        [btnPhone, btnCert].forEach(b => {
            b.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    b.click();
                }
            });
        });

        btnPhone.click();
        syncInputNames(false);
    })();
</script>
<script>
    // ì¸ì¦ìƒíƒœ
    const verifyState = { phone: false, joint: false };

    // UI ì—…ë°ì´íŠ¸
    function updateVerifyUI() {
        const btn = document.getElementById("btnPhoneVerify");
        if (btn) btn.textContent = verifyState.phone ? "ì™„ë£Œ" : "í™•ì¸";
    }

    document.addEventListener("DOMContentLoaded", () => {
        const phoneInput  = document.querySelector('#panel-phone input[name="mphone"]');
        const phoneCode   = document.getElementById('phoneCode');
        const btnReq      = document.getElementById("btnPhoneReq");
        const btnVerify   = document.getElementById("btnPhoneVerify");

        if (!phoneInput || !phoneCode || !btnReq || !btnVerify) {
            console.error("í•„ìˆ˜ ì¸ì¦ ìš”ì†Œ ì—†ìŒ");
            return;
        }

        // ì¸ì¦ìš”ì²­
        btnReq.addEventListener("click", async () => {
            const phoneNumber = phoneInput.value.trim();

            if (!phoneNumber) {
                alert("íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            try {
                const res = await fetch("/BNK/api/verification/sms/send", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ phoneNumber })
                });

                const data = await res.json();

                if (data.ok === true) {
                    alert("ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    phoneCode.focus();
                } else {
                    alert(data.message || "ë°œì†¡ ì‹¤íŒ¨");
                }
            } catch (err) {
                console.error(err);
                alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
            }
        });

        // ì¸ì¦í™•ì¸
        btnVerify.addEventListener("click", async () => {
            const phoneNumber = phoneInput.value.trim();
            const code        = phoneCode.value.trim();

            if (!code) {
                alert("ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            try {
                const res = await fetch("/BNK/api/verification/sms/verify", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ phoneNumber, code })
                });

                const data = await res.json();

                if (data.ok === true) {
                    verifyState.phone = true;
                    updateVerifyUI();
                    alert("íœ´ëŒ€í° ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
                } else {
                    verifyState.phone = false;
                    alert(data.message || "ì¸ì¦ ì‹¤íŒ¨");
                }
            } catch (err) {
                console.error(err);
                alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
            }
        });
    });
</script>
<!-- ë‹¬ë ¥ ìŠ¤í¬ë¦½íŠ¸ -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
<script>
    flatpickr("#birthInput", {
        locale: "ko",
        dateFormat: "Y-m-d"
    });
</script>
<!-- ê³µë™ì¸ì¦ì„œ ëª¨ë‹¬ -->
<script>
    // ê³µë™ì¸ì¦ì„œ ëª¨ë‹¬ + ê²€ì¦ ì—°ë™
    (function () {
        const btnOpen  = document.getElementById("btnFinanceCert");
        const modal    = document.getElementById("certModal");
        const btnCloseEls = document.querySelectorAll("[data-close-modal]");
        const btnSubmit = document.getElementById("btnCertSubmit");
        const fileInput = document.getElementById("jointCertFile");
        const pwInput   = document.getElementById("certPw");

        if (!btnOpen || !modal || !btnSubmit || !fileInput || !pwInput) return;

        // ëª¨ë‹¬ ì—´ê¸°
        btnOpen.addEventListener("click", () => {
            modal.setAttribute("aria-hidden", "false");
        });

        // ëª¨ë‹¬ ë‹«ê¸° (ì·¨ì†Œ/Ã— ë²„íŠ¼)
        btnCloseEls.forEach(btn => {
            btn.addEventListener("click", () => {
                modal.setAttribute("aria-hidden", "true");
            });
        });

        // í™•ì¸ ë²„íŠ¼ â†’ íŒŒì¼ + ë¹„ë°€ë²ˆí˜¸ ì„œë²„ ê²€ì¦
        btnSubmit.addEventListener("click", async () => {
            const file = fileInput.files && fileInput.files[0];
            const pw   = pwInput.value.trim();

            if (!file) {
                alert("ê³µë™ì¸ì¦ì„œ íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");
                return;
            }

            // í”„ë¡ íŠ¸ì—ì„œë„ í™•ì¥ì í™•ì¸ (jpg/jpeg/png)
            const lower = file.name.toLowerCase();
            if (!lower.endsWith(".jpg") &&
                !lower.endsWith(".jpeg") &&
                !lower.endsWith(".png")) {
                alert("jpg, jpeg, png í˜•ì‹ì˜ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                return;
            }

            if (!pw) {
                alert("ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
                return;
            }

            const formData = new FormData();
            formData.append("certFile", file);
            formData.append("certPw", pw);

            try {
                const res  = await fetch("/BNK/member/api/joint-cert/verify", {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();

                if (!data.ok) {
                    alert(data.message || "ê³µë™ì¸ì¦ì„œ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    verifyState.joint = false;
                    return;
                }
                // ê³µë™ì¸ì¦ì„œ ì„ íƒ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                const btnFinance = document.getElementById("btnFinanceCert");
                if (btnFinance) {
                    const row = btnFinance.closest("tr");
                    if (row) {
                        row.style.display = "none";
                    } else {
                        btnFinance.style.display = "none";
                    }
                }

                // ì¸ì¦ ì„±ê³µ â†’ panel-cert ì•ˆì˜ joint-extra í–‰ë“¤ì„ ë³´ì—¬ì£¼ê¸°
                document.querySelectorAll("#panel-cert .joint-extra")
                    .forEach(tr => tr.style.display = "");

                const statusBox = document.getElementById("jointStatus");
                if (statusBox) statusBox.style.display = "block";

                verifyState.joint = true;

                // ëª¨ë‹¬ ë‹«ê¸°
                modal.setAttribute("aria-hidden", "true");

                alert("ê³µë™ì¸ì¦ì„œ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");

                // ì´ë¦„ ì…ë ¥ì¹¸ì— í¬ì»¤ìŠ¤
                const nameInput = document.querySelector("#panel-cert .joint-extra input[name='mname']");
                if (nameInput) nameInput.focus();

            } catch (e) {
                console.error(e);
                alert("ê³µë™ì¸ì¦ì„œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });
    })();
    flatpickr("#jointBirthInput", {
        locale: "ko",
        dateFormat: "Y-m-d"
    });
</script>
  <footer><div th:replace="~{layouts/footer.html}"></div></footer>
</body>

<style>
  main {
    width: 1200px;
    background: #F6F6F8;
    padding: 80px 20px;
    margin: 0 auto;
  }
  body {
    font-family: 'Noto Sans KR', 'ë§‘ì€ ê³ ë”•', sans-serif;
    background: #F6F6F8;
    color: #111827;
    line-height: 1.5;
  }
  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 28px 16px 40px;
  }
  /* stepper */
  .stepper {
    width: 800px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f7f7f9;
    border: 1px solid #e5e7eb;
    border-radius: 999px;
    padding: 10px 20px;
  }
  .step {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #6b7280;
    font-weight: 600;
  }
  .step .dot {
    width: 28px;
    height: 28px;
    border-radius: 999px;
    display: grid;
    place-items: center;
    border: 1px solid #d1d5db;
    background: #fff;
    color: #6b7280;
    font-weight: 700;
  }
  .step.active {
    color: #111;
  }
  .step.active .dot {
    background: #d6001c;
    border-color: #d6001c;
    color: #fff;
  }
  .sep {
    width: 28px;
    height: 2px;
    background: #e5e7eb;
    border-radius: 2px;
  }
  /* input */
  .input {
    width: 100%;
    height: 44px;
    box-sizing: border-box;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    background: #fff;
    padding: 10px 12px;
    font-size: 14px;
    color: #111827;
    outline: none;
    transition: box-shadow .15s ease, border-color .15s ease;
  }
  .input:focus {
    border-color: #d1d5db;
    box-shadow: 0 0 0 3px rgba(214, 0, 28, .12);
  }
  /* buttons */
  .btns {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 22px;
  }

  a{ text-decoration:none; color:inherit; }

  .form-card{ background:#fff; border:1px solid #e5e7eb; border-radius:20px; box-shadow:0 10px 20px rgba(2,6,23,.06); padding:30px 20px 30px; margin:0 auto; max-width:800px; }

  .verify-methods{ display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:18px; }
  .method-card{ appearance:none; border:1px solid #E5E7EB; background:#fff; border-radius:12px; padding:30px; text-align:left; cursor:pointer; position:relative; transition:box-shadow .15s, border-color .15s; }
  .method-card:hover{ box-shadow:0 6px 18px rgba(2,6,23,.06); }
  .method-card.active{ border:2px solid #D6001C; box-shadow:0 6px 16px rgba(214,0,28,.12); }
  .m-title{ display:flex; gap:10px; align-items:center; margin-bottom:6px; }
  .m-badge,.m-badge1{ width:32px; height:32px; border-radius:8px; display:grid; place-items:center; color:#fff; font-size:16px; }
  .m-badge{ background:#F95654; }   /* ì•„ì´ì½˜ ë°°ê²½ */
  .m-badge1{ background:#095399; }
  .m-name{ font-weight:700; font-size:16px; }
  .m-sub{ font-weight:600; }
  .m-list{ margin:6px 0 28px 0; padding-left:18px; color:#4B5563; font-size:15px; line-height:1.4; }
  .m-list li{ list-style:disc; padding-top:5px; }

  /* í…Œì´ë¸” í¼ ê³µí†µ */
  .auth-table {
    width: 730px;
    height: 530px;
    border-collapse: separate;
    border-spacing: 0 12px;
  }

  .auth-table th {
    text-align: left;
    vertical-align: middle;
    padding: 4px 0 4px 10px;
    width: 90px;
    font-size: 14px;
    font-weight: 600;
    color: #374151;
  }

  .auth-table td {
    padding-right: 10px;
    vertical-align: middle;
  }

  .field-label{ font-weight:700; }

  .note-blue{ display:flex; align-items:center; gap:8px; min-height:44px; padding:10px 12px; border:1px solid #C7D2FE; background:#EFF6FF; color:#1E40AF; border-radius:10px; font-size:13px; }
  .bullet{ width:18px; height:18px; border-radius:50%; color:#fff; font-weight:700; display:flex; align-items:center; justify-content:center; font-size:12px; }

  .helper-box{ margin-top:20px; background:#FFFBEB; border:1px solid #FDE68A; border-radius:12px; padding:14px 16px; }
  .helper-title{ font-weight:700; color:#92400E; margin-bottom:6px; }
  .helper-list{ margin:0; padding-left:18px; color:#92400E; font-size:13px; }
  .helper-list li{ list-style:disc; line-height:1.5; }

  /* ëª¨ë‹¬ */
  #certModal[aria-hidden="true"] { display:none; }
  #certModal[aria-hidden="false"] { display:block; }
  #certModal .modal-backdrop{
    position:fixed; inset:0; background:rgba(0,0,0,.45); backdrop-filter: blur(2px);
  }
  #certModal .modal-dialog{
    position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
    width: 520px; max-width: 92vw;
    background:#fff; border:1px solid #e5e7eb; border-radius:16px;
    box-shadow: 0 20px 60px rgba(2,6,23,.2); padding: 18px;
  }
  #certModal .modal-header{
    display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;
  }
  #certModal .modal-close{
    width:32px; height:32px; border-radius:8px; border:1px solid #e5e7eb; background:#fff; cursor:pointer;
  }
  #certModal .modal-body{ padding: 6px 2px; }
  #certModal .modal-footer{ display:flex; gap:10px; margin-top:14px; }
  input[type="file"]::-webkit-file-upload-button { display: none; }
  .joint-status { margin-bottom: 8px; border-radius: 10px; border: 1px solid #BBF7D0;
      background: #ECFDF3; font-size: 13px; padding: 10px 0 10px 34px; position: relative; }
  .joint-status::before {
      content: "âœ”";
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #16a34a;
      font-size: 16px;
      font-weight: 700;
  }
</style>
</html>
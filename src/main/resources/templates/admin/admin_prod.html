<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>admin_prod</title>
    <style>
        .page-btn.placeholder{
            visibility:hidden; /* 보이진 않지만 레이아웃은 유지 */
        }
    </style>
</head>
<body>
  <header>
      <div th:replace="~{layouts/admin_header.html}"></div>
  </header>
  <script>
    async function includeWithScripts(targetSelector, url) {
      const res = await fetch(url, { credentials: 'same-origin' });
      if (!res.ok) throw new Error(`Failed to load ${url}`);
      const html = await res.text();

      const target = document.querySelector(targetSelector);
      target.innerHTML = html;

      // 삽입된 영역 안의 <script>들을 실행되도록 교체
      const scripts = target.querySelectorAll('script');
      for (const oldScript of scripts) {
        const newScript = document.createElement('script');

        // type, src, async, defer 등 속성 복사
        for (const { name, value } of [...oldScript.attributes]) {
          newScript.setAttribute(name, value);
        }
        // inline 스크립트라면 코드 복사
        if (!oldScript.src) newScript.text = oldScript.textContent;

        // 실행을 위해 문서에 부착
        // (src가 있으면 네트워크 로드, 없으면 즉시 실행)
        oldScript.replaceWith(newScript);

        // src 스크립트 로드를 기다려야 한다면:
        if (newScript.src) {
          await new Promise((res) => {
            newScript.addEventListener('load', res, { once: true });
            newScript.addEventListener('error', res, { once: true });
          });
        }
      }
    }

    // (2) includeWithScripts - 올바른 방법
    includeWithScripts('#header', '/layouts/admin_header.html')
    .then(() => {
      // 환경설정 메뉴 활성화
      window.initAdminHeader && window.initAdminHeader('product');
    })
    .catch(console.error);
    document.addEventListener('DOMContentLoaded', () => {
        if (window.initAdminHeader) window.initAdminHeader('product');
    });
  </script>

  <main style="background-color: #F6F6F8; display: flex; justify-content: center;">
    <div style="width: 1200px; ">
      <div>
        <div style="font-size: 24px; color: #4B5563;">상품관리</div>
        <div style="display: flex;">
          <div style="font-size: 16px; color: #4B5563;">상품 목록/등록/수정/삭제 , 상품 가입 현황을 관리합니다.</div>
          <div style="margin-left: auto; display: flex; justify-content: center; align-items: center; font-size: 14px; background-color: white; width: 165px; height: 40px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB;">
            <div style="display: flex; align-items: center;">
              <svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_194_44)">
                <path d="M7 8C8.06087 8 9.07828 7.57857 9.82843 6.82843C10.5786 6.07828 11 5.06087 11 4C11 2.93913 10.5786 1.92172 9.82843 1.17157C9.07828 0.421427 8.06087 0 7 0C5.93913 0 4.92172 0.421427 4.17157 1.17157C3.42143 1.92172 3 2.93913 3 4C3 5.06087 3.42143 6.07828 4.17157 6.82843C4.92172 7.57857 5.93913 8 7 8ZM5.57188 9.5C2.49375 9.5 0 11.9937 0 15.0719C0 15.5844 0.415625 16 0.928125 16H13.0719C13.1281 16 13.1813 15.9938 13.2375 15.9844C10.8531 14.2625 10.1187 11.5781 10.0156 9.72812C9.5125 9.57812 8.98125 9.5 8.43125 9.5H5.57188ZM15.2219 7.05312L11.4719 8.55313C11.1875 8.66875 11 8.94375 11 9.25C11 11.2281 11.8094 14.525 15.2125 15.9438C15.3969 16.0219 15.6062 16.0219 15.7906 15.9438C19.1906 14.525 20 11.2281 20 9.25C20 8.94375 19.8125 8.66875 19.5281 8.55313L15.7781 7.05312C15.6 6.98125 15.4 6.98125 15.2219 7.05312ZM18.4813 9.75C18.3594 11.3344 17.6312 13.3969 15.5 14.4281V8.55625L18.4813 9.75Z" fill="#E6002D"/>
                </g>
                <defs>
                <clipPath id="clip0_194_44">
                <path d="M0 0H20V16H0V0Z" fill="white"/>
                </clipPath>
                </defs>
              </svg>
              <div style="margin-left: 10px;">관리자: Admin</div>
            </div>
          </div>
        </div>
      </div>
    <!-- 1) Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>

    <!-- 2) IRP / DC / DB 평균 금리 막대그래프 -->
    <div class="chart-card" style="
  background:#fff; border:1px solid #E5E7EB; border-radius:16px;
  box-shadow:0 2px 8px rgba(0,0,0,.05); padding:16px; margin-top:24px;
  width:100%; box-sizing:border-box;
">
        <div style="display: flex;">
            <div style="width:582.9px;">
                <div class="chart-head" style="display:flex; align-items:center;">
                    <div style="margin-left: 30px; margin-top: 10px; margin-bottom: 10px;">
                        <div style="font-size:20px; color:#2B2F36;">IRP / DC / DB 평균 금리 비교</div>
                        <div style="margin-top:7px;font-size:12px; color:#9CA3AF;">상품군별 평균 기본금리(%)</div>
                    </div>
                </div>

                <div style="margin-top:8px; width:100%; overflow:hidden; margin-bottom:10px;">
                    <canvas id="rateBarChart" width="550" height="270" style="display:block;"></canvas>
                </div>
            </div>
            <div style="width:582.9px;">
                <div class="chart-head" style="display:flex; align-items:center;">
                    <div style="margin-left: 30px; margin-top: 10px; margin-bottom: 10px;">
                        <div style="font-size:20px; color:#2B2F36;">펀드 위험등급 분포</div>
                        <div style="margin-top:7px;font-size:12px; color:#9CA3AF;">위험등급별 펀드 상품 개수</div>
                    </div>
                </div>

                <div style="margin-top:8px; width:100%; overflow:hidden; margin-bottom:10px; display:flex; justify-content:center;">
                    <!-- 크기는 적당히 조절 가능 -->
                    <canvas id="riskPieChart" width="400" height="260" style="display:block;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        const avgIrp = /*[[${pbIRP}]]*/ 0;
        const avgDc  = /*[[${pbDC}]]*/ 0;
        const avgDb  = /*[[${pbDB}]]*/ 0;

        const ctxRate = document.getElementById('rateBarChart').getContext('2d');

        // 데이터 중 최대값 기준으로 y축 상한 계산 (0.5 여유)
        const maxRate = Math.max(avgIrp, avgDc, avgDb);
        const yMax = Math.ceil(maxRate + 0.5);   // 예: 최대가 2.7 → 3으로 설정

        new Chart(ctxRate, {
            type: 'bar',
            data: {
                labels: ['IRP', 'DC', 'DB'],
                datasets: [{
                    label: '평균 기본금리(%)',
                    data: [avgIrp, avgDc, avgDb],
                    backgroundColor: ['#D91A1A', '#FF8B00', '#1CB26C'],
                    borderRadius: 8,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: false,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display:false },
                    tooltip: {
                        callbacks: {
                            label: function(ctx) {
                                const v = ctx.parsed.y ?? 0;
                                return ` ${v.toFixed(2)} %`;
                            }
                        }
                    }
                },
                layout: { padding: { left:16, right:16, top:16, bottom:16 } },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: {
                            color: '#6B7280',
                            font: { size: 12 }
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '금리(%)',
                            color: '#6B7280',
                            font: { size: 12, weight: '600' }
                        },
                        beginAtZero: true,
                        max: yMax,                 // ✅ 축 상한을 직접 지정
                        ticks: {
                            color: '#6B7280',
                            font: { size: 12 }
                        },
                        grid: { color: '#F0F0F3' }
                    }
                }
            }
        });
    </script>

    <script th:inline="javascript">
        // 등급별 펀드 개수 (컨트롤러에서 온 값)
        const danger1 = /*[[${Danger1Fund}]]*/ 0;
        const danger2 = /*[[${Danger2Fund}]]*/ 0;
        const danger3 = /*[[${Danger3Fund}]]*/ 0;
        const danger4 = /*[[${Danger4Fund}]]*/ 0;
        const danger5 = /*[[${Danger5Fund}]]*/ 0;
        const danger6 = /*[[${Danger6Fund}]]*/ 0;

        const ctxRisk = document.getElementById('riskPieChart').getContext('2d');

        const riskData = [danger1, danger2, danger3, danger4, danger5, danger6];
        const riskLabels = [
            '1등급 (매우높은위험)',
            '2등급 (높은위험)',
            '3등급 (다소높은위험)',
            '4등급 (보통위험)',
            '5등급 (낮은위험)',
            '6등급 (매우낮은위험)'
        ];

        new Chart(ctxRisk, {
            type: 'pie',
            data: {
                labels: riskLabels,
                datasets: [{
                    data: riskData,
                    backgroundColor: [
                        '#EF4444', // 1등급
                        '#FB923C', // 2등급
                        '#FACC15', // 3등급
                        '#A3E635', // 4등급
                        '#22C55E', // 5등급
                        '#0EA5E9'  // 6등급
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: false,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 10,
                            boxHeight: 10,
                            usePointStyle: true,
                            pointStyle: 'circle',
                            color: '#4B5563',
                            font: { size: 11 }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(ctx) {
                                const label = ctx.label || '';
                                const value = ctx.parsed;
                                const dataArr = ctx.dataset.data || [];
                                const total = dataArr.reduce((a, b) => a + b, 0);
                                const percent = total ? (value / total * 100).toFixed(1) : 0;
                                return ` ${label}: ${value}개 (${percent}%)`;
                            }
                        }
                    }
                }
            }
        });
    </script>
      <div style="margin-top:50px;border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB; overflow: hidden;">
        <table style="border-collapse: collapse; width: 100%;">
          <tr style="color: #2B2F36; font-size: 14px; height: 52px; border-bottom: 1px #E5E7EB;">
            <th style="width: 120px;">상품ID</th>
            <th style="width: 290px;">상품명</th>
            <th style="width: 140px;">금리/총 보수</th>
            <th style="width: 190px;">기간/위험등급</th>
            <th style="width: 170px;">유형</th>
            <th style="width: 170px;">등록일/설정일</th>
            <th>관리</th>
          </tr>
          <tr style="font-size: 14px; text-align: center; height: 63.5px; background-color: white;"
              th:each="row, stat:${pageResponseDTO.dtoList}">
            <td><span th:text="${row.productId}"></span></td>
            <td><span th:text="${row.name}"></span></td>
            <td style="color: #D91A1A;"><span th:text="${row.rateOrFee}"></span>%</td>
            <td><span th:text="${row.periodOrRisk}"></span></td>
            <td style="vertical-align: middle; text-align: center;">
              <span th:text="${row.statusOrType}"></span>
            </td>
            <td><span th:text="${row.regOrSetDate}"></span></td>
            <td style="vertical-align: middle; text-align: center;">
              <div style="display: flex; align-items: center; justify-content: center; gap: 0px;">
                <button type="button"
                        class="btn-modify"
                        style="display:inline-flex; align-items:center; justify-content:center;
                              width:32px; height:32px; border:none; background:transparent; 
                              border-radius:6px; cursor:pointer;"
                        aria-label="상품 수정"
                        th:data-url="${row.modifyUrl}">
                  <svg width="16" height="24" viewBox="0 0 16 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_191_277)">
                    <path d="M14.7375 5.67832C14.0531 4.99395 12.9469 4.99395 12.2625 5.67832L11.3219 6.61582L14.3813 9.6752L15.3219 8.73457C16.0063 8.0502 16.0063 6.94395 15.3219 6.25957L14.7375 5.67832ZM5.3875 12.5533C5.19687 12.7439 5.05 12.9783 4.96562 13.2377L4.04063 16.0127C3.95 16.2814 4.02188 16.5783 4.22188 16.7814C4.42188 16.9846 4.71875 17.0533 4.99062 16.9627L7.76562 16.0377C8.02188 15.9533 8.25625 15.8064 8.45 15.6158L13.6781 10.3846L10.6156 7.32207L5.3875 12.5533ZM3 7.0002C1.34375 7.0002 0 8.34395 0 10.0002V18.0002C0 19.6564 1.34375 21.0002 3 21.0002H11C12.6562 21.0002 14 19.6564 14 18.0002V15.0002C14 14.4471 13.5531 14.0002 13 14.0002C12.4469 14.0002 12 14.4471 12 15.0002V18.0002C12 18.5533 11.5531 19.0002 11 19.0002H3C2.44688 19.0002 2 18.5533 2 18.0002V10.0002C2 9.44707 2.44688 9.0002 3 9.0002H6C6.55312 9.0002 7 8.55332 7 8.0002C7 7.44707 6.55312 7.0002 6 7.0002H3Z" fill="#2B2F36"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_191_277">
                    <path d="M0 5H16V21H0V5Z" fill="white"/>
                    </clipPath>
                    </defs>
                  </svg>
                </button>
                <button type="button"
                        class="btn-delete"
                        style="display:inline-flex; align-items:center; justify-content:center;
                              width:32px; height:32px; border:none; background:transparent; 
                              border-radius:6px; cursor:pointer;"
                        aria-label="상품 삭제"
                        th:attr="data-delete-url=${row.deleteUrl}">
                  <svg width="14" height="24" viewBox="0 0 14 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_191_278)">
                    <path d="M4.225 5.55313L4 6H1C0.446875 6 0 6.44687 0 7C0 7.55312 0.446875 8 1 8H13C13.5531 8 14 7.55312 14 7C14 6.44687 13.5531 6 13 6H10L9.775 5.55313C9.60625 5.2125 9.25938 5 8.88125 5H5.11875C4.74062 5 4.39375 5.2125 4.225 5.55313ZM13 9H1L1.6625 19.5938C1.7125 20.3844 2.36875 21 3.15937 21H10.8406C11.6312 21 12.2875 20.3844 12.3375 19.5938L13 9Z" fill="#D91A1A"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_191_278">
                    <path d="M0 5H14V21H0V5Z" fill="white"/>
                    </clipPath>
                    </defs>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </table>
        <script>
          window.addEventListener('DOMContentLoaded', () => {
            // 상태 텍스트 → 배지 스타일 매핑
            const BADGE = {
              '활성': { color:'#1CB26C', bg:'#ddfced', w:46, h:24 },
              '종료'  : { color:'#C8CBD0', bg:'#f5f6f7', w:46, h:24 },
              '대기'  : { color:'#FF8B00', bg:'#f8ebda', w:46, h:24 },
            };

            // 테이블의 5번째 컬럼(상태) 모든 셀을 순회
            document.querySelectorAll('table tr td:nth-child(5)').forEach(td => {
              const status = td.textContent.trim();   // 셀 안의 상태 텍스트
              const s = BADGE[status];
              if (!s) return; // 매핑 없으면 패스

              td.innerHTML = `
                <div style="
                  margin:auto; font-size:12px; color:${s.color};
                  background-color:${s.bg}; border-radius:20px;
                  width:${s.w}px; height:${s.h}px;
                  display:flex; justify-content:center; align-items:center;">
                  ${status}
                </div>`;
            });
          });
          ///////////////////////////////////
          // 상태 필터
          const $filter = document.querySelector('select[name="condition"]');

          // value → 표시 텍스트 매핑
          const MAP = {
            active: '활동중',
            inactivity: '휴면',
            withdrawl: '탈퇴'
          };

          function applyStatusFilter() {
            const val = $filter.value;               // all | active | inactivity | withdrawl
            const want = MAP[val];                   // undefined면 '전체' 의미

            // 헤더를 제외한 모든 행에 대해 필터링
            document.querySelectorAll('table tr').forEach((tr, i) => {
              if (i === 0) return; // 헤더 행 건너뛰기
              const status = tr.querySelector('td:nth-of-type(5)')?.textContent.trim();
              const show = (val === 'all') || (status === want);
              tr.style.display = show ? '' : 'none';
            });
          }

          // 초기 적용 + 변경 시 적용
          $filter.addEventListener('change', applyStatusFilter);
          document.addEventListener('DOMContentLoaded', applyStatusFilter);
        </script>
      </div>
      <div class="pager" style="width: 100%;margin-top: 25px; display:grid; grid-template-columns: 1fr auto 1fr; align-items:center;">
        <div style="display: flex; grid-column: 2; width: 100%;">
            <a th:if="${pageResponseDTO.prev}" th:href="@{/admin/prod(pg=${pageResponseDTO.pg - 1})}" class="prev page-btn page-prev">
                <!-- 이전 아이콘 -->
                <svg width="10" height="16" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.293701 7.29414C-0.0969238 7.68477 -0.0969238 8.31914 0.293701 8.70977L6.2937 14.7098C6.68433 15.1004 7.3187 15.1004 7.70933 14.7098C8.09995 14.3191 8.09995 13.6848 7.70933 13.2941L2.41558 8.00039L7.7062 2.70664C8.09683 2.31602 8.09683 1.68164 7.7062 1.29102C7.31558 0.900391 6.6812 0.900391 6.29058 1.29102L0.290576 7.29102L0.293701 7.29414Z" />
                </svg>
            </a>
            <span th:unless="${pageResponseDTO.prev}" class="page-btn placeholder" aria-hidden="true"></span>

            <th:block th:each="num:${#numbers.sequence(pageResponseDTO.start, pageResponseDTO.end)}">
                <a th:href="@{/admin/prod(pg=${num})}" th:class="${num == pageResponseDTO.pg ? 'page-btn is-active' : 'page-btn'}" style="margin-right: 8px; text-decoration: none;">[[${num}]]</a>
            </th:block>

            <a th:if="${pageResponseDTO.next}" th:href="@{/admin/prod(pg=${pageResponseDTO.pg + 1})}" class="next page-btn page-next">
                <svg width="10" height="16" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9.70615 7.29414C10.0968 7.68477 10.0968 8.31914 9.70615 8.70977L3.70615 14.7098C3.31553 15.1004 2.68115 15.1004 2.29053 14.7098C1.8999 14.3191 1.8999 13.6848 2.29053 13.2941L7.58428 8.00039L2.29365 2.70664C1.90303 2.31602 1.90303 1.68164 2.29365 1.29102C2.68428 0.900391 3.31865 0.900391 3.70928 1.29102L9.70928 7.29102L9.70615 7.29414Z" fill="#2B2F36"/>
                </svg>
            </a>
            <span th:unless="${pageResponseDTO.next}" class="page-btn placeholder" aria-hidden="true"></span>

        </div>
        <div style="grid-column: 3; margin-left: auto; box-sizing: border-box;">
          <button th:onclick="|location.href='@{/admin/prod/register}'|" class="btn-register" style="gap:6px; box-sizing: border-box; width: 140px; height: 42px; background-color: #D91A1A; color: white; border:none; border-radius: 8px; cursor: pointer;">
            <div style="display: flex; justify-content: center; align-items: center; gap: 8px;">
              <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 2.5C8 1.94687 7.55312 1.5 7 1.5C6.44688 1.5 6 1.94687 6 2.5V7H1.5C0.946875 7 0.5 7.44688 0.5 8C0.5 8.55312 0.946875 9 1.5 9H6V13.5C6 14.0531 6.44688 14.5 7 14.5C7.55312 14.5 8 14.0531 8 13.5V9H12.5C13.0531 9 13.5 8.55312 13.5 8C13.5 7.44688 13.0531 7 12.5 7H8V2.5Z" fill="white"/>
              </svg>
              <div>
                예적금 상품 등록
              </div>
            </div>
          </button>
            <button th:onclick="|location.href='@{/admin/fund/register}'|" class="btn-register" style="gap:6px; box-sizing: border-box; width: 130px; height: 42px; background-color: #D91A1A; color: white; border:none; border-radius: 8px; cursor: pointer;">
            <div style="display: flex; justify-content: center; align-items: center; gap: 8px;">
              <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 2.5C8 1.94687 7.55312 1.5 7 1.5C6.44688 1.5 6 1.94687 6 2.5V7H1.5C0.946875 7 0.5 7.44688 0.5 8C0.5 8.55312 0.946875 9 1.5 9H6V13.5C6 14.0531 6.44688 14.5 7 14.5C7.55312 14.5 8 14.0531 8 13.5V9H12.5C13.0531 9 13.5 8.55312 13.5 8C13.5 7.44688 13.0531 7 12.5 7H8V2.5Z" fill="white"/>
              </svg>
              <div>
                펀드 상품 등록
              </div>
            </div>
          </button>
        </div>
      </div>
      <style>
        .btn-register {
          --bg1: #D91A1A;
          --bg2: #F03A3A;
          --shadow: rgba(217,26,26,.45);
          position: relative;
          box-sizing: border-box;
          width: 90px; height: 42px;
          border: none; border-radius: 8px;
          color: #fff; cursor: pointer;
          background: linear-gradient(180deg, var(--bg2), var(--bg1));
          outline: none;
          box-shadow: 0 6px 14px -10px var(--shadow);
          transition:
            background .18s ease,
            box-shadow .18s ease,
            transform .12s ease; /* 프레스만 사용할 예정 */
          will-change: background, box-shadow, transform;
        }

        /* Hover: 컬러와 섀도우만 아주 미세하게 (리프트 없음) */
        .btn-register:hover {
          background: linear-gradient(180deg, #f24a4a, #d61a1a);
          box-shadow: 0 8px 18px -12px var(--shadow);
          transform: none; /* 확실하게 떠오르지 않도록 고정 */
        }

        /* Active: 살짝 눌리는 프레스 효과만 */
        .btn-register:active {
          transform: scale(.98);
          box-shadow: 0 4px 10px -10px var(--shadow);
        }

        /* 키보드 포커스 접근성 */
        .btn-register:focus-visible {
          outline: 3px solid rgba(240,58,58,.55);
          outline-offset: 2px;
        }

        /* 모션 최소화 존중 */
        @media (prefers-reduced-motion: reduce) {
          .btn-register { transition: none !important; }
        }

        @media (prefers-color-scheme: dark) {
          .btn-register { --shadow: rgba(240,58,58,.35); }
        }
      </style>
      <style>
        .pager { gap: 8px; }
        .page-btn{
          width:42px; height:40px; border-radius:8px;
          border:1px solid transparent;
          background:#F6F6F8; color:#2B2F36; font-size:16px;
          display:flex; align-items:center; justify-content:center;
          cursor:pointer; transition:background .15s ease, box-shadow .15s ease, border-color .15s ease, color .15s ease;
        }
        .page-btn:hover{
          background:#FFFFFF;
          border-color:#E5E7EB;
          box-shadow:0 2px 8px rgba(0,0,0,.05);
        }
        .page-btn.is-active,
        .page-btn[aria-current="page"]{
          background:#FFFFFF;
          color:#D91A1A;
          border-color:#D91A1A;
          box-shadow:0 2px 8px rgba(217,26,26,.08);
          font-weight:600;
        }
        .page-btn:focus-visible{
          outline:none;
          box-shadow:0 0 0 3px rgba(217,26,26,.2);
        }
        /* 아이콘 색 */
        .page-btn svg path{ fill:#2B2F36; transition:opacity .15s ease, fill .15s ease; }
        .page-btn:hover svg path{ opacity:.9; }
        /* 비활성화가 필요할 경우 */
        .page-btn.is-disabled{ opacity:.4; pointer-events:none; }
      </style>
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const pager = document.querySelector('.pager');
          if(!pager) return;

          pager.addEventListener('click', (e) => {
            const btn = e.target.closest('.page-btn');
            if(!btn || btn.classList.contains('page-prev') || btn.classList.contains('page-next')) return;

            pager.querySelectorAll('.page-btn').forEach(b=>{
              b.classList.remove('is-active');
              b.removeAttribute('aria-current');
            });
            btn.classList.add('is-active');
            btn.setAttribute('aria-current','page');
            // TODO: 실제 페이지 전환 로직 연결
          });
        });
      </script>

    </div>
  </main>

  <div id="bnk-chatbot-container" style="position: fixed; right: 20px; bottom: 20px; z-index: 9999;">
    <div id="bnk-chatbot-slot"></div>
  </div>
  <script>
  /**
   * 외부 HTML을 불러와서:
   *  - <link rel="stylesheet">, <style>는 <head>로 옮기고
   *  - <script>는 실행되도록 새로 만들어 붙이고 (src/inline, module 모두 지원)
   *  - 나머지 DOM(예: <flowise-chatbot> / <flowise-embed>)은 mount에 삽입
   */
  async function importHtmlWithAssets(url, mountSelector) {
    const res = await fetch(url, { credentials: 'same-origin' });
    if (!res.ok) throw new Error(`Failed to load ${url}`);
    const html = await res.text();

    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    // 1) <link rel="stylesheet"> 들을 <head>로
    doc.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
      // 중복 로드 방지
      const href = link.getAttribute('href');
      if (href && ![...document.head.querySelectorAll('link[rel="stylesheet"]')]
        .some(l => l.getAttribute('href') === href)) {
        document.head.appendChild(link.cloneNode(true));
      }
    });

    // 2) <style> 들을 <head>로
    doc.querySelectorAll('style').forEach(styleEl => {
      const clone = document.createElement('style');
      // CSS 텍스트 보존
      clone.textContent = styleEl.textContent;
      // (가능한 속성 복사)
      [...styleEl.attributes].forEach(a => clone.setAttribute(a.name, a.value));
      document.head.appendChild(clone);
    });

    // 3) 본문 콘텐츠를 mount에 붙임 (스크립트 제외)
    const mount = document.querySelector(mountSelector);
    // fragment 구성
    const frag = document.createDocumentFragment();
    [...doc.body.children].forEach(node => {
      if (node.tagName.toLowerCase() !== 'script') frag.appendChild(node.cloneNode(true));
    });
    mount.appendChild(frag);

    // 4) 스크립트 실행 (src/inline/module 지원, 순서 보장)
    const scripts = [...doc.querySelectorAll('script')];
    for (const oldScript of scripts) {
      const newScript = document.createElement('script');
      // type/module/defer 등 속성 복사
      [...oldScript.attributes].forEach(attr => newScript.setAttribute(attr.name, attr.value));
      if (oldScript.src) {
        // 네트워크 로드를 기다려 실행 순서 유지
        await new Promise((resolve, reject) => {
          newScript.onload = resolve;
          newScript.onerror = resolve;   // 실패해도 진행(브랜딩 제거 같은 선택 기능 보호)
          document.body.appendChild(newScript);
        });
      } else {
        // inline 코드 복사
        newScript.textContent = oldScript.textContent || '';
        document.body.appendChild(newScript);
      }
    }
  }

  // 실제 호출: 기존 chatbot.html(또는 chatbot_test.html) 경로로 바꿔도 됩니다.
  importHtmlWithAssets('/components/chatbot_test.html', '#bnk-chatbot-slot')
    .catch(err => console.error('[Chatbot load failed]', err));
  </script>
  <footer>
      <div th:replace="~{layouts/footer.html}"></div>
  </footer>
  <div th:if="${toastSuccess}" class="toast success" th:text="${toastSuccess}"></div>
  <div th:if="${toastError}" class="toast error"   th:text="${toastError}"></div>
  <style>
      .toast{
          position: fixed; left:50%; bottom:28px; transform:translateX(-50%);
          min-width:260px; max-width:90vw; padding:14px 16px; border-radius:10px;
          color:#fff; box-shadow:0 10px 24px rgba(0,0,0,.28);
          font-size:14px; text-align:center; z-index:10000; opacity:0;
          transition:opacity .22s ease, transform .22s ease; display:none;
      }
      .toast.show{ display:block; opacity:1; transform:translate(-50%,-4px); }
      .toast.success{ background:#111827; }
      .toast.error{   background:#B91C1C; }
  </style>

  <script>
      function showToastEl(el, duration = 2200) {
          if (!el) return;
          el.style.display = 'block';
          requestAnimationFrame(() => el.classList.add('show'));
          setTimeout(() => {
              el.classList.remove('show');
              setTimeout(() => { el.style.display = 'none'; }, 220);
          }, duration);
      }

      // 페이지 로드 시 표시 (존재하는 것만)
      document.addEventListener('DOMContentLoaded', () => {
          showToastEl(document.querySelector('.toast.success'));
          showToastEl(document.querySelector('.toast.error'));
      });
  </script>
  <script>
      document.addEventListener('DOMContentLoaded', () => {
          const table = document.querySelector('table');
          if (!table) return;

          table.addEventListener('click', (e) => {
              // 1) 수정 버튼 클릭
              const modifyBtn = e.target.closest('.btn-modify');
              if (modifyBtn) {
                  const url = modifyBtn.dataset.url;
                  if (url) {
                      location.href = url;
                  }
                  return;
              }

              // 2) 삭제 버튼 클릭
              const btn = e.target.closest('.btn-delete');
              if (!btn) return; // 둘 다 아니라면 무시

              const tr = btn.closest('tr');
              const productName = tr?.querySelector('td:nth-of-type(2)')?.textContent.trim();
              const msg = (productName ? `${productName}을(를) ` : '') + '삭제하시겠습니까?';

              if (!confirm(msg)) {
                  return;
              }

              const url = btn.dataset.deleteUrl;
              if (url) {
                  location.href = url;
              }
          });
      });
  </script>

</body>
</html>
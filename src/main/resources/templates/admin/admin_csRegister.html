<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../static/components/button.css">
    <title>admin_csRegister</title>
      <style>
        .input-suffix {
          position: relative;
          display: inline-block;
          width: 557px;            /* 원래 쓰시던 너비로 */
          height: 42px;
        }
        .input-suffix input {
          box-sizing: border-box;
          width: 100%;
          height: 100%;
          padding-left: 15px;
          padding-right: 36px;     /* ← %가 겹치지 않도록 여백 확보 */
          font-size: 16px;
          border: 1px solid #D1D5DB;
          border-radius: 6px;
          outline: none;
        }
        .input-suffix .suffix {
          position: absolute;
          right: 12px;             /* 우측 고정 위치 */
          top: 47%;
          transform: translateY(-50%);
          color: #6B7280;
          pointer-events: none;    /* 클릭 막아 입력에만 포커스 가도록 */
          font-size: 18px;
        }

        /* (선택) number 스핀 버튼 제거 (크롬/엣지) */
        .input-suffix input[type="number"]::-webkit-outer-spin-button,
        .input-suffix input[type="number"]::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        /* (선택) 파이어폭스 */
        .input-suffix input[type="number"] {
          -moz-appearance: textfield;
        }
      </style>
      <style>
        /* 기간(시작일~마감일) */
        .date-range {
          margin-top: 13px;
          width: 557px;       /* 기존 인풋 폭과 동일 */
          height: 42px;
          display: flex;
          align-items: center;
          gap: 10px;
        }
        .date-field {
          position: relative;
          flex: 1 1 0;
          height: 42px;
        }
        .date-input {
          box-sizing: border-box;
          width: 100%;
          height: 100%;
          padding: 0 40px 0 12px; /* 아이콘 공간 확보 */
          font-size: 14px;
          border: 1px solid #D1D5DB;
          border-radius: 6px;
          outline: none;
          background-color: #fff;
          color: #111827;
        }
        .date-input:focus {
          border-color: #9CA3AF;
          box-shadow: 0 0 0 3px rgba(156,163,175,.2);
        }
        .calendar-btn {
          position: absolute;
          right: 8px;
          top: 50%;
          transform: translateY(-50%);
          width: 28px;
          height: 28px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          border: none;
          background: transparent;
          cursor: pointer;
          color: #6B7280;
        }
        .calendar-btn:focus-visible {
          outline: 3px solid rgba(240,58,58,.55);
          border-radius: 6px;
          outline-offset: 2px;
        }
        .date-sep {
          color: #6B7280;
          font-size: 14px;
          user-select: none;
        }

        /* 다크 모드 살짝 */
        @media (prefers-color-scheme: dark) {
          .date-input {
            background: #111417;
            color: #E5E7EB;
            border-color: #2C3140;
          }
        }
      </style>
      <style>
        /* 기본 date 인풋 아이콘/컨트롤 제거 */
        .date-input {
          appearance: none;
          -moz-appearance: none;
          -webkit-appearance: none;
        }
        .date-input::-webkit-calendar-picker-indicator { display: none; }
        .date-input::-webkit-clear-button,
        .date-input::-webkit-inner-spin-button { display: none; }

        /* (선택) placeholder 톤 통일 */
        .date-input::placeholder { color:#9CA3AF; }
      </style>
      <style>
        input,
        textarea {
          font-family: 'Noto Sans KR', 'Segoe UI', sans-serif; /* input 기본 폰트에 맞춤 */
          font-size: 16px;
          font-weight: 400;
          line-height: 1.4;
        }

        input::placeholder,
        textarea::placeholder {
          font-weight: 400;   /* 동일 두께 */
          font-size: 16px;    /* 동일 크기 */
          line-height: 1.4;   /* 동일 행간 */
          opacity: 1;         /* 투명도 제거 */
        }
      </style>
      <style>
  .upload-card{
    margin-top: 13px;
    border:1px dashed #D1D5DB;
    border-radius:10px;
    background:#FBFBFD;
    min-height:200px;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer;
    transition: background .18s ease, border-color .18s ease, box-shadow .18s ease;
  }
  .upload-card:hover{ background:#F8FAFC; border-color:#C7CED6; }
  .upload-card.is-dragover{
    background:#F3F4F6;
    border-color:#94A3B8;
    box-shadow:0 0 0 3px rgba(148,163,184,.15) inset;
  }
  .upload-inner{ text-align:center; padding:24px 16px; color:#6B7280; }
  .upload-title{ margin-top:8px; font-size:14px; color:#6B7280; }
  .upload-sub{ margin-top:4px; font-size:12px; color:#9CA3AF; }

  .upload-result{ margin-top:10px; font-size:14px; }
  .file-chip{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 10px; border:1px solid #E5E7EB; border-radius:8px;
    background:#FFFFFF; color:#374151;
  }
  .file-chip .size{ color:#6B7280; font-size:12px; }
  .file-remove{
    border:none; background:transparent; cursor:pointer; color:#9CA3AF;
  }
  .file-remove:hover{ color:#6B7280; }
  .error{ color:#B91C1C; margin-top:6px; }
</style>
<style>
  @page { size: A4; margin: 12mm; }

@media print {
  /* 인쇄에 딱 맞는 폭으로 고정 (A4 내부 여백 감안) */
  #printRoot { width: 185mm !important; max-width: none !important; margin: 0 auto !important; }

  /* 화면 레이아웃/배경 해제 */
  main { display:block !important; margin:0 !important; padding:0 !important; }
  html, body { overflow: visible !important; background:#fff !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  [style*="background-color: #F6F6F8"] { background:#fff !important; }

  /* 카드가 페이지 중간에서 잘리지 않게 + 잘림 유발하는 overflow 해제 */
  [style*="padding: 25px"][style*="background-color: white"] {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
    overflow: visible !important;   /* ← 핵심 */
  }
  [style*="overflow: hidden"] { overflow: visible !important; } /* 혹시 남아있을 때 전역 방지 */

  /* 그림자 제거, 테두리만 유지 */
  * { box-shadow:none !important; }
  [style*="border: 1px solid #E5E7EB"] { border-color:#D1D5DB !important; }

  /* 불필요 UI 숨김 */
  .no-print, #header, #footer, #bnk-chatbot-container { display:none !important; }

  /* 링크 주소 출력 방지 */
  a[href]:after { content:""; }
}
@page { size: A4 portrait; margin: 0; } /* 여백 살짝 줄이기 */

@media print {
  /* A4 안전 여백 안쪽으로 살짝 줄여 버퍼 확보 */
  #printRoot {
    width: auto !important;
    max-width: 180mm !important;   /* 186mm → 180mm로 여유 */
    margin: 0 auto !important;
  }

  /* 화면용 고정폭/px 폭을 인쇄에서는 가변으로 */
  .date-range,
  .input-suffix,
  input, select, textarea {
    width: 100% !important;
  }

  /* 카드 잘림 방지 + overflow 해제 */
  [style*="padding: 25px"][style*="background-color: white"] {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
    overflow: visible !important;
    border-radius: 8px;         /* 모서리는 유지해도 무방 */
  }
  [style*="overflow: hidden"] { overflow: visible !important; }

  /* 필요 시 카드 안쪽 여백도 살짝 줄여 1페이지에 더 담기 */
  /* 주석 해제해서 사용
  [style*="padding: 25px"][style*="background-color: white"] {
    padding: 18px !important;
  }
  */

  /* 섹션 경계에서 확실히 넘기고 싶다면: '상세 설명' 앞에서 강제 개행 */
  /* 주석 해제해서 사용
  #printRoot > div:nth-of-type(2) {  page-break-before: always !important; }
  */

  /* 기타 */
  html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background:#fff !important; }
  * { box-shadow: none !important; }
  a[href]:after { content: ""; }
  .no-print, #header, #footer, #bnk-chatbot-container { display: none !important; }
  /* 폰트/기본 컬러 */
  body { font: 12pt 'Noto Sans KR', sans-serif; color:#111827; }

  /* 폼 컨트롤을 화면처럼 */
  input, select, textarea {
    width: 100% !important;
    height: 10mm !important;       /* 통일된 높이 */
    line-height: 10mm !important;
    padding: 0 10px !important;
    border: 1px solid #D1D5DB !important;
    background: #fff !important;
    color:#111827 !important;
    box-shadow: none !important;
    appearance: none !important;    /* OS 기본 화살표/그림자 제거 */
    -webkit-appearance: none !important;
  }
  textarea {
    min-height: 35mm !important;    /* 텍스트영역 너무 작아 보이는 것 보완 */
    line-height: 1.5 !important;
    padding: 10px !important;
  }
  select::-ms-expand { display:none; }

  /* % 접미사 위치 유지 */
  .input-suffix .suffix { right: 10px; top: 50%; transform: translateY(-50%); }

  /* 업로드 드롭존은 인쇄에서 숨기고, 선택 결과만 보이게 */
  #termsDropzone { display:none !important; }
  #termsResult { display:block !important; }

  /* 카드 모양/여백 안정화 */
  [style*="padding: 25px"][style*="background-color: white"] {
    padding: 18px !important;
    break-inside: avoid !important;
    page-break-inside: avoid !important;
    overflow: visible !important;
    border-radius: 8px !important;
  }
  html, body { margin:0 !important; background:#fff !important; }
  #printRoot {
    max-width: 200mm !important;   /* 180 → 200mm (거의 꽉 차게) */
    width: auto !important;
    margin: 0 auto !important;
    padding: 0 !important;
  }
}
@media print {
  /* 폼 컨트롤은 카드 안쪽 가로폭 100%로 */
  #printRoot input,
  #printRoot select,
  #printRoot textarea {
    width: 100% !important;
    max-width: none !important;
    box-sizing: border-box !important;
  }

  /* 두 칼럼 행(라벨/필드 묶음)에서 각 칼럼을 균등 분할 + 줄바꿈 방지 */
  #printRoot [style*="display: flex"][style*="gap: 25px"] > div {
    flex: 1 1 0 !important;
    min-width: 0 !important;
  }

  /* 금리 % 접미사 케이스 */
  #printRoot .input-suffix { width: 100% !important; }
  #printRoot .input-suffix input { width: 100% !important; padding-right: 32px !important; }

  /* 기간(날짜 범위) 인풋도 한 줄 가득 */
  #printRoot .date-range { width: 100% !important; }
  #printRoot .date-field { flex: 1 1 0 !important; min-width: 0 !important; }
}
@media print {
  /* 상세 설명 카드 textarea를 카드 폭 100%로 강제 */
  #printRoot textarea {
    display: block !important;
    width: 100% !important;
    max-width: none !important;
    box-sizing: border-box !important;
    padding: 10px 14px !important;
  }

  /* 인라인 width:1147px 무력화(명시적으로 매치) */
  #printRoot textarea[style*="width: 1147px"] {
    width: 100% !important;
  }

  /* textarea를 담는 flex-row에서도 칸을 꽉 채우도록 */
  #printRoot [style*="display: flex"][style*="margin-top: 20px"] > div {
    width: 100% !important;
    flex: 1 1 0 !important;
    min-width: 0 !important;
  }
}
</style>

</head>
<body>
  <header>
    <<div th:replace="~{layouts/admin_header.html}"></div>
  </header>

  <script>
    async function includeWithScripts(targetSelector, url) {
      const res = await fetch(url, { credentials: 'same-origin' });
      if (!res.ok) throw new Error(`Failed to load ${url}`);
      const html = await res.text();

      const target = document.querySelector(targetSelector);
      target.innerHTML = html;

      // 삽입된 영역 안의 <script>들을 실행되도록 교체
      const scripts = target.querySelectorAll('script');
      for (const oldScript of scripts) {
        const newScript = document.createElement('script');

        // type, src, async, defer 등 속성 복사
        for (const { name, value } of [...oldScript.attributes]) {
          newScript.setAttribute(name, value);
        }
        // inline 스크립트라면 코드 복사
        if (!oldScript.src) newScript.text = oldScript.textContent;

        // 실행을 위해 문서에 부착
        // (src가 있으면 네트워크 로드, 없으면 즉시 실행)
        oldScript.replaceWith(newScript);

        // src 스크립트 로드를 기다려야 한다면:
        if (newScript.src) {
          await new Promise((res) => {
            newScript.addEventListener('load', res, { once: true });
            newScript.addEventListener('error', res, { once: true });
          });
        }
      }
    }

    // (2) includeWithScripts - 올바른 방법
    includeWithScripts('#header', '/layouts/admin_header.html')
    .then(() => {
      // 환경설정 메뉴 활성화
      window.initAdminHeader && window.initAdminHeader('product');
    })
    .catch(console.error);
    document.addEventListener('DOMContentLoaded', () => {
        if (window.initAdminHeader) window.initAdminHeader('cs');
    });
  </script>


  <main style="background-color: #F6F6F8; display: flex; justify-content: center;">
      <div id="printRoot" style="width: 1200px; ">

          <!-- ✅ 여기서부터 form 시작 -->
          <form th:action="@{/admin/cs/register}"
                method="post"
                enctype="multipart/form-data"
                th:object="${document}">

              <!-- ✅ POST에서 @RequestParam으로 받는 group / type 같이 전송 -->
              <input type="hidden" name="group" th:value="${group}">
              <input type="hidden" name="type"  th:value="${type}">

              <!-- ==== 상단 타이틀/버튼 영역 ==== -->
              <div>
                  <div style="display: flex; font-size: 24px; color: #4B5563;">
                      <div>게시글등록</div>
                  </div>
                  <div style="display: flex;">
                      <div style="font-size: 16px; color: #4B5563;">
                          고객상담, 이용안내, 금융소비자보호, 상품공시실, 서식/약관/자료실의 새 글을 등록합니다.
                      </div>
                      <div style="display: flex; margin-left: auto; margin-right: 10px;">
                          <button th:onclick="|location.href='@{/admin/cs}'|"
                                  type="button"
                                  class="btn-pressable btn-sheen"
                                  style="box-sizing: border-box; width: 150px; height: 42.5px; border:none; border-radius: 8px; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB; background-color: white;">
                              목록으로 돌아가기
                          </button>
                      </div>
                      <div style="display: flex; justify-content: center; align-items: center; font-size: 14px; background-color: white; width: 165px; height: 40px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB;">
                          <div style="display: flex; align-items: center;">
                              <div style="margin-left: 10px;">관리자: Admin</div>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- ================= 기본 정보 카드 ================= -->
              <div style="padding: 25px; margin-top:25px; padding-bottom: 32px; background-color: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB; overflow: hidden;">
                  <div style="font-size:20px; color:#2B2F36;">
                      기본 정보
                  </div>
                  <div>

                      <!-- 제목 -->
                      <div style="display: flex; margin-top: 20px;">
                          <div>
                              <div style="display: flex;">
                                  <div style="margin-right: 2px;">글 제목</div>
                                  <div style="color: red;">*</div>
                              </div>
                              <div>
                                  <!-- ✅ doctitle 바인딩 -->
                                  <input id="titleInput"
                                         type="text"
                                         th:field="*{doctitle}"
                                         placeholder="게시글 제목을 입력하세요 (최대 100자)"
                                         style="margin-top: 13px; box-sizing: border-box; outline:none; padding-left:15px; font-size: 16px; width: 1140px; height: 42px; border:1px solid #D1D5DB; border-radius: 6px;">
                                  <div id="titleCounter" aria-live="polite"
                                       style="margin-top:3px; margin-left: 5px; font-size:12px; color:#6B7280;">
                                      0 / 100자
                                  </div>
                              </div>
                          </div>
                      </div>

                      <div style="display: flex; margin-top: 20px; gap: 25px;">
                          <!-- 작성자 (MID) -->
                          <div>
                              <div style="display: flex;"><div style="margin-right: 2px;">작성자</div></div>
                              <div>
                                  <!-- 화면 표시용 -->
                                  <input type="text"
                                         value="관리자"
                                         readonly
                                         style="background-color: #F9FAFB; margin-top: 13px; box-sizing: border-box; outline:none; padding-left:15px; font-size: 16px; width: 557px; height: 42px; border:1px solid #D1D5DB; border-radius: 6px;">
                                  <!-- ✅ 실제 전송용 MID -->
                                  <input type="hidden" th:field="*{mid}" value="admin"/>
                              </div>
                          </div>
                      </div>

                      <div style="display: flex; margin-top: 20px; gap: 25px;">
                          <!-- 등록일 (표시만, DB는 SYSDATE) -->
                          <div>
                              <div style="display: flex;">
                                  <div style="margin-right: 2px;">등록일</div><div style="color: red;">*</div>
                              </div>
                              <div class="date-range">
                                  <div class="date-field">
                                      <input type="date"
                                             id="startDate"
                                             class="date-input"
                                             placeholder="시작일"
                                             aria-label="시작일">
                                      <button type="button" class="calendar-btn" aria-label="시작일 달력 열기">
                                          <!-- 아이콘 -->
                                          ...
                                      </button>
                                  </div>
                              </div>
                          </div>

                          <!-- 상태 (추후 DB 컬럼 만들면 DTO에 필드 추가해서 th:field 로 바꿔도 됨) -->
                          <div>
                              <div style="display: flex;">
                                  <div style="margin-right: 2px;">상태</div><div style="color: red;">*</div>
                              </div>
                              <div>
                                  <select name="docstatus"
                                          style="margin-top: 13px; box-sizing: border-box; outline:none; padding-left:10px; font-size: 14px; width: 557px; height: 42px; border:1px solid #D1D5DB; border-radius: 6px;">
                                      <option value="">선택하세요</option>
                                      <option value="RECEIVE">접수</option>
                                      <option value="WAIT">대기</option>
                                      <option value="END">답변</option>
                                  </select>
                              </div>
                          </div>
                      </div>

                      <!-- ✅ docgroup은 현재 group값으로 DTO에 세팅 -->
                      <input type="hidden" th:field="*{docgroup}" th:value="${group}"/>

                  </div>
              </div>

              <!-- ================= 본문 작성 카드 ================= -->
              <div style="padding: 25px; margin-top:25px; padding-bottom: 32px; background-color: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB; overflow: hidden;">
                  <div style="font-size:20px; color:#2B2F36;">
                      본문 작성
                  </div>
                  <div>
                      <div style="display: flex; margin-top: 20px;">
                          <div>
                              <div style="display: flex;">
                                  <div style="margin-right: 2px;">내용</div><div style="color: red;">*</div>
                              </div>
                              <div>
                                  <!-- ✅ doccontent 바인딩 -->
                                  <textarea th:field="*{doccontent}"
                                            placeholder="게시글 내용을 입력하세요"
                                            style="height: 250px; margin-top: 13px; box-sizing: border-box; outline:none; padding-left:15px; font-size: 16px; width: 1147px; border:1px solid #D1D5DB; border-radius: 6px; background-color: white; resize: none; padding: 15px;"></textarea>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- 첨부파일 -->
                  <div style="margin-top:24px;">
                      <div style="margin-bottom:8px; color:#374151;">첨부파일</div>

                      <div id="termsDropzone" class="upload-card" role="button" tabindex="0" aria-label="파일을 드래그하거나 클릭하여 업로드">
                          <!-- ✅ name 추가 (컨트롤러에서 @RequestParam("uploadFile")로 받을 수 있음) -->
                          <input id="termsFile" type="file"
                                 name="uploadFile"
                                 accept=".pdf,.doc,.docx"
                                 hidden>
                          <div class="upload-inner">
                              <div class="upload-title">파일을 여기에 드래그하거나 클릭하여 업로드</div>
                              <div class="upload-sub">PDF, DOC, DOCX 파일만 업로드 가능 (최대 10MB)</div>
                          </div>
                      </div>

                      <div id="termsResult" class="upload-result" aria-live="polite"></div>
                  </div>
              </div>

              <!-- ================= 버튼 영역 ================= -->
              <div style="padding: 25px; margin-top:25px; background-color: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 1px solid #E5E7EB; overflow: hidden;">
                  <div style="display: flex; gap: 10px; justify-content: space-between;">
                      <div>
                          <button class="btn-pressable btn-sheen"
                                  id="btnPrint"
                                  type="button"
                                  style="box-sizing: border-box; width: 120px; height: 42px; border:none; border-radius: 8px; cursor: pointer; border:1px solid #D1D5DB; background-color: white;">
                              인쇄하기
                          </button>
                      </div>
                      <div style="display: flex; gap: 10px;">
                          <div>
                              <button class="btn-pressable btn-sheen"
                                      type="button"
                                      style="box-sizing: border-box; width: 65px; height: 42px; border:none; border-radius: 8px; cursor: pointer; border:1px solid #D1D5DB; background-color: white;">
                                  취소
                              </button>
                          </div>
                          <div>
                              <!-- ✅ 등록 버튼: submit -->
                              <button class="btn-register"
                                      type="submit"
                                      style="gap:6px; box-sizing: border-box; width: 120px; height: 42px; background-color: #D91A1A; color: white; border:none; border-radius: 8px; cursor: pointer;">
                                  <div style="display: flex; justify-content: center; align-items: center; gap: 8px;">
                                      등록하기
                                  </div>
                              </button>
                          </div>
                      </div>
                  </div>
              </div>

          </form>
          <!-- ✅ form 끝 -->

      </div>
  </main>



  <div id="bnk-chatbot-container" style="position: fixed; right: 20px; bottom: 20px; z-index: 9999;">
    <div id="bnk-chatbot-slot"></div>
  </div>
  <script>
  /**
   * 외부 HTML을 불러와서:
   *  - <link rel="stylesheet">, <style>는 <head>로 옮기고
   *  - <script>는 실행되도록 새로 만들어 붙이고 (src/inline, module 모두 지원)
   *  - 나머지 DOM(예: <flowise-chatbot> / <flowise-embed>)은 mount에 삽입
   */
  async function importHtmlWithAssets(url, mountSelector) {
    const res = await fetch(url, { credentials: 'same-origin' });
    if (!res.ok) throw new Error(`Failed to load ${url}`);
    const html = await res.text();

    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    // 1) <link rel="stylesheet"> 들을 <head>로
    doc.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
      // 중복 로드 방지
      const href = link.getAttribute('href');
      if (href && ![...document.head.querySelectorAll('link[rel="stylesheet"]')]
        .some(l => l.getAttribute('href') === href)) {
        document.head.appendChild(link.cloneNode(true));
      }
    });

    // 2) <style> 들을 <head>로
    doc.querySelectorAll('style').forEach(styleEl => {
      const clone = document.createElement('style');
      // CSS 텍스트 보존
      clone.textContent = styleEl.textContent;
      // (가능한 속성 복사)
      [...styleEl.attributes].forEach(a => clone.setAttribute(a.name, a.value));
      document.head.appendChild(clone);
    });

    // 3) 본문 콘텐츠를 mount에 붙임 (스크립트 제외)
    const mount = document.querySelector(mountSelector);
    // fragment 구성
    const frag = document.createDocumentFragment();
    [...doc.body.children].forEach(node => {
      if (node.tagName.toLowerCase() !== 'script') frag.appendChild(node.cloneNode(true));
    });
    mount.appendChild(frag);

    // 4) 스크립트 실행 (src/inline/module 지원, 순서 보장)
    const scripts = [...doc.querySelectorAll('script')];
    for (const oldScript of scripts) {
      const newScript = document.createElement('script');
      // type/module/defer 등 속성 복사
      [...oldScript.attributes].forEach(attr => newScript.setAttribute(attr.name, attr.value));
      if (oldScript.src) {
        // 네트워크 로드를 기다려 실행 순서 유지
        await new Promise((resolve, reject) => {
          newScript.onload = resolve;
          newScript.onerror = resolve;   // 실패해도 진행(브랜딩 제거 같은 선택 기능 보호)
          document.body.appendChild(newScript);
        });
      } else {
        // inline 코드 복사
        newScript.textContent = oldScript.textContent || '';
        document.body.appendChild(newScript);
      }
    }
  }

  // 실제 호출: 기존 chatbot.html(또는 chatbot_test.html) 경로로 바꿔도 됩니다.
  importHtmlWithAssets('/components/chatbot_test.html', '#bnk-chatbot-slot')
    .catch(err => console.error('[Chatbot load failed]', err));
  </script>

  <script>
  const startEl = document.getElementById('startDate');
  const endEl   = document.getElementById('endDate');

  // 인풋 자체 클릭으로는 열지 않으려면 주석 해제해서 막아도 됩니다.
  [startEl, endEl].forEach(el => {
    if (!el) return;
    el.setAttribute('readonly', 'readonly'); // 기본 입력 금지
    el.addEventListener('click', (e) => {
      e.preventDefault();
      openPicker(el);
    });
  });

  // 아이콘 클릭 -> 네이티브 달력 열기
  document.querySelectorAll('.calendar-btn').forEach((btn) => {
    const input = btn.previousElementSibling; // 바로 앞의 input[type=date]
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      openPicker(input);
    });
  });

  // 달력 오픈 핼퍼: showPicker 지원 시 사용, 아니면 click()을 위한 임시 readonly 해제
  function openPicker(input) {
    if (!input) return;

    const wasReadonly = input.hasAttribute('readonly');
    if (wasReadonly) input.removeAttribute('readonly');

    // 일부 브라우저는 focus 후 click이 더 안정적
    input.focus();
    if (typeof input.showPicker === 'function') {
      input.showPicker();
    } else {
      input.click(); // Firefox/사파리 등 대안
    }

    // 잠시 뒤 다시 readonly 복구 (즉시 복구하면 UI가 막히는 브라우저가 있음)
    if (wasReadonly) setTimeout(() => {
      input.setAttribute('readonly', 'readonly');
    }, 200);
  }

  // 시작일 선택 시 마감일 최소 날짜 자동 보정
  function clampEndMin() {
    if (!startEl || !endEl) return;
    endEl.min = startEl.value || '';
    if (endEl.value && startEl.value && endEl.value < startEl.value) {
      endEl.value = startEl.value;
    }
  }
  startEl && startEl.addEventListener('change', clampEndMin);

  // (옵션) 오늘 이전 선택 금지
  // const today = new Date().toISOString().slice(0,10);
  // startEl.min = today; endEl.min = today;
</script>
<script>
  (function(){
    const MAX_BYTES = 10 * 1024 * 1024; // 10MB
    const ALLOW = ['application/pdf',
                   'application/msword',
                   'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
    const dropzone = document.getElementById('termsDropzone');
    const input    = document.getElementById('termsFile');
    const result   = document.getElementById('termsResult');

    // 클릭/엔터/스페이스로 파일 선택
    dropzone.addEventListener('click', () => input.click());
    dropzone.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); input.click(); }
    });

    // 드래그 스타일링
    ['dragenter','dragover'].forEach(ev =>
      dropzone.addEventListener(ev, (e)=>{ e.preventDefault(); e.dataTransfer.dropEffect='copy'; dropzone.classList.add('is-dragover'); })
    );
    ['dragleave','dragend','drop'].forEach(ev =>
      dropzone.addEventListener(ev, ()=> dropzone.classList.remove('is-dragover'))
    );

    // 드롭 처리
    dropzone.addEventListener('drop', (e)=>{
      e.preventDefault();
      const file = e.dataTransfer.files && e.dataTransfer.files[0];
      if (file) setFile(file);
    });

    // 파일 선택 처리
    input.addEventListener('change', ()=>{
      const file = input.files && input.files[0];
      if (file) setFile(file);
    });

    // 파일 세팅 + 검증
    function setFile(file){
      const err = validate(file);
      if (err){
        result.innerHTML = `<div class="error">${err}</div>`;
        // 입력 초기화
        input.value = '';
        return;
      }
      // input.files 갱신(폼 제출용)
      const dt = new DataTransfer();
      dt.items.add(file);
      input.files = dt.files;

      result.innerHTML = renderChip(file);
      // 제거 버튼
      result.querySelector('.file-remove')?.addEventListener('click', ()=>{
        input.value = '';
        result.textContent = '';
      });
    }

    function validate(file){
      if (!ALLOW.includes(file.type)) {
        // 일부 브라우저는 mime이 비어있을 수 있어 확장자로 보조검사
        const ext = file.name.split('.').pop()?.toLowerCase();
        if (!['pdf','doc','docx'].includes(ext)) return '허용되지 않는 파일 형식입니다. (PDF, DOC, DOCX만 가능)';
      }
      if (file.size > MAX_BYTES) return '파일 용량이 10MB를 초과했습니다.';
      return '';
    }

    function renderChip(file){
      const size = prettyBytes(file.size);
      return `
        <span class="file-chip">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 7a2 2 0 0 1 2-2h7l5 5v7a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7z"
                  fill="none" stroke="#6B7280" stroke-width="1.4"/>
          </svg>
          <span>${file.name}</span>
          <span class="size">(${size})</span>
          <button type="button" class="file-remove" aria-label="파일 제거">✕</button>
        </span>`;
    }

    function prettyBytes(bytes){
      if (bytes < 1024) return `${bytes} B`;
      if (bytes < 1024*1024) return `${(bytes/1024).toFixed(1)} KB`;
      return `${(bytes/1024/1024).toFixed(1)} MB`;
    }
  })();
</script>
<script>
  (function () {
    const MAX = 100;
    const input   = document.getElementById('titleInput');
    const counter = document.getElementById('titleCounter');
    if (!input || !counter) return;

    // 한글/이모지까지 정확히 세기 (grapheme 단위)
    const segmenter = (window.Intl && Intl.Segmenter)
      ? new Intl.Segmenter('ko', { granularity: 'grapheme' })
      : null;

    function splitGraphemes(str) {
      if (segmenter) return [...segmenter.segment(str)].map(s => s.segment);
      // 폴백: 코드포인트 기준 (대부분 케이스 무난)
      return Array.from(str);
    }

    let composing = false; // 한글 조합 중 여부

    function update() {
      let parts = splitGraphemes(input.value);

      // 조합 중엔 자르지 않고 표시만, 조합이 끝난 뒤 자르기
      if (!composing && parts.length > MAX) {
        parts = parts.slice(0, MAX);
        input.value = parts.join('');
      }
      counter.textContent = `${parts.length} / ${MAX}자`;
    }

    input.addEventListener('compositionstart', () => { composing = true; });
    input.addEventListener('compositionend',   () => { composing = false; update(); });
    input.addEventListener('input', update);

    // 초기 렌더
    update();
  })();
</script>
<script>
  // 인쇄 버튼 클릭 시 브라우저 인쇄 다이얼로그 호출
  (function(){
    const btn = document.getElementById('btnPrint');
    if (!btn) return;
    btn.addEventListener('click', function(){
      // 필요시 인쇄 전 준비 로직을 여기서 처리 (예: 임시로 펼치기 등)
      window.print();
    });
  })();
</script>
  <footer>
      <div th:replace="~{layouts/footer.html}"></div>
  </footer>
</body>
</html>
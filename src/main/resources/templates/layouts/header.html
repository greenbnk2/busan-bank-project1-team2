<link rel="stylesheet" th:href="@{/components/button.css}" xmlns:th="http://www.w3.org/1999/html">
<div class="nav-root" style="">
    <div class="nav-wrap"
         style="display:flex; padding-top:20px; padding-bottom: 15px; padding-left: 30px; padding-right: 10px;">
        <!--로고-->
        <a th:href="@{/main/main}">
            <img th:src="@{/upload/images/bnk_logo.svg}"
                 alt=""
                 style="width:200px; height:50px;">
        </a>
        <div style="flex-grow: 1;">
            <ul class="gnb" style="
                display: flex;
                justify-content: flex-end;
                gap: 50px;
                list-style: none;
                margin: 0;
                padding: 0;
                align-items: center;
                ">
                <li style="margin-bottom:15px;"></li>

                <li class="">
                    <!-- 증권 -->
                    <a th:href="@{/stock/main}"
                       style="text-decoration: none; color: #374151; font-weight: 650; font-size: x-large;">증권</a>
                </li>

                <li class="has-mega">
                    <!-- 상품 -->
                    <a th:href="@{/product/main}"
                       style="text-decoration: none; color: #374151; font-weight: 650; font-size: x-large;">상품</a>
                    <div class="mega" role="region" aria-label="예금 메뉴">
                        <div class="mega-inner">
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">카테고리별 상품</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/product/list}">예금상품</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/product/list}">적금상품</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/product/fund/list}">펀드상품</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/stock/mainEtf}">ETF</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>


                <!-- 서식/공지사항 -->
                <li class="has-mega"><a href="#"
                                        style="text-decoration: none; color: #374151; font-weight: 650; font-size: x-large;">서식/공지사항</a>
                    <div class="mega" role="region" aria-label="펀드 메뉴">
                        <div class="mega-inner">
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">퇴직연금 자료실</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/data_room/deposit}">카테고리별서식</a>
                                    </li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/data_room/fund}">자료실</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/data_room/loan}">소규모펀드등공시</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/data_room/trust}">공지사항</a></li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">퇴직연금사업자공시</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/productsRoom/bankManual}">운용금액 및
                                        운용수익률</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/productsRoom/depositProduct}">퇴직연금
                                        계약서</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/productsRoom/AnyProduct}">원리금 보장
                                        상품 현황</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/productsRoom/serviceFee}">수수료</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>

                <!-- 퇴직연금 알아보기 -->
                <li class="has-mega"><a href="#"
                                        style="text-decoration: none; color: #374151; font-weight: 650; font-size: x-large;">퇴직연금 알아보기</a>
                    <div class="mega" role="region" aria-label="외환 메뉴">
                        <div class="mega-inner">
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">퇴직연금 소개</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/retirement-renew/intro/why-pension}">왜 퇴직연금인가?</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/retirement-renew/intro/why-pension}">퇴직연금이란?</a>
                                    </li>
                                    <li><a href=th:href="@{/retirement-renew/intro/why-pension}">퇴직연금 도입혜택</a></li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">퇴직연금 제도의 이해</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/retirement-renew/system/db}">확정급여형(DB)</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/retirement-renew/system/db}">확정급여형(DC)</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/retirement-renew/system/db}">개인형퇴직연금제도(IRP)</a></li>
                                    <li><a th:href="@{/retirement-renew/system/db}">제도 일반사항</a></li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">도입/운영안내</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/retirement-renew/operation/intro-process}">도입과정 한눈에 보기</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/retirement-renew/operation/intro-process}">운영과정 체크포인트</a></li>
                                    <li><a th:href="@{/retirement-renew/operation/intro-process}">적립금 운용전략</a></li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">NPS 노후설계서비스</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/retirement-renew/nps-plan/nps-plan}">NPS 노후설계서비스</a></li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">통합연금포털 오류 신고</a></h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/retirement-renew/portal-error/portal-error}">오류신고 접수</a></li>
                                    <li><a th:href="@{/retirement-renew/portal-error/portal-error}">오류신고 내역 및 결과조회</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>

                <!-- 고객상담 -->
                <li class="has-mega"><a href="#"
                                        style="text-decoration: none; color: #374151; font-weight: 650; font-size: x-large;">고객센터</a>
                    <div class="mega" role="region" aria-label="보험 메뉴">
                        <div class="mega-inner">
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">고객상담</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/consultation/FAQ}">FAQ</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/consultation/document}">필요서류안내</a>
                                    </li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/consultation/Q&A}">Q&A</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/consultation/findStore}">영업점
                                        찾기</a></li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">금융소비자보호</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/infoProtect/financialProtection}">금융소비자보호헌장</a>
                                    </li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/infoProtect/complaintProcessing}">민원접수
                                        및 처리프로세스</a></li>
                                    <li style="margin-bottom:15px;"><a
                                            th:href="@{/cs/infoProtect/protectionInformation}">소비자보호필수안내사항</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/infoProtect/agencyGuide}">금융소비자권리행사안내</a>
                                    </li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">이용안내</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/howUse/regProcess}">가입절차</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/howUse/pwInfo}">비밀번호안내</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/howUse/serviceTime}">서비스 이용시간</a>
                                    </li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/cs/howUse/feeInfo}">수수료안내</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>

                <!-- 은행안내 -->
                <li class="has-mega"><a href="#"
                                        style="text-decoration: none; color: #374151; font-weight: 650; font-size: x-large;">은행소개</a>
                    <div class="mega" role="region" aria-label="보험 메뉴">
                        <div class="mega-inner">
                            <div>
                                <h4 style="margin-bottom:27px; font-size: larger;">은행안내</h4>
                                <ul>
                                    <li style="margin-bottom:15px;"><a th:href="@{/info/guide}">은행안내</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/info/story}">BNK부산은행스토리</a></li>
                                    <li style="margin-bottom:15px;"><a th:href="@{/info/invest}">투자자정보</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>

                <li style="width: 500px;">
                    <div style="display: flex; align-items: center;">
                        <div id="session-box"
                             style="display: flex; align-items: center; gap: 10px; white-space: nowrap; flex-shrink: 0; width: 200px">
                            <span id="logout-btn" style="cursor:pointer; font-weight:600; flex-shrink:0;">로그아웃</span>
                            <span id="session-timer" style="font-weight:600; color:#374151; flex-shrink:0;">--:--</span>
                            <button class="btn-register" type="button" id="session-extend-btn"
                                    style="cursor:pointer; border-radius:6px; border:1px solid #E5E7EB; width:65px; height:32px; flex-shrink:0;">
                                연장
                            </button>
                        </div>
                        <div style=" width: 60px;text-align: center;">
                            <a th:href="@{/info/guide}">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10.5 6.5L5.5 10V22" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.5 2L15.5 5.5V12L19 14.5V22H10.5V2Z" fill="#4B5563" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M2 22H22" stroke="#4B5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </a>
                        </div>
                        <div th:if="${session.loginUser !=  null && session.loginUser.role == 'ADMIN'}">
                            <div style="width: 60px; padding-top: 1px;text-align: center;">
                                <a th:href="@{/admin/main}">
                                    <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M14.6825 7.75014C14.048 8.38653 13.239 8.82031 12.3578 8.99654C11.4766 9.17278 10.5629 9.08355 9.7325 8.74014L4.3225 15.2601C3.3325 16.2501 1.7325 16.2501 0.7425 15.2601C-0.2475 14.2701 -0.2475 12.6701 0.7425 11.6901L7.2625 6.27014C6.5825 4.62014 6.9125 2.66014 8.2525 1.32014C9.5325 0.0401411 11.3725 -0.299859 12.9725 0.260141L10.0825 3.15014L12.9025 5.97014L15.7625 3.10014C16.2925 4.68014 15.9425 6.49014 14.6825 7.75014ZM1.8125 14.1901C2.2125 14.5801 2.8525 14.5801 3.2425 14.1901C3.6425 13.7901 3.6425 13.1501 3.2425 12.7601C2.8525 12.3601 2.2125 12.3601 1.8125 12.7601C1.62501 12.9509 1.51994 13.2077 1.51994 13.4751C1.51994 13.7426 1.62501 13.9994 1.8125 14.1901Z" fill="#4B5563"/>
                                    </svg>
                                </a>
                            </div>
                        </div>
                        <div style="width: 115px;text-align: center;">
                            <button class="auth-btn"
                                    th:onclick="|location.href='@{/corporate/main}'|"
                                    style="cursor: pointer;border-radius: 6px; border:1px solid #E5E7EB; width:85px; height:38px;">
                                기업뱅킹
                            </button>
                        </div>
                        <div th:if="${session.loginUser != null && (session.loginUser.role == 'USER' || session.loginUser.role == 'ADMIN')}">
                            <div style="width: 60px;text-align: center;">
                                <a th:href="@{/mypage/main}">
                                    <img th:src="@{/images/human.png}" alt="">
                                </a>
                            </div>
                        </div>
                        <div th:if="${session.loginUser == null || (session.loginUser.role != 'USER' && session.loginUser.role != 'ADMIN')}">
                            <div style="width: 60px;text-align: center;">
                                <a th:href="@{/member/main}">
                                    <img th:src="@{/images/human.png}" alt="">
                                </a>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<style>
    /* ====== Mega Dropdown (업데이트) ====== */
    .nav-wrap {
        position: relative;
    }

    .gnb {
        position: relative;
        z-index: 20;
    }

    .gnb > li {
        position: relative;
    }

    /* 전체폭, 세로공간 넉넉히 */
    .mega {
        display: none;
        position: fixed; /* 화면 기준으로 전체폭 */
        left: 0;
        right: 0;
        top: 68px; /* 상단바 높이에 맞게 조절(기존보다 조금 여유) */
        background: #fff;
        border-top: 1px solid #E5E7EB;
        border-bottom: 5px solid #DE0000;
        box-shadow: 0 10px 24px rgba(0, 0, 0, .06);
        padding: 40px 48px; /* 패널 내부 여백 ↑ */
        min-height: 240px; /* 펼쳐지는 세로 공간 ↑ */
        z-index: 19;
    }

    /* 열림 조건 – 패널 위에 마우스 있어도 유지 */
    .has-mega:hover .mega,
    .has-mega:focus-within .mega,
    .mega:hover {
        display: block;
    }

    /* 그리드/간격 넓힘 */
    .mega-inner {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 32px 110px; /* 컬럼 가로 간격 넓힘 */
    }

    /* 타이틀/리스트 간격 조정 */
    .mega h4 {
        margin: 0 0 16px;
        font-size: 15px;
        color: #111827;
        font-weight: 700;
    }

    .mega ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    /* 항목 간 세로 간격 ↑ */
    .mega li {
        margin: 12px 0;
    }

    .mega a {
        text-decoration: none;
        color: #374151;
        font-size: 14px;
        line-height: 1.9; /* 클릭 영역도 넉넉히 */
    }

    .mega a:hover {
        text-decoration: none;
    }

    /* 반응형 */
    @media (max-width: 960px) {
        .mega-inner {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }

    @media (max-width: 560px) {
        .mega {
            position: static;
            top: auto;
            padding: 24px;
            min-height: 0;
        }

        .mega-inner {
            grid-template-columns: 1fr;
            gap: 20px;
        }
    }

    /* ====== Mega Dropdown – 줄 제거 & 그림자만 남기기 ====== */
    .nav-wrap {
        position: relative;
    }

    .gnb {
        position: relative;
        z-index: 20;
    }

    .gnb > li {
        position: relative;
    }

    /* 메가패널: 전체폭 + 테두리 제거 + 부드러운 그림자만 */
    .mega {
        display: none;
        position: fixed; /* 화면 기준으로 전체 가로 */
        left: 0;
        right: 0;
        top: 68px; /* 상단바 높이에 맞게 조절 */
        background: #fff;
        /* 줄(테두리) 제거 */
        border: none;
        /* 하단만 자연스럽게 보이는 그림자 */
        box-shadow: 0 16px 30px rgba(0, 0, 0, .08);
        padding: 40px 48px;
        min-height: 240px;
        z-index: 19;
    }

    /* 열림 상태 유지 */
    .has-mega:hover .mega,
    .has-mega:focus-within .mega,
    .mega:hover {
        display: block;
    }

    /* 열렸을 때 상단 빨간 줄 숨기기 (닫히면 자동 복원) */
    .nav-root:has(.has-mega:hover .mega),
    .nav-root:has(.has-mega:focus-within .mega),
    .nav-root:has(.mega:hover) {
        border-bottom-color: transparent !important;
    }

    /* 내부 레이아웃 */
    .mega-inner {
        max-width: 1075px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 32px 110px;
    }

    .mega h4 {
        margin: 0 0 16px;
        font-size: 15px;
        color: #111827;
        font-weight: 700;
    }

    .mega ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .mega li {
        margin: 12px 0;
    }

    .mega a {
        text-decoration: none;
        color: #374151;
        font-size: 14px;
        line-height: 1.9;
    }

    .mega a:hover {
        text-decoration: none;
    }

    /* 반응형 */
    @media (max-width: 960px) {
        .mega-inner {
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 24px 60px;
        }
    }

    @media (max-width: 560px) {
        .mega {
            position: static;
            top: auto;
            padding: 24px;
            min-height: 0;
            box-shadow: 0 10px 20px rgba(0, 0, 0, .08);
        }

        .mega-inner {
            grid-template-columns: 1fr;
            gap: 20px;
        }
    }

    /* ===== 상단 1차 메뉴 hover 시 밑줄 효과 ===== */
    .gnb > li > a {
        position: relative;
        display: inline-block;
        text-decoration: none;
        color: #374151;
        padding-bottom: 4px; /* 밑줄과의 간격 */
        transition: color 0.2s ease;
    }

    .gnb > li > a::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 0;
        width: 0%;
        height: 2px;
        background-color: #DE0000; /* BNK 메인컬러 */
        transition: width 0.25s ease-in-out;
    }

    .gnb > li:hover > a::after {
        width: 100%;
    }

    .gnb > li:hover > a {
        color: #DE0000; /* hover 시 글자색 살짝 강조 (선택사항) */
    }

    /* ===== mega 내부 메뉴 hover 시 밑줄 애니메이션 ===== */
    .mega a {
        position: relative;
        display: inline-block;
        text-decoration: none;
        color: #374151;
        font-size: 14px;
        line-height: 1.9;
        padding-bottom: 1px; /* 밑줄과 간격 */
        transition: color 0.25s ease;
    }

    .mega a::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: -2px;
        width: 0%;
        height: 1.5px;
        background-color: #DE0000; /* 아래 메뉴는 진한 빨간 선 */
        transition: width 0.25s ease-in-out;
        transform: translateZ(0);
    }

    .mega a::after {
        height: 2px; /* 균일 두께 */
        bottom: 0px; /* 정수 픽셀 라인에 고정 */
        border-radius: 2px;
        transform: translateZ(0); /* 서브픽셀 블러 방지 */
    }

    .mega a:hover::after {
        width: 100%;
    }

    :root {
        --accent: #DE0000; /* 밑줄/강조 색 */
        --base: #374151; /* 기본 글자색 */
        --speed: .25s; /* 애니메이션 시간 */
        --ease: ease-in-out;
    }

    /* ===== 2차 메뉴(mega) 텍스트 색이 밑줄과 같이 쓸림 ===== */
    :root {
        --accent: #DE0000;
        --base: #374151;
        --speed: .25s;
        --ease: ease-in-out;
    }

    /* 2차(mega) 링크: 배경-클립 효과 제거, 색 즉시 변경 */
    .mega a {
        background: none !important; /* 겹배경 제거 */
        -webkit-background-clip: initial !important;
        background-clip: initial !important;
        color: var(--base);
        transition: color 0.08s linear; /* 거의 즉시 빨간색 */
        padding-bottom: 0px; /* 밑줄과 간격 */
    }

    .mega a:hover {
        color: var(--accent);
    }

    /* 밑줄만 기존처럼 애니메이션 */
    .mega a::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: -1px;
        width: 0%;
        height: 2px;
        background: var(--accent);
        border-radius: 2px;
        transform: translateZ(0);
        transition: width var(--speed) var(--ease);
    }

    .mega a:hover::after {
        width: 100%;
    }

    /* 1차(GNB)도 동일 컨셉으로 */
    .gnb > li > a {
        background: none !important;
        -webkit-background-clip: initial !important;
        background-clip: initial !important;
        color: var(--base);
        padding-bottom: 3px;
        transition: color 0.08s linear;
    }

    .gnb > li:hover > a {
        color: var(--accent);
    }

    .gnb > li > a::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 0;
        width: 0%;
        height: 2px;
        background: var(--accent);
        transition: width var(--speed) var(--ease);
    }

    .gnb > li:hover > a::after {
        width: 100%;
    }

    /* GNB(예금·펀드·외환...) hover 시 글자 빨간색으로 */
    .gnb > li > a {
        color: var(--base) !important;
        transition: color .08s linear;
    }

    .gnb > li:hover > a {
        color: var(--accent) !important;
    }

    /* 인라인 컬러를 덮기 위해 !important */
    /* ===== 클릭-잠금 모드 ===== */
    /* 잠금일 때는 hover로는 절대 열리지 않음 */
    .nav-locked .gnb .has-mega:hover .mega {
        display: none !important;
    }

    /* active(선택) 된 카테고리만 열림 */
    .gnb .has-mega.active .mega {
        display: block !important;
    }

    /* 선택된 탭(1차) 스타일 유지 */
    .gnb .has-mega.active > a {
        color: var(--accent) !important;
    }

    .gnb .has-mega.active > a::after {
        width: 100% !important;
    }

    /* 빨간 보더는 ‘열렸을 때’가 아니라 ‘잠금 중’에만 숨김 */
    .nav-root.nav-locked {
        border-bottom-color: transparent !important;
    }

    /* 잠금 아닌 상태에서는 hover로 열림 */
    .nav-root:not(.nav-locked) .gnb .has-mega:hover .mega {
        display: block !important;
    }

    /* 잠금 상태: hover로는 절대 열지 않음 */
    .nav-root.nav-locked .gnb .has-mega:hover .mega {
        display: none !important;
    }

    /* 잠금 상태에서도 active 항목은 항상 열림(깜빡임 방지: 우선순위 가장 높게) */
    .nav-root.nav-locked .gnb .has-mega.active .mega {
        display: block !important;
    }

    /* 선택된 탭 스타일 유지 */
    .gnb .has-mega.active > a {
        color: var(--accent) !important;
    }

    .gnb .has-mega.active > a::after {
        width: 100% !important;
    }

    /* 잠금 중에만 상단 빨간줄 숨김 */
    .nav-root.nav-locked {
        border-bottom-color: transparent !important;
    }

    .auth-btn {
        cursor: pointer;
        border-radius: 6px;
        border: 1px solid #E5E7EB;
        background-color: white;
        width: 85px;
        height: 38px;
        color: #374151;
        transition: all 0.25s ease-in-out; /* 부드러운 효과 */
    }

    .auth-btn:hover {
        background-color: #DE0000;
        color: white;
        border-color: #DE0000;
    }

    /* 헤더 고정 */
    .nav-root {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000; /* 메뉴가 위로 오도록 */
        background: #fff; /* 스크롤 시 배경 비침 방지 */
        border-bottom: 1px solid #DE0000;
    }

    /* 헤더 높이 변수(기본값 68px) */
    :root {
        --nav-h: 68px;
    }

    /* 메가드롭다운이 헤더 바로 아래에서 열리도록 */
    .mega {
        top: var(--nav-h); /* 기존 68px → 변수로 */
    }
</style>
<script th:inline="javascript">
    (function () {
        const root = document.querySelector('.nav-root');
        const items = Array.from(document.querySelectorAll('.gnb .has-mega'));

        function setActive(li) {
            items.forEach(x => x.classList.remove('active'));
            if (li) {
                li.classList.add('active');
                root.classList.add('nav-locked');
            } else {
                root.classList.remove('nav-locked');
            }
        }

        items.forEach(li => {
            const a = li.querySelector(':scope > a');
            const mega = li.querySelector(':scope > .mega');

            // 상단 a 클릭으로만 열고/닫기 (내부 클릭 버블링 방지)
            if (a) {
                a.addEventListener('click', e => {
                    e.preventDefault();
                    e.stopPropagation();
                    const already = li.classList.contains('active');
                    setActive(already ? null : li);
                });
            }

            // 2차 메뉴 영역 클릭이 상위 li로 버블링되어 토글되지 않게
            if (mega) {
                mega.addEventListener('click', e => e.stopPropagation());
            }
        });

        // 바깥 클릭 시 닫기
        document.addEventListener('click', e => {
            if (!root.contains(e.target)) setActive(null);
        });

        // ESC로 닫기
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') setActive(null);
        });
    })();
    (function () {
        const root = document.querySelector('.nav-root');

        function syncNavHeight() {
            const h = root.getBoundingClientRect().height || 68;
            document.documentElement.style.setProperty('--nav-h', h + 'px');
            document.body.style.paddingTop = h + 'px';   // 본문이 헤더 밑으로 시작
        }

        // 초기/리사이즈/폰트로드 등 상황에 맞춰 갱신
        window.addEventListener('load', syncNavHeight);
        window.addEventListener('resize', syncNavHeight);
        // 폰트나 이미지로 높이가 변할 수 있으니 약간 지연 갱신
        setTimeout(syncNavHeight, 100);
    })();
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const timerSpan = document.getElementById('session-timer');
        const extendBtn = document.getElementById('session-extend-btn');
        const sessionBox = document.getElementById('session-box');

        // 요소 없으면(해당 페이지에서 헤더 안 쓴 경우) 그냥 종료
        if (!timerSpan || !extendBtn || !sessionBox) return;

        let remainSeconds = 0;
        let timerId = null;

        function renderTimer() {
            const min = String(Math.floor(remainSeconds / 60)).padStart(2, '0');
            const sec = String(remainSeconds % 60).padStart(2, '0');
            timerSpan.textContent = `${min}:${sec}`;
        }

        function startTimer() {
            if (timerId) clearInterval(timerId);
            renderTimer();

            timerId = setInterval(function () {
                remainSeconds--;
                renderTimer();

                if (remainSeconds <= 0) {
                    clearInterval(timerId);
                    alert('세션이 만료되어 로그아웃됩니다.');

                    // 1) 세션 invalidate 요청
                    fetch('/BNK/member/logout')
                        .finally(function () {
                            // 2) 로그인 페이지로 이동
                            window.location.href = '/BNK/member/main';
                        });
                }
            }, 1000);
        }

        // 페이지 로딩 시 남은 시간 조회
        fetch('/BNK/member/session/remaining')
            .then(function (res) {
                return res.json();
            })
            .then(function (data) {
                remainSeconds = data.remainSeconds || 0;

                if (remainSeconds <= 0) {
                    // 로그인 안 되어있으면 타이머 숨김
                    sessionBox.style.display = 'none';
                    return;
                }

                startTimer();
            })
            .catch(function () {
                sessionBox.style.display = 'none';
            });

        // 연장 버튼 클릭 → 20분 재설정
        extendBtn.addEventListener('click', function () {
            fetch('/BNK/member/session/extend', {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                    // * Spring Security CSRF 사용 중이면 여기에 TOKEN 추가해야 함
                }
            })
                .then(function (res) {
                    return res.json();
                })
                .then(function (data) {
                    remainSeconds = data.remainSeconds || 0;

                    if (remainSeconds <= 0) {
                        alert('세션이 만료되었습니다. 다시 로그인 해주세요.');
                        return;
                    }
                    renderTimer();
                    startTimer();
                })
                .catch(function () {
                    alert('세션 연장 중 오류가 발생했습니다.');
                });
        });
    });

    // 로그아웃
    document.addEventListener('DOMContentLoaded', function () {
        const logoutBtn = document.getElementById('logout-btn');

        if (logoutBtn) {
            logoutBtn.addEventListener('click', function () {
                document.getElementById('session-box').style.display = 'none';
                window.location.href = '/BNK/member/logout';
            });
        }
    });
</script>